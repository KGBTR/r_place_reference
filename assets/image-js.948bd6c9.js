var it=Object.defineProperty;var tt=Object.getOwnPropertySymbols;var nt=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable;var rt=(t,e,r)=>e in t?it(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,We=(t,e)=>{for(var r in e||(e={}))nt.call(e,r)&&rt(t,r,e[r]);if(tt)for(var r of tt(e))st.call(e,r)&&rt(t,r,e[r]);return t};const bitMethods={getBit(t){return this.data[getSlot(t)]&1<<getShift(t)?1:0},setBit(t){this.data[getSlot(t)]|=1<<getShift(t)},clearBit(t){this.data[getSlot(t)]&=~(1<<getShift(t))},toggleBit(t){this.data[getSlot(t)]^=1<<getShift(t)},getBitXY(t,e){return t>=this.width||e>=this.height?0:this.getBit(e*this.width+t)},setBitXY(t,e){this.setBit(e*this.width+t)},clearBitXY(t,e){this.clearBit(e*this.width+t)},toggleBitXY(t,e){this.toggleBit(e*this.width+t)}};function getSlot(t){return t>>3}function getShift(t){return 7-(t&7)}function setBitMethods(t){for(const e in bitMethods)t.prototype[e]=bitMethods[e]}function checkProcessable(t,e={}){let{bitDepth:r,alpha:n,colorModel:s,components:a,channels:o}=e;if(typeof t!="string"||t.length===0)throw new TypeError("processName must be a string");if(r&&(Array.isArray(r)||(r=[r]),!r.includes(this.bitDepth)))throw new TypeError(`The process: ${t} can only be applied if bit depth is in: ${r}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.alpha)))throw new TypeError(`The process: ${t} can only be applied if alpha is in: ${n}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.colorModel)))throw new TypeError(`The process: ${t} can only be applied if color model is in: ${s}`);if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.components))){let l=`The process: ${t} can only be applied if the number of components is in: ${a}`;throw a.length===1&&a[0]===1?new TypeError(`${l}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(l)}if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.channels)))throw new TypeError(`The process: ${t} can only be applied if the number of channels is in: ${o}`)}function createBlob(t,e){t=t||[],e=e||{},typeof e=="string"&&(e={type:e});try{return new Blob(t,e)}catch(a){if(a.name!=="TypeError")throw a;for(var r=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,n=new r,s=0;s<t.length;s+=1)n.append(t[s]);return n.getBlob(e.type)}}function dataURLToBlob(t){var e=t.match(/data:([^;]+)/)[1],r=t.replace(/^[^,]+,/,""),n=binaryStringToArrayBuffer(atob(r));return createBlob([n],{type:e})}function canvasToBlob(t,e,r){return typeof t.toBlob=="function"?new Promise(function(n){t.toBlob(n,e,r)}):Promise.resolve(dataURLToBlob(t.toDataURL(e,r)))}function binaryStringToArrayBuffer(t){for(var e=t.length,r=new ArrayBuffer(e),n=new Uint8Array(r),s=-1;++s<e;)n[s]=t.charCodeAt(s);return r}var commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function getAugmentedNamespace(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}),e}function commonjsRequire(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var utf8$1={exports:{}};/*! https://mths.be/utf8js v2.1.2 by @mathias */(function(t,e){(function(r){var n=e,s=t&&t.exports==n&&t,a=typeof commonjsGlobal=="object"&&commonjsGlobal;(a.global===a||a.window===a)&&(r=a);var o=String.fromCharCode;function l(I){for(var v=[],k=0,w=I.length,M,D;k<w;)M=I.charCodeAt(k++),M>=55296&&M<=56319&&k<w?(D=I.charCodeAt(k++),(D&64512)==56320?v.push(((M&1023)<<10)+(D&1023)+65536):(v.push(M),k--)):v.push(M);return v}function f(I){for(var v=I.length,k=-1,w,M="";++k<v;)w=I[k],w>65535&&(w-=65536,M+=o(w>>>10&1023|55296),w=56320|w&1023),M+=o(w);return M}function h(I){if(I>=55296&&I<=57343)throw Error("Lone surrogate U+"+I.toString(16).toUpperCase()+" is not a scalar value")}function c(I,v){return o(I>>v&63|128)}function u(I){if((I&4294967168)==0)return o(I);var v="";return(I&4294965248)==0?v=o(I>>6&31|192):(I&4294901760)==0?(h(I),v=o(I>>12&15|224),v+=c(I,6)):(I&4292870144)==0&&(v=o(I>>18&7|240),v+=c(I,12),v+=c(I,6)),v+=o(I&63|128),v}function g(I){for(var v=l(I),k=v.length,w=-1,M,D="";++w<k;)M=v[w],D+=u(M);return D}function d(){if(m>=y)throw Error("Invalid byte index");var I=x[m]&255;if(m++,(I&192)==128)return I&63;throw Error("Invalid continuation byte")}function p(){var I,v,k,w,M;if(m>y)throw Error("Invalid byte index");if(m==y)return!1;if(I=x[m]&255,m++,(I&128)==0)return I;if((I&224)==192){if(v=d(),M=(I&31)<<6|v,M>=128)return M;throw Error("Invalid continuation byte")}if((I&240)==224){if(v=d(),k=d(),M=(I&15)<<12|v<<6|k,M>=2048)return h(M),M;throw Error("Invalid continuation byte")}if((I&248)==240&&(v=d(),k=d(),w=d(),M=(I&7)<<18|v<<12|k<<6|w,M>=65536&&M<=1114111))return M;throw Error("Invalid UTF-8 detected")}var x,y,m;function A(I){x=l(I),y=x.length,m=0;for(var v=[],k;(k=p())!==!1;)v.push(k);return f(v)}var b={version:"2.1.2",encode:g,decode:A};if(n&&!n.nodeType)if(s)s.exports=b;else{var _={},E=_.hasOwnProperty;for(var T in b)E.call(b,T)&&(n[T]=b[T])}else r.utf8=b})(commonjsGlobal)})(utf8$1,utf8$1.exports);const utf8=utf8$1.exports,defaultByteLength$3=1024*8,charArray$1=[];class IOBuffer$6{constructor(e,r){r=r||{};var n=!1;e===void 0&&(e=defaultByteLength$3),typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this._lastWrittenByte=e.byteLength);const s=r.offset?r.offset>>>0:0;let a=e.byteLength-s,o=s;e.buffer&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+s),e=e.buffer),n?this._lastWrittenByte=a:this._lastWrittenByte=0,this.buffer=e,this.length=a,this.byteLength=a,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,a),this._mark=0,this._marks=[]}available(e){return e===void 0&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return e===void 0&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(e===void 0&&(e=1),!this.available(e)){const n=(this.offset+e)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){e===void 0&&(e=1);for(var r=new Uint8Array(e),n=0;n<e;n++)r[n]=this.readByte();return r}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e){e===void 0&&(e=1),charArray$1.length=e;for(var r=0;r<e;r++)charArray$1[r]=this.readChar();return charArray$1.join("")}readUtf8(e){e===void 0&&(e=1);const r=this.readChars(e);return utf8.decode(r)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var r=0;r<e.length;r++)this._data.setUint8(this.offset++,e[r]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var r=0;r<e.length;r++)this.writeUint8(e.charCodeAt(r));return this}writeUtf8(e){const r=utf8.encode(e);return this.writeChars(r)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}getBuffer(){return typeof Buffer!="undefined"?Buffer.from(this.toArray()):this.toArray()}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}var IOBuffer_1$1=IOBuffer$6,constants$4={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const IOBuffer$5=IOBuffer_1$1,constants$3=constants$4,tableLeft=[];for(var i$3=0;i$3<=8;i$3++)tableLeft.push(255<<i$3);var encode$5=function(t){if(t.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");if(t.components!==1)throw new Error("Only 1 component is supported");if(t.channels!==1)throw new Error("Only 1 channel is supported");var e=new IOBuffer$5;e.skip(14),writeBitmapV5Header(e,t),writeColorTable(e,t);const r=e.offset;return writePixelArray(e,t),e.rewind(),writeBitmapFileHeader(e,r),e.getBuffer()};function writePixelArray(t,e){const r=Math.floor((e.bitDepth*e.width+31)/32)*4,n=Math.ceil(e.bitDepth*e.width/8),s=r-n,a=e.bitDepth*e.width%8,o=a===0?0:8-a,l=r*e.height;var f,h;const c=new IOBuffer$5(e.data);let u=0,g=0,d=8;t.mark(),h=c.readUint8();for(var p=e.height-1;p>=0;p--){const y=p===0;t.reset(),t.skip(p*r);for(var x=0;x<n;x++){const m=x===n-1;g<=o&&m?(t.writeByte(h<<g),(o===0||o===g)&&!y&&(f=h,h=c.readByte())):g===0?(f=h,h=c.readUint8(),t.writeByte(f)):(f=h,h=c.readUint8(),t.writeByte(f<<g&tableLeft[g]|h>>d)),m?(u+=a||8,t.skip(s),g=u%8,d=8-g):u+=8}}r>n&&(t.reset(),t.skip(l-1),t.writeUint8(0))}function writeColorTable(t,e){e.bitDepth>8||t.writeUint32(0).writeUint32(16777215)}function writeBitmapFileHeader(t,e){t.writeChars("BM"),t.writeInt32(t._lastWrittenByte),t.writeUint16(0),t.writeUint16(0),t.writeUint32(e)}function writeBitmapV5Header(t,e){t.writeUint32(124).writeInt32(e.width).writeInt32(e.height).writeUint16(1).writeUint16(e.bitDepth).writeUint32(constants$3.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(e.width*e.height*e.bitDepth).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,e.bitDepth)).writeUint32(Math.pow(2,e.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$3.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$3.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}var encode$4=encode$5;(function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function e(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let a=0;const o=n.length;let l=0,f=Math.max(32,o+(o>>1)+7),h=new Uint8Array(f>>3<<3);for(;a<o;){let c=n.charCodeAt(a++);if(c>=55296&&c<=56319){if(a<o){const u=n.charCodeAt(a);(u&64512)===56320&&(++a,c=((c&1023)<<10)+(u&1023)+65536)}if(c>=55296&&c<=56319)continue}if(l+4>h.length){f+=8,f*=1+a/n.length*2,f=f>>3<<3;const u=new Uint8Array(f);u.set(h),h=u}if((c&4294967168)===0){h[l++]=c;continue}else if((c&4294965248)===0)h[l++]=c>>6&31|192;else if((c&4294901760)===0)h[l++]=c>>12&15|224,h[l++]=c>>6&63|128;else if((c&4292870144)===0)h[l++]=c>>18&7|240,h[l++]=c>>12&63|128,h[l++]=c>>6&63|128;else continue;h[l++]=c&63|128}return h.slice(0,l)};function r(n="utf-8",s={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(s.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const a=new Uint8Array(n);let o=0;const l=a.length,f=[];for(;o<l;){const h=a[o++];if(h===0)break;if((h&128)===0)f.push(h);else if((h&224)===192){const c=a[o++]&63;f.push((h&31)<<6|c)}else if((h&240)===224){const c=a[o++]&63,u=a[o++]&63;f.push((h&31)<<12|c<<6|u)}else if((h&248)===240){const c=a[o++]&63,u=a[o++]&63,g=a[o++]&63;let d=(h&7)<<18|c<<12|u<<6|g;d>65535&&(d-=65536,f.push(d>>>10&1023|55296),d=56320|d&1023),f.push(d)}}return String.fromCharCode.apply(null,f)},t.TextEncoder=e,t.TextDecoder=r})(typeof window!="undefined"?window:typeof self!="undefined"?self:globalThis);const decoder$2=new TextDecoder("utf-8");function decode$6(t){return decoder$2.decode(t)}const encoder$2=new TextEncoder;function encode$3(t){return encoder$2.encode(t)}const defaultByteLength$2=1024*8;class IOBuffer$4{constructor(e=defaultByteLength$2,r={}){let n=!1;typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const s=r.offset?r.offset>>>0:0,a=e.byteLength-s;let o=s;(ArrayBuffer.isView(e)||e instanceof IOBuffer$4)&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+s),e=e.buffer),n?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=e,this.length=a,this.byteLength=a,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,a),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const n=(this.offset+e)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){const r=new Uint8Array(e);for(let n=0;n<e;n++)r[n]=this.readByte();return r}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let r="";for(let n=0;n<e;n++)r+=this.readChar();return r}readUtf8(e=1){return decode$6(this.readBytes(e))}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let r=0;r<e.length;r++)this._data.setUint8(this.offset++,e[r]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let r=0;r<e.length;r++)this.writeUint8(e.charCodeAt(r));return this}writeUtf8(e){return this.writeBytes(encode$3(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(t){let e=t.length;for(;--e>=0;)t[e]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(t,e,r,n,s){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=s,this.has_stree=t&&t.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const d_code=t=>t<256?_dist_code[t]:_dist_code[256+(t>>>7)],put_short=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},send_bits=(t,e,r)=>{t.bi_valid>Buf_size-r?(t.bi_buf|=e<<t.bi_valid&65535,put_short(t,t.bi_buf),t.bi_buf=e>>Buf_size-t.bi_valid,t.bi_valid+=r-Buf_size):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},send_code=(t,e,r)=>{send_bits(t,r[e*2],r[e*2+1])},bi_reverse=(t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},bi_flush=t=>{t.bi_valid===16?(put_short(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},gen_bitlen=(t,e)=>{const r=e.dyn_tree,n=e.max_code,s=e.stat_desc.static_tree,a=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,l=e.stat_desc.extra_base,f=e.stat_desc.max_length;let h,c,u,g,d,p,x=0;for(g=0;g<=MAX_BITS$1;g++)t.bl_count[g]=0;for(r[t.heap[t.heap_max]*2+1]=0,h=t.heap_max+1;h<HEAP_SIZE$1;h++)c=t.heap[h],g=r[r[c*2+1]*2+1]+1,g>f&&(g=f,x++),r[c*2+1]=g,!(c>n)&&(t.bl_count[g]++,d=0,c>=l&&(d=o[c-l]),p=r[c*2],t.opt_len+=p*(g+d),a&&(t.static_len+=p*(s[c*2+1]+d)));if(x!==0){do{for(g=f-1;t.bl_count[g]===0;)g--;t.bl_count[g]--,t.bl_count[g+1]+=2,t.bl_count[f]--,x-=2}while(x>0);for(g=f;g!==0;g--)for(c=t.bl_count[g];c!==0;)u=t.heap[--h],!(u>n)&&(r[u*2+1]!==g&&(t.opt_len+=(g-r[u*2+1])*r[u*2],r[u*2+1]=g),c--)}},gen_codes=(t,e,r)=>{const n=new Array(MAX_BITS$1+1);let s=0,a,o;for(a=1;a<=MAX_BITS$1;a++)n[a]=s=s+r[a-1]<<1;for(o=0;o<=e;o++){let l=t[o*2+1];l!==0&&(t[o*2]=bi_reverse(n[l]++,l))}},tr_static_init=()=>{let t,e,r,n,s;const a=new Array(MAX_BITS$1+1);for(r=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=r,t=0;t<1<<extra_lbits[n];t++)_length_code[r++]=n;for(_length_code[r-1]=n,s=0,n=0;n<16;n++)for(base_dist[n]=s,t=0;t<1<<extra_dbits[n];t++)_dist_code[s++]=n;for(s>>=7;n<D_CODES$1;n++)for(base_dist[n]=s<<7,t=0;t<1<<extra_dbits[n]-7;t++)_dist_code[256+s++]=n;for(e=0;e<=MAX_BITS$1;e++)a[e]=0;for(t=0;t<=143;)static_ltree[t*2+1]=8,t++,a[8]++;for(;t<=255;)static_ltree[t*2+1]=9,t++,a[9]++;for(;t<=279;)static_ltree[t*2+1]=7,t++,a[7]++;for(;t<=287;)static_ltree[t*2+1]=8,t++,a[8]++;for(gen_codes(static_ltree,L_CODES$1+1,a),t=0;t<D_CODES$1;t++)static_dtree[t*2+1]=5,static_dtree[t*2]=bi_reverse(t,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=t=>{let e;for(e=0;e<L_CODES$1;e++)t.dyn_ltree[e*2]=0;for(e=0;e<D_CODES$1;e++)t.dyn_dtree[e*2]=0;for(e=0;e<BL_CODES$1;e++)t.bl_tree[e*2]=0;t.dyn_ltree[END_BLOCK*2]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},bi_windup=t=>{t.bi_valid>8?put_short(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},copy_block=(t,e,r,n)=>{bi_windup(t),n&&(put_short(t,r),put_short(t,~r)),t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},smaller=(t,e,r,n)=>{const s=e*2,a=r*2;return t[s]<t[a]||t[s]===t[a]&&n[e]<=n[r]},pqdownheap=(t,e,r)=>{const n=t.heap[r];let s=r<<1;for(;s<=t.heap_len&&(s<t.heap_len&&smaller(e,t.heap[s+1],t.heap[s],t.depth)&&s++,!smaller(e,n,t.heap[s],t.depth));)t.heap[r]=t.heap[s],r=s,s<<=1;t.heap[r]=n},compress_block=(t,e,r)=>{let n,s,a=0,o,l;if(t.last_lit!==0)do n=t.pending_buf[t.d_buf+a*2]<<8|t.pending_buf[t.d_buf+a*2+1],s=t.pending_buf[t.l_buf+a],a++,n===0?send_code(t,s,e):(o=_length_code[s],send_code(t,o+LITERALS$1+1,e),l=extra_lbits[o],l!==0&&(s-=base_length[o],send_bits(t,s,l)),n--,o=d_code(n),send_code(t,o,r),l=extra_dbits[o],l!==0&&(n-=base_dist[o],send_bits(t,n,l)));while(a<t.last_lit);send_code(t,END_BLOCK,e)},build_tree=(t,e)=>{const r=e.dyn_tree,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.elems;let o,l,f=-1,h;for(t.heap_len=0,t.heap_max=HEAP_SIZE$1,o=0;o<a;o++)r[o*2]!==0?(t.heap[++t.heap_len]=f=o,t.depth[o]=0):r[o*2+1]=0;for(;t.heap_len<2;)h=t.heap[++t.heap_len]=f<2?++f:0,r[h*2]=1,t.depth[h]=0,t.opt_len--,s&&(t.static_len-=n[h*2+1]);for(e.max_code=f,o=t.heap_len>>1;o>=1;o--)pqdownheap(t,r,o);h=a;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pqdownheap(t,r,1),l=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=l,r[h*2]=r[o*2]+r[l*2],t.depth[h]=(t.depth[o]>=t.depth[l]?t.depth[o]:t.depth[l])+1,r[o*2+1]=r[l*2+1]=h,t.heap[1]=h++,pqdownheap(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],gen_bitlen(t,e),gen_codes(r,f,t.bl_count)},scan_tree=(t,e,r)=>{let n,s=-1,a,o=e[0*2+1],l=0,f=7,h=4;for(o===0&&(f=138,h=3),e[(r+1)*2+1]=65535,n=0;n<=r;n++)a=o,o=e[(n+1)*2+1],!(++l<f&&a===o)&&(l<h?t.bl_tree[a*2]+=l:a!==0?(a!==s&&t.bl_tree[a*2]++,t.bl_tree[REP_3_6*2]++):l<=10?t.bl_tree[REPZ_3_10*2]++:t.bl_tree[REPZ_11_138*2]++,l=0,s=a,o===0?(f=138,h=3):a===o?(f=6,h=3):(f=7,h=4))},send_tree=(t,e,r)=>{let n,s=-1,a,o=e[0*2+1],l=0,f=7,h=4;for(o===0&&(f=138,h=3),n=0;n<=r;n++)if(a=o,o=e[(n+1)*2+1],!(++l<f&&a===o)){if(l<h)do send_code(t,a,t.bl_tree);while(--l!==0);else a!==0?(a!==s&&(send_code(t,a,t.bl_tree),l--),send_code(t,REP_3_6,t.bl_tree),send_bits(t,l-3,2)):l<=10?(send_code(t,REPZ_3_10,t.bl_tree),send_bits(t,l-3,3)):(send_code(t,REPZ_11_138,t.bl_tree),send_bits(t,l-11,7));l=0,s=a,o===0?(f=138,h=3):a===o?(f=6,h=3):(f=7,h=4)}},build_bl_tree=t=>{let e;for(scan_tree(t,t.dyn_ltree,t.l_desc.max_code),scan_tree(t,t.dyn_dtree,t.d_desc.max_code),build_tree(t,t.bl_desc),e=BL_CODES$1-1;e>=3&&t.bl_tree[bl_order[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},send_all_trees=(t,e,r,n)=>{let s;for(send_bits(t,e-257,5),send_bits(t,r-1,5),send_bits(t,n-4,4),s=0;s<n;s++)send_bits(t,t.bl_tree[bl_order[s]*2+1],3);send_tree(t,t.dyn_ltree,e-1),send_tree(t,t.dyn_dtree,r-1)},detect_data_type=t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return Z_BINARY;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Z_TEXT;for(r=32;r<LITERALS$1;r++)if(t.dyn_ltree[r*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=t=>{static_init_done||(tr_static_init(),static_init_done=!0),t.l_desc=new TreeDesc(t.dyn_ltree,static_l_desc),t.d_desc=new TreeDesc(t.dyn_dtree,static_d_desc),t.bl_desc=new TreeDesc(t.bl_tree,static_bl_desc),t.bi_buf=0,t.bi_valid=0,init_block(t)},_tr_stored_block$1=(t,e,r,n)=>{send_bits(t,(STORED_BLOCK<<1)+(n?1:0),3),copy_block(t,e,r,!0)},_tr_align$1=t=>{send_bits(t,STATIC_TREES<<1,3),send_code(t,END_BLOCK,static_ltree),bi_flush(t)},_tr_flush_block$1=(t,e,r,n)=>{let s,a,o=0;t.level>0?(t.strm.data_type===Z_UNKNOWN$1&&(t.strm.data_type=detect_data_type(t)),build_tree(t,t.l_desc),build_tree(t,t.d_desc),o=build_bl_tree(t),s=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=s&&(s=a)):s=a=r+5,r+4<=s&&e!==-1?_tr_stored_block$1(t,e,r,n):t.strategy===Z_FIXED$1||a===s?(send_bits(t,(STATIC_TREES<<1)+(n?1:0),3),compress_block(t,static_ltree,static_dtree)):(send_bits(t,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),compress_block(t,t.dyn_ltree,t.dyn_dtree)),init_block(t),n&&bi_windup(t)},_tr_tally$1=(t,e,r)=>(t.pending_buf[t.d_buf+t.last_lit*2]=e>>>8&255,t.pending_buf[t.d_buf+t.last_lit*2+1]=e&255,t.pending_buf[t.l_buf+t.last_lit]=r&255,t.last_lit++,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(_length_code[r]+LITERALS$1+1)*2]++,t.dyn_dtree[d_code(e)*2]++),t.last_lit===t.lit_bufsize-1);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(t,e,r,n)=>{let s=t&65535|0,a=t>>>16&65535|0,o=0;for(;r!==0;){o=r>2e3?2e3:r,r-=o;do s=s+e[n++]|0,a=a+s|0;while(--o);s%=65521,a%=65521}return s|a<<16|0};var adler32_1=adler32;const makeTable=()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},crcTable$1=new Uint32Array(makeTable()),crc32=(t,e,r,n)=>{const s=crcTable$1,a=n+r;t^=-1;for(let o=n;o<a;o++)t=t>>>8^s[(t^e[o])&255];return t^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(t,e)=>(t.msg=messages[e],e),rank=t=>(t<<1)-(t>4?9:0),zero=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let HASH_ZLIB=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask,HASH=HASH_ZLIB;const flush_pending=t=>{const e=t.state;let r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},flush_block_only=(t,e)=>{_tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,flush_pending(t.strm)},put_byte=(t,e)=>{t.pending_buf[t.pending++]=e},putShortMSB=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},read_buf=(t,e,r,n)=>{let s=t.avail_in;return s>n&&(s=n),s===0?0:(t.avail_in-=s,e.set(t.input.subarray(t.next_in,t.next_in+s),r),t.state.wrap===1?t.adler=adler32_1(t.adler,e,s,r):t.state.wrap===2&&(t.adler=crc32_1(t.adler,e,s,r)),t.next_in+=s,t.total_in+=s,s)},longest_match=(t,e)=>{let r=t.max_chain_length,n=t.strstart,s,a,o=t.prev_length,l=t.nice_match;const f=t.strstart>t.w_size-MIN_LOOKAHEAD?t.strstart-(t.w_size-MIN_LOOKAHEAD):0,h=t.window,c=t.w_mask,u=t.prev,g=t.strstart+MAX_MATCH;let d=h[n+o-1],p=h[n+o];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do if(s=e,!(h[s+o]!==p||h[s+o-1]!==d||h[s]!==h[n]||h[++s]!==h[n+1])){n+=2,s++;do;while(h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&h[++n]===h[++s]&&n<g);if(a=MAX_MATCH-(g-n),n=g-MAX_MATCH,a>o){if(t.match_start=e,o=a,a>=l)break;d=h[n+o-1],p=h[n+o]}}while((e=u[e&c])>f&&--r!==0);return o<=t.lookahead?o:t.lookahead},fill_window=t=>{const e=t.w_size;let r,n,s,a,o;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-MIN_LOOKAHEAD)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,n=t.hash_size,r=n;do s=t.head[--r],t.head[r]=s>=e?s-e:0;while(--n);n=e,r=n;do s=t.prev[--r],t.prev[r]=s>=e?s-e:0;while(--n);a+=e}if(t.strm.avail_in===0)break;if(n=read_buf(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=n,t.lookahead+t.insert>=MIN_MATCH)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=HASH(t,t.ins_h,t.window[o+1]);t.insert&&(t.ins_h=HASH(t,t.ins_h,t.window[o+MIN_MATCH-1]),t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<MIN_MATCH)););}while(t.lookahead<MIN_LOOKAHEAD&&t.strm.avail_in!==0)},deflate_stored=(t,e)=>{let r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(fill_window(t),t.lookahead===0&&e===Z_NO_FLUSH$2)return BS_NEED_MORE;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;const n=t.block_start+r;if((t.strstart===0||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,flush_block_only(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-MIN_LOOKAHEAD&&(flush_block_only(t,!1),t.strm.avail_out===0))return BS_NEED_MORE}return t.insert=0,e===Z_FINISH$3?(flush_block_only(t,!0),t.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):(t.strstart>t.block_start&&(flush_block_only(t,!1),t.strm.avail_out===0),BS_NEED_MORE)},deflate_fast=(t,e)=>{let r,n;for(;;){if(t.lookahead<MIN_LOOKAHEAD){if(fill_window(t),t.lookahead<MIN_LOOKAHEAD&&e===Z_NO_FLUSH$2)return BS_NEED_MORE;if(t.lookahead===0)break}if(r=0,t.lookahead>=MIN_MATCH&&(t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+MIN_MATCH-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-MIN_LOOKAHEAD&&(t.match_length=longest_match(t,r)),t.match_length>=MIN_MATCH)if(n=_tr_tally(t,t.strstart-t.match_start,t.match_length-MIN_MATCH),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=MIN_MATCH){t.match_length--;do t.strstart++,t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+MIN_MATCH-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+1]);else n=_tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(flush_block_only(t,!1),t.strm.avail_out===0))return BS_NEED_MORE}return t.insert=t.strstart<MIN_MATCH-1?t.strstart:MIN_MATCH-1,e===Z_FINISH$3?(flush_block_only(t,!0),t.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),t.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(t,e)=>{let r,n,s;for(;;){if(t.lookahead<MIN_LOOKAHEAD){if(fill_window(t),t.lookahead<MIN_LOOKAHEAD&&e===Z_NO_FLUSH$2)return BS_NEED_MORE;if(t.lookahead===0)break}if(r=0,t.lookahead>=MIN_MATCH&&(t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+MIN_MATCH-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=MIN_MATCH-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-MIN_LOOKAHEAD&&(t.match_length=longest_match(t,r),t.match_length<=5&&(t.strategy===Z_FILTERED||t.match_length===MIN_MATCH&&t.strstart-t.match_start>4096)&&(t.match_length=MIN_MATCH-1)),t.prev_length>=MIN_MATCH&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-MIN_MATCH,n=_tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-MIN_MATCH),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=s&&(t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+MIN_MATCH-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=MIN_MATCH-1,t.strstart++,n&&(flush_block_only(t,!1),t.strm.avail_out===0))return BS_NEED_MORE}else if(t.match_available){if(n=_tr_tally(t,0,t.window[t.strstart-1]),n&&flush_block_only(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return BS_NEED_MORE}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=_tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<MIN_MATCH-1?t.strstart:MIN_MATCH-1,e===Z_FINISH$3?(flush_block_only(t,!0),t.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),t.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(t,e)=>{let r,n,s,a;const o=t.window;for(;;){if(t.lookahead<=MAX_MATCH){if(fill_window(t),t.lookahead<=MAX_MATCH&&e===Z_NO_FLUSH$2)return BS_NEED_MORE;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=MIN_MATCH&&t.strstart>0&&(s=t.strstart-1,n=o[s],n===o[++s]&&n===o[++s]&&n===o[++s])){a=t.strstart+MAX_MATCH;do;while(n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&s<a);t.match_length=MAX_MATCH-(a-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=MIN_MATCH?(r=_tr_tally(t,1,t.match_length-MIN_MATCH),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=_tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(flush_block_only(t,!1),t.strm.avail_out===0))return BS_NEED_MORE}return t.insert=0,e===Z_FINISH$3?(flush_block_only(t,!0),t.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),t.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(t,e)=>{let r;for(;;){if(t.lookahead===0&&(fill_window(t),t.lookahead===0)){if(e===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(t.match_length=0,r=_tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(flush_block_only(t,!1),t.strm.avail_out===0))return BS_NEED_MORE}return t.insert=0,e===Z_FINISH$3?(flush_block_only(t,!0),t.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),t.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(t,e,r,n,s){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=s}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=t=>{t.window_size=2*t.w_size,zero(t.head),t.max_lazy_match=configuration_table[t.level].max_lazy,t.good_match=configuration_table[t.level].good_length,t.nice_match=configuration_table[t.level].nice_length,t.max_chain_length=configuration_table[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=MIN_MATCH-1,t.match_available=0,t.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateResetKeep=t=>{if(!t||!t.state)return err(t,Z_STREAM_ERROR$2);t.total_in=t.total_out=0,t.data_type=Z_UNKNOWN;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?INIT_STATE:BUSY_STATE,t.adler=e.wrap===2?0:1,e.last_flush=Z_NO_FLUSH$2,_tr_init(e),Z_OK$3},deflateReset=t=>{const e=deflateResetKeep(t);return e===Z_OK$3&&lm_init(t.state),e},deflateSetHeader=(t,e)=>!t||!t.state||t.state.wrap!==2?Z_STREAM_ERROR$2:(t.state.gzhead=e,Z_OK$3),deflateInit2=(t,e,r,n,s,a)=>{if(!t)return Z_STREAM_ERROR$2;let o=1;if(e===Z_DEFAULT_COMPRESSION$1&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>MAX_MEM_LEVEL||r!==Z_DEFLATED$2||n<8||n>15||e<0||e>9||a<0||a>Z_FIXED)return err(t,Z_STREAM_ERROR$2);n===8&&(n=9);const l=new DeflateState;return t.state=l,l.strm=t,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+MIN_MATCH-1)/MIN_MATCH),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=(1+2)*l.lit_bufsize,l.level=e,l.strategy=a,l.method=r,deflateReset(t)},deflateInit=(t,e)=>deflateInit2(t,e,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(t,e)=>{let r,n;if(!t||!t.state||e>Z_BLOCK$1||e<0)return t?err(t,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const s=t.state;if(!t.output||!t.input&&t.avail_in!==0||s.status===FINISH_STATE&&e!==Z_FINISH$3)return err(t,t.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);s.strm=t;const a=s.last_flush;if(s.last_flush=e,s.status===INIT_STATE)if(s.wrap===2)t.adler=0,put_byte(s,31),put_byte(s,139),put_byte(s,8),s.gzhead?(put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),put_byte(s,s.gzhead.time&255),put_byte(s,s.gzhead.time>>8&255),put_byte(s,s.gzhead.time>>16&255),put_byte(s,s.gzhead.time>>24&255),put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,s.gzhead.os&255),s.gzhead.extra&&s.gzhead.extra.length&&(put_byte(s,s.gzhead.extra.length&255),put_byte(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=crc32_1(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=EXTRA_STATE):(put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,OS_CODE),s.status=BUSY_STATE);else{let o=Z_DEFLATED$2+(s.w_bits-8<<4)<<8,l=-1;s.strategy>=Z_HUFFMAN_ONLY||s.level<2?l=0:s.level<6?l=1:s.level===6?l=2:l=3,o|=l<<6,s.strstart!==0&&(o|=PRESET_DICT),o+=31-o%31,s.status=BUSY_STATE,putShortMSB(s,o),s.strstart!==0&&(putShortMSB(s,t.adler>>>16),putShortMSB(s,t.adler&65535)),t.adler=1}if(s.status===EXTRA_STATE)if(s.gzhead.extra){for(r=s.pending;s.gzindex<(s.gzhead.extra.length&65535)&&!(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(t.adler=crc32_1(t.adler,s.pending_buf,s.pending-r,r)),flush_pending(t),r=s.pending,s.pending===s.pending_buf_size));)put_byte(s,s.gzhead.extra[s.gzindex]&255),s.gzindex++;s.gzhead.hcrc&&s.pending>r&&(t.adler=crc32_1(t.adler,s.pending_buf,s.pending-r,r)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=NAME_STATE)}else s.status=NAME_STATE;if(s.status===NAME_STATE)if(s.gzhead.name){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(t.adler=crc32_1(t.adler,s.pending_buf,s.pending-r,r)),flush_pending(t),r=s.pending,s.pending===s.pending_buf_size)){n=1;break}s.gzindex<s.gzhead.name.length?n=s.gzhead.name.charCodeAt(s.gzindex++)&255:n=0,put_byte(s,n)}while(n!==0);s.gzhead.hcrc&&s.pending>r&&(t.adler=crc32_1(t.adler,s.pending_buf,s.pending-r,r)),n===0&&(s.gzindex=0,s.status=COMMENT_STATE)}else s.status=COMMENT_STATE;if(s.status===COMMENT_STATE)if(s.gzhead.comment){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(t.adler=crc32_1(t.adler,s.pending_buf,s.pending-r,r)),flush_pending(t),r=s.pending,s.pending===s.pending_buf_size)){n=1;break}s.gzindex<s.gzhead.comment.length?n=s.gzhead.comment.charCodeAt(s.gzindex++)&255:n=0,put_byte(s,n)}while(n!==0);s.gzhead.hcrc&&s.pending>r&&(t.adler=crc32_1(t.adler,s.pending_buf,s.pending-r,r)),n===0&&(s.status=HCRC_STATE)}else s.status=HCRC_STATE;if(s.status===HCRC_STATE&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&flush_pending(t),s.pending+2<=s.pending_buf_size&&(put_byte(s,t.adler&255),put_byte(s,t.adler>>8&255),t.adler=0,s.status=BUSY_STATE)):s.status=BUSY_STATE),s.pending!==0){if(flush_pending(t),t.avail_out===0)return s.last_flush=-1,Z_OK$3}else if(t.avail_in===0&&rank(e)<=rank(a)&&e!==Z_FINISH$3)return err(t,Z_BUF_ERROR$1);if(s.status===FINISH_STATE&&t.avail_in!==0)return err(t,Z_BUF_ERROR$1);if(t.avail_in!==0||s.lookahead!==0||e!==Z_NO_FLUSH$2&&s.status!==FINISH_STATE){let o=s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,e):s.strategy===Z_RLE?deflate_rle(s,e):configuration_table[s.level].func(s,e);if((o===BS_FINISH_STARTED||o===BS_FINISH_DONE)&&(s.status=FINISH_STATE),o===BS_NEED_MORE||o===BS_FINISH_STARTED)return t.avail_out===0&&(s.last_flush=-1),Z_OK$3;if(o===BS_BLOCK_DONE&&(e===Z_PARTIAL_FLUSH?_tr_align(s):e!==Z_BLOCK$1&&(_tr_stored_block(s,0,0,!1),e===Z_FULL_FLUSH$1&&(zero(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),flush_pending(t),t.avail_out===0))return s.last_flush=-1,Z_OK$3}return e!==Z_FINISH$3?Z_OK$3:s.wrap<=0?Z_STREAM_END$3:(s.wrap===2?(put_byte(s,t.adler&255),put_byte(s,t.adler>>8&255),put_byte(s,t.adler>>16&255),put_byte(s,t.adler>>24&255),put_byte(s,t.total_in&255),put_byte(s,t.total_in>>8&255),put_byte(s,t.total_in>>16&255),put_byte(s,t.total_in>>24&255)):(putShortMSB(s,t.adler>>>16),putShortMSB(s,t.adler&65535)),flush_pending(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=t=>{if(!t||!t.state)return Z_STREAM_ERROR$2;const e=t.state.status;return e!==INIT_STATE&&e!==EXTRA_STATE&&e!==NAME_STATE&&e!==COMMENT_STATE&&e!==HCRC_STATE&&e!==BUSY_STATE&&e!==FINISH_STATE?err(t,Z_STREAM_ERROR$2):(t.state=null,e===BUSY_STATE?err(t,Z_DATA_ERROR$2):Z_OK$3)},deflateSetDictionary=(t,e)=>{let r=e.length;if(!t||!t.state)return Z_STREAM_ERROR$2;const n=t.state,s=n.wrap;if(s===2||s===1&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(s===1&&(t.adler=adler32_1(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){s===0&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let f=new Uint8Array(n.w_size);f.set(e.subarray(r-n.w_size,r),0),e=f,r=n.w_size}const a=t.avail_in,o=t.next_in,l=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,fill_window(n);n.lookahead>=MIN_MATCH;){let f=n.strstart,h=n.lookahead-(MIN_MATCH-1);do n.ins_h=HASH(n,n.ins_h,n.window[f+MIN_MATCH-1]),n.prev[f&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=f,f++;while(--h);n.strstart=f,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,t.next_in=o,t.input=l,t.avail_in=a,n.wrap=s,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var assign=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const r=e.shift();if(!!r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)_has(r,n)&&(t[n]=r[n])}}return t},flattenChunks=t=>{let e=0;for(let n=0,s=t.length;n<s;n++)e+=t[n].length;const r=new Uint8Array(e);for(let n=0,s=0,a=t.length;n<a;n++){let o=t[n];r.set(o,s),s+=o.length}return r},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let t=0;t<256;t++)_utf8len[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,n,s,a,o=t.length,l=0;for(s=0;s<o;s++)r=t.charCodeAt(s),(r&64512)===55296&&s+1<o&&(n=t.charCodeAt(s+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),s++)),l+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(l),a=0,s=0;a<l;s++)r=t.charCodeAt(s),(r&64512)===55296&&s+1<o&&(n=t.charCodeAt(s+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),s++)),r<128?e[a++]=r:r<2048?(e[a++]=192|r>>>6,e[a++]=128|r&63):r<65536?(e[a++]=224|r>>>12,e[a++]=128|r>>>6&63,e[a++]=128|r&63):(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63,e[a++]=128|r>>>6&63,e[a++]=128|r&63);return e};const buf2binstring=(t,e)=>{if(e<65534&&t.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r};var buf2string=(t,e)=>{const r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let n,s;const a=new Array(r*2);for(s=0,n=0;n<r;){let o=t[n++];if(o<128){a[s++]=o;continue}let l=_utf8len[o];if(l>4){a[s++]=65533,n+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&n<r;)o=o<<6|t[n++]&63,l--;if(l>1){a[s++]=65533;continue}o<65536?a[s++]=o:(o-=65536,a[s++]=55296|o>>10&1023,a[s++]=56320|o&1023)}return buf2binstring(a,s)},utf8border=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)===128;)r--;return r<0||r===0?e:r+_utf8len[t[r]]>e?r:e},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(t){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let r=deflate_1$2.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Z_OK$2)throw new Error(messages[r]);if(e.header&&deflate_1$2.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=strings.string2buf(e.dictionary):toString$1$1.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,r=deflate_1$2.deflateSetDictionary(this.strm,n),r!==Z_OK$2)throw new Error(messages[r]);this._dict_set=!0}}Deflate$1.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize;let s,a;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof t=="string"?r.input=strings.string2buf(t):toString$1$1.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(a===Z_SYNC_FLUSH||a===Z_FULL_FLUSH)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(s=deflate_1$2.deflate(r,a),s===Z_STREAM_END$2)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),s=deflate_1$2.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Z_OK$2;if(r.avail_out===0){this.onData(r.output);continue}if(a>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(t){this.chunks.push(t)};Deflate$1.prototype.onEnd=function(t){t===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function deflate$1(t,e){const r=new Deflate$1(e);if(r.push(t,!0),r.err)throw r.msg||messages[r.err];return r.result}function deflateRaw$1(t,e){return e=e||{},e.raw=!0,deflate$1(t,e)}function gzip$1(t,e){return e=e||{},e.gzip=!0,deflate$1(t,e)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1=constants$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1};const BAD$1=30,TYPE$1=12;var inffast=function(e,r){let n,s,a,o,l,f,h,c,u,g,d,p,x,y,m,A,b,_,E,T,I,v,k,w;const M=e.state;n=e.next_in,k=e.input,s=n+(e.avail_in-5),a=e.next_out,w=e.output,o=a-(r-e.avail_out),l=a+(e.avail_out-257),f=M.dmax,h=M.wsize,c=M.whave,u=M.wnext,g=M.window,d=M.hold,p=M.bits,x=M.lencode,y=M.distcode,m=(1<<M.lenbits)-1,A=(1<<M.distbits)-1;e:do{p<15&&(d+=k[n++]<<p,p+=8,d+=k[n++]<<p,p+=8),b=x[d&m];t:for(;;){if(_=b>>>24,d>>>=_,p-=_,_=b>>>16&255,_===0)w[a++]=b&65535;else if(_&16){E=b&65535,_&=15,_&&(p<_&&(d+=k[n++]<<p,p+=8),E+=d&(1<<_)-1,d>>>=_,p-=_),p<15&&(d+=k[n++]<<p,p+=8,d+=k[n++]<<p,p+=8),b=y[d&A];r:for(;;){if(_=b>>>24,d>>>=_,p-=_,_=b>>>16&255,_&16){if(T=b&65535,_&=15,p<_&&(d+=k[n++]<<p,p+=8,p<_&&(d+=k[n++]<<p,p+=8)),T+=d&(1<<_)-1,T>f){e.msg="invalid distance too far back",M.mode=BAD$1;break e}if(d>>>=_,p-=_,_=a-o,T>_){if(_=T-_,_>c&&M.sane){e.msg="invalid distance too far back",M.mode=BAD$1;break e}if(I=0,v=g,u===0){if(I+=h-_,_<E){E-=_;do w[a++]=g[I++];while(--_);I=a-T,v=w}}else if(u<_){if(I+=h+u-_,_-=u,_<E){E-=_;do w[a++]=g[I++];while(--_);if(I=0,u<E){_=u,E-=_;do w[a++]=g[I++];while(--_);I=a-T,v=w}}}else if(I+=u-_,_<E){E-=_;do w[a++]=g[I++];while(--_);I=a-T,v=w}for(;E>2;)w[a++]=v[I++],w[a++]=v[I++],w[a++]=v[I++],E-=3;E&&(w[a++]=v[I++],E>1&&(w[a++]=v[I++]))}else{I=a-T;do w[a++]=w[I++],w[a++]=w[I++],w[a++]=w[I++],E-=3;while(E>2);E&&(w[a++]=w[I++],E>1&&(w[a++]=w[I++]))}}else if((_&64)===0){b=y[(b&65535)+(d&(1<<_)-1)];continue r}else{e.msg="invalid distance code",M.mode=BAD$1;break e}break}}else if((_&64)===0){b=x[(b&65535)+(d&(1<<_)-1)];continue t}else if(_&32){M.mode=TYPE$1;break e}else{e.msg="invalid literal/length code",M.mode=BAD$1;break e}break}}while(n<s&&a<l);E=p>>3,n-=E,p-=E<<3,d&=(1<<p)-1,e.next_in=n,e.next_out=a,e.avail_in=n<s?5+(s-n):5-(n-s),e.avail_out=a<l?257+(l-a):257-(a-l),M.hold=d,M.bits=p};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(t,e,r,n,s,a,o,l)=>{const f=l.bits;let h=0,c=0,u=0,g=0,d=0,p=0,x=0,y=0,m=0,A=0,b,_,E,T,I,v=null,k=0,w;const M=new Uint16Array(MAXBITS+1),D=new Uint16Array(MAXBITS+1);let R=null,F=0,P,H,Z;for(h=0;h<=MAXBITS;h++)M[h]=0;for(c=0;c<n;c++)M[e[r+c]]++;for(d=f,g=MAXBITS;g>=1&&M[g]===0;g--);if(d>g&&(d=g),g===0)return s[a++]=1<<24|64<<16|0,s[a++]=1<<24|64<<16|0,l.bits=1,0;for(u=1;u<g&&M[u]===0;u++);for(d<u&&(d=u),y=1,h=1;h<=MAXBITS;h++)if(y<<=1,y-=M[h],y<0)return-1;if(y>0&&(t===CODES$1||g!==1))return-1;for(D[1]=0,h=1;h<MAXBITS;h++)D[h+1]=D[h]+M[h];for(c=0;c<n;c++)e[r+c]!==0&&(o[D[e[r+c]]++]=c);if(t===CODES$1?(v=R=o,w=19):t===LENS$1?(v=lbase,k-=257,R=lext,F-=257,w=256):(v=dbase,R=dext,w=-1),A=0,c=0,h=u,I=a,p=d,x=0,E=-1,m=1<<d,T=m-1,t===LENS$1&&m>ENOUGH_LENS$1||t===DISTS$1&&m>ENOUGH_DISTS$1)return 1;for(;;){P=h-x,o[c]<w?(H=0,Z=o[c]):o[c]>w?(H=R[F+o[c]],Z=v[k+o[c]]):(H=32+64,Z=0),b=1<<h-x,_=1<<p,u=_;do _-=b,s[I+(A>>x)+_]=P<<24|H<<16|Z|0;while(_!==0);for(b=1<<h-1;A&b;)b>>=1;if(b!==0?(A&=b-1,A+=b):A=0,c++,--M[h]===0){if(h===g)break;h=e[r+o[c]]}if(h>d&&(A&T)!==E){for(x===0&&(x=d),I+=u,p=h-x,y=1<<p;p+x<g&&(y-=M[p+x],!(y<=0));)p++,y<<=1;if(m+=1<<p,t===LENS$1&&m>ENOUGH_LENS$1||t===DISTS$1&&m>ENOUGH_DISTS$1)return 1;E=A&T,s[E]=d<<24|p<<16|I-a|0}}return A!==0&&(s[I+A]=h-x<<24|64<<16|0),l.bits=d,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateResetKeep=t=>{if(!t||!t.state)return Z_STREAM_ERROR$1;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=HEAD,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(ENOUGH_LENS),e.distcode=e.distdyn=new Int32Array(ENOUGH_DISTS),e.sane=1,e.back=-1,Z_OK$1},inflateReset=t=>{if(!t||!t.state)return Z_STREAM_ERROR$1;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,inflateResetKeep(t)},inflateReset2=(t,e)=>{let r;if(!t||!t.state)return Z_STREAM_ERROR$1;const n=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?Z_STREAM_ERROR$1:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,inflateReset(t))},inflateInit2=(t,e)=>{if(!t)return Z_STREAM_ERROR$1;const r=new InflateState;t.state=r,r.window=null;const n=inflateReset2(t,e);return n!==Z_OK$1&&(t.state=null),n},inflateInit=t=>inflateInit2(t,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=t=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(inftrees(LENS,t.lens,0,288,lenfix,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;inftrees(DISTS,t.lens,0,32,distfix,0,t.work,{bits:5}),virgin=!1}t.lencode=lenfix,t.lenbits=9,t.distcode=distfix,t.distbits=5},updatewindow=(t,e,r,n)=>{let s;const a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(e.subarray(r-a.wsize,r),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>n&&(s=n),a.window.set(e.subarray(r-n,r-n+s),a.wnext),n-=s,n?(a.window.set(e.subarray(r-n,r),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0},inflate$2=(t,e)=>{let r,n,s,a,o,l,f,h,c,u,g,d,p,x,y=0,m,A,b,_,E,T,I,v;const k=new Uint8Array(4);let w,M;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&t.avail_in!==0)return Z_STREAM_ERROR$1;r=t.state,r.mode===TYPE&&(r.mode=TYPEDO),o=t.next_out,s=t.output,f=t.avail_out,a=t.next_in,n=t.input,l=t.avail_in,h=r.hold,c=r.bits,u=l,g=f,v=Z_OK$1;e:for(;;)switch(r.mode){case HEAD:if(r.wrap===0){r.mode=TYPEDO;break}for(;c<16;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}if(r.wrap&2&&h===35615){r.check=0,k[0]=h&255,k[1]=h>>>8&255,r.check=crc32_1(r.check,k,2,0),h=0,c=0,r.mode=FLAGS;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((h&255)<<8)+(h>>8))%31){t.msg="incorrect header check",r.mode=BAD;break}if((h&15)!==Z_DEFLATED){t.msg="unknown compression method",r.mode=BAD;break}if(h>>>=4,c-=4,I=(h&15)+8,r.wbits===0)r.wbits=I;else if(I>r.wbits){t.msg="invalid window size",r.mode=BAD;break}r.dmax=1<<r.wbits,t.adler=r.check=1,r.mode=h&512?DICTID:TYPE,h=0,c=0;break;case FLAGS:for(;c<16;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}if(r.flags=h,(r.flags&255)!==Z_DEFLATED){t.msg="unknown compression method",r.mode=BAD;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=BAD;break}r.head&&(r.head.text=h>>8&1),r.flags&512&&(k[0]=h&255,k[1]=h>>>8&255,r.check=crc32_1(r.check,k,2,0)),h=0,c=0,r.mode=TIME;case TIME:for(;c<32;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}r.head&&(r.head.time=h),r.flags&512&&(k[0]=h&255,k[1]=h>>>8&255,k[2]=h>>>16&255,k[3]=h>>>24&255,r.check=crc32_1(r.check,k,4,0)),h=0,c=0,r.mode=OS;case OS:for(;c<16;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}r.head&&(r.head.xflags=h&255,r.head.os=h>>8),r.flags&512&&(k[0]=h&255,k[1]=h>>>8&255,r.check=crc32_1(r.check,k,2,0)),h=0,c=0,r.mode=EXLEN;case EXLEN:if(r.flags&1024){for(;c<16;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}r.length=h,r.head&&(r.head.extra_len=h),r.flags&512&&(k[0]=h&255,k[1]=h>>>8&255,r.check=crc32_1(r.check,k,2,0)),h=0,c=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(r.flags&1024&&(d=r.length,d>l&&(d=l),d&&(r.head&&(I=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(a,a+d),I)),r.flags&512&&(r.check=crc32_1(r.check,n,d,a)),l-=d,a+=d,r.length-=d),r.length))break e;r.length=0,r.mode=NAME;case NAME:if(r.flags&2048){if(l===0)break e;d=0;do I=n[a+d++],r.head&&I&&r.length<65536&&(r.head.name+=String.fromCharCode(I));while(I&&d<l);if(r.flags&512&&(r.check=crc32_1(r.check,n,d,a)),l-=d,a+=d,I)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(r.flags&4096){if(l===0)break e;d=0;do I=n[a+d++],r.head&&I&&r.length<65536&&(r.head.comment+=String.fromCharCode(I));while(I&&d<l);if(r.flags&512&&(r.check=crc32_1(r.check,n,d,a)),l-=d,a+=d,I)break e}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(r.flags&512){for(;c<16;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}if(h!==(r.check&65535)){t.msg="header crc mismatch",r.mode=BAD;break}h=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=TYPE;break;case DICTID:for(;c<32;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}t.adler=r.check=zswap32(h),h=0,c=0,r.mode=DICT;case DICT:if(r.havedict===0)return t.next_out=o,t.avail_out=f,t.next_in=a,t.avail_in=l,r.hold=h,r.bits=c,Z_NEED_DICT$1;t.adler=r.check=1,r.mode=TYPE;case TYPE:if(e===Z_BLOCK||e===Z_TREES)break e;case TYPEDO:if(r.last){h>>>=c&7,c-=c&7,r.mode=CHECK;break}for(;c<3;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}switch(r.last=h&1,h>>>=1,c-=1,h&3){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,e===Z_TREES){h>>>=2,c-=2;break e}break;case 2:r.mode=TABLE;break;case 3:t.msg="invalid block type",r.mode=BAD}h>>>=2,c-=2;break;case STORED:for(h>>>=c&7,c-=c&7;c<32;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}if((h&65535)!==(h>>>16^65535)){t.msg="invalid stored block lengths",r.mode=BAD;break}if(r.length=h&65535,h=0,c=0,r.mode=COPY_,e===Z_TREES)break e;case COPY_:r.mode=COPY;case COPY:if(d=r.length,d){if(d>l&&(d=l),d>f&&(d=f),d===0)break e;s.set(n.subarray(a,a+d),o),l-=d,a+=d,f-=d,o+=d,r.length-=d;break}r.mode=TYPE;break;case TABLE:for(;c<14;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}if(r.nlen=(h&31)+257,h>>>=5,c-=5,r.ndist=(h&31)+1,h>>>=5,c-=5,r.ncode=(h&15)+4,h>>>=4,c-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=BAD;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;c<3;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}r.lens[D[r.have++]]=h&7,h>>>=3,c-=3}for(;r.have<19;)r.lens[D[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,w={bits:r.lenbits},v=inftrees(CODES,r.lens,0,19,r.lencode,0,r.work,w),r.lenbits=w.bits,v){t.msg="invalid code lengths set",r.mode=BAD;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;y=r.lencode[h&(1<<r.lenbits)-1],m=y>>>24,A=y>>>16&255,b=y&65535,!(m<=c);){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}if(b<16)h>>>=m,c-=m,r.lens[r.have++]=b;else{if(b===16){for(M=m+2;c<M;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}if(h>>>=m,c-=m,r.have===0){t.msg="invalid bit length repeat",r.mode=BAD;break}I=r.lens[r.have-1],d=3+(h&3),h>>>=2,c-=2}else if(b===17){for(M=m+3;c<M;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}h>>>=m,c-=m,I=0,d=3+(h&7),h>>>=3,c-=3}else{for(M=m+7;c<M;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}h>>>=m,c-=m,I=0,d=11+(h&127),h>>>=7,c-=7}if(r.have+d>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=BAD;break}for(;d--;)r.lens[r.have++]=I}}if(r.mode===BAD)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=BAD;break}if(r.lenbits=9,w={bits:r.lenbits},v=inftrees(LENS,r.lens,0,r.nlen,r.lencode,0,r.work,w),r.lenbits=w.bits,v){t.msg="invalid literal/lengths set",r.mode=BAD;break}if(r.distbits=6,r.distcode=r.distdyn,w={bits:r.distbits},v=inftrees(DISTS,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,w),r.distbits=w.bits,v){t.msg="invalid distances set",r.mode=BAD;break}if(r.mode=LEN_,e===Z_TREES)break e;case LEN_:r.mode=LEN;case LEN:if(l>=6&&f>=258){t.next_out=o,t.avail_out=f,t.next_in=a,t.avail_in=l,r.hold=h,r.bits=c,inffast(t,g),o=t.next_out,s=t.output,f=t.avail_out,a=t.next_in,n=t.input,l=t.avail_in,h=r.hold,c=r.bits,r.mode===TYPE&&(r.back=-1);break}for(r.back=0;y=r.lencode[h&(1<<r.lenbits)-1],m=y>>>24,A=y>>>16&255,b=y&65535,!(m<=c);){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}if(A&&(A&240)===0){for(_=m,E=A,T=b;y=r.lencode[T+((h&(1<<_+E)-1)>>_)],m=y>>>24,A=y>>>16&255,b=y&65535,!(_+m<=c);){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}h>>>=_,c-=_,r.back+=_}if(h>>>=m,c-=m,r.back+=m,r.length=b,A===0){r.mode=LIT;break}if(A&32){r.back=-1,r.mode=TYPE;break}if(A&64){t.msg="invalid literal/length code",r.mode=BAD;break}r.extra=A&15,r.mode=LENEXT;case LENEXT:if(r.extra){for(M=r.extra;c<M;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;y=r.distcode[h&(1<<r.distbits)-1],m=y>>>24,A=y>>>16&255,b=y&65535,!(m<=c);){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}if((A&240)===0){for(_=m,E=A,T=b;y=r.distcode[T+((h&(1<<_+E)-1)>>_)],m=y>>>24,A=y>>>16&255,b=y&65535,!(_+m<=c);){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}h>>>=_,c-=_,r.back+=_}if(h>>>=m,c-=m,r.back+=m,A&64){t.msg="invalid distance code",r.mode=BAD;break}r.offset=b,r.extra=A&15,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(M=r.extra;c<M;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=BAD;break}r.mode=MATCH;case MATCH:if(f===0)break e;if(d=g-f,r.offset>d){if(d=r.offset-d,d>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=BAD;break}d>r.wnext?(d-=r.wnext,p=r.wsize-d):p=r.wnext-d,d>r.length&&(d=r.length),x=r.window}else x=s,p=o-r.offset,d=r.length;d>f&&(d=f),f-=d,r.length-=d;do s[o++]=x[p++];while(--d);r.length===0&&(r.mode=LEN);break;case LIT:if(f===0)break e;s[o++]=r.length,f--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;c<32;){if(l===0)break e;l--,h|=n[a++]<<c,c+=8}if(g-=f,t.total_out+=g,r.total+=g,g&&(t.adler=r.check=r.flags?crc32_1(r.check,s,g,o-g):adler32_1(r.check,s,g,o-g)),g=f,(r.flags?h:zswap32(h))!==r.check){t.msg="incorrect data check",r.mode=BAD;break}h=0,c=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;c<32;){if(l===0)break e;l--,h+=n[a++]<<c,c+=8}if(h!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=BAD;break}h=0,c=0}r.mode=DONE;case DONE:v=Z_STREAM_END$1;break e;case BAD:v=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return t.next_out=o,t.avail_out=f,t.next_in=a,t.avail_in=l,r.hold=h,r.bits=c,(r.wsize||g!==t.avail_out&&r.mode<BAD&&(r.mode<CHECK||e!==Z_FINISH$1))&&updatewindow(t,t.output,t.next_out,g-t.avail_out),u-=t.avail_in,g-=t.avail_out,t.total_in+=u,t.total_out+=g,r.total+=g,r.wrap&&g&&(t.adler=r.check=r.flags?crc32_1(r.check,s,g,t.next_out-g):adler32_1(r.check,s,g,t.next_out-g)),t.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(u===0&&g===0||e===Z_FINISH$1)&&v===Z_OK$1&&(v=Z_BUF_ERROR),v},inflateEnd=t=>{if(!t||!t.state)return Z_STREAM_ERROR$1;let e=t.state;return e.window&&(e.window=null),t.state=null,Z_OK$1},inflateGetHeader=(t,e)=>{if(!t||!t.state)return Z_STREAM_ERROR$1;const r=t.state;return(r.wrap&2)===0?Z_STREAM_ERROR$1:(r.head=e,e.done=!1,Z_OK$1)},inflateSetDictionary=(t,e)=>{const r=e.length;let n,s,a;return!t||!t.state||(n=t.state,n.wrap!==0&&n.mode!==DICT)?Z_STREAM_ERROR$1:n.mode===DICT&&(s=1,s=adler32_1(s,e,r,0),s!==n.check)?Z_DATA_ERROR$1:(a=updatewindow(t,e,r,r),a?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$2=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(t){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let r=inflate_1$2.inflateInit2(this.strm,e.windowBits);if(r!==Z_OK)throw new Error(messages[r]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=strings.string2buf(e.dictionary):toString$2.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=inflate_1$2.inflateSetDictionary(this.strm,e.dictionary),r!==Z_OK)))throw new Error(messages[r])}Inflate$1.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let a,o,l;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?Z_FINISH:Z_NO_FLUSH,toString$2.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),a=inflate_1$2.inflate(r,o),a===Z_NEED_DICT&&s&&(a=inflate_1$2.inflateSetDictionary(r,s),a===Z_OK?a=inflate_1$2.inflate(r,o):a===Z_DATA_ERROR&&(a=Z_NEED_DICT));r.avail_in>0&&a===Z_STREAM_END&&r.state.wrap>0&&t[r.next_in]!==0;)inflate_1$2.inflateReset(r),a=inflate_1$2.inflate(r,o);switch(a){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(a),this.ended=!0,!1}if(l=r.avail_out,r.next_out&&(r.avail_out===0||a===Z_STREAM_END))if(this.options.to==="string"){let f=strings.utf8border(r.output,r.next_out),h=r.next_out-f,c=strings.buf2string(r.output,f);r.next_out=h,r.avail_out=n-h,h&&r.output.set(r.output.subarray(f,f+h),0),this.onData(c)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(a===Z_OK&&l===0)){if(a===Z_STREAM_END)return a=inflate_1$2.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(t){this.chunks.push(t)};Inflate$1.prototype.onEnd=function(t){t===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function inflate$1(t,e){const r=new Inflate$1(e);if(r.push(t),r.err)throw r.msg||messages[r.err];return r.result}function inflateRaw$1(t,e){return e=e||{},e.raw=!0,inflate$1(t,e)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants=constants$2,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable=[];for(let t=0;t<256;t++){let e=t;for(let r=0;r<8;r++)e&1?e=3988292384^e>>>1:e=e>>>1;crcTable[t]=e}const initialCrc=4294967295;function updateCrc(t,e,r){let n=t;for(let s=0;s<r;s++)n=crcTable[(n^e[s])&255]^n>>>8;return n}function crc(t,e){return(updateCrc(initialCrc,t,e)^initialCrc)>>>0}var ColorType;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.GREYSCALE=0]="GREYSCALE",t[t.TRUECOLOUR=2]="TRUECOLOUR",t[t.INDEXED_COLOUR=3]="INDEXED_COLOUR",t[t.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",t[t.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.NO_INTERLACE=0]="NO_INTERLACE",t[t.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(e,r={}){super(e);const{checkCrc:n=!1}=r;this._checkCrc=n,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let e=0;e<pngSignature.length;e++)if(this.readUint8()!==pngSignature[e])throw new Error(`wrong PNG signature. Byte at ${e} should be ${pngSignature[e]}.`)}decodeChunk(){const e=this.readUint32(),r=this.readChars(4),n=this.offset;switch(r){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case"tEXt":this.decodetEXt(e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${r}`);if(this._checkCrc){const s=this.readUint32(),a=e+4,o=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-a-4,a),a);if(o!==s)throw new Error(`CRC mismatch for chunk ${r}. Expected ${s}, found ${o}`)}else this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=checkBitDepth(this.readUint8());const r=this.readUint8();this._colorType=r;let n;switch(r){case ColorType.GREYSCALE:n=1;break;case ColorType.TRUECOLOUR:n=3;break;case ColorType.INDEXED_COLOUR:n=1;break;case ColorType.GREYSCALE_ALPHA:n=2;break;case ColorType.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${r}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const r=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let s=0;s<r;s++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,e)),this.skip(e)}decodetRNS(e){if(this._colorType===3){if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let r=0;for(;r<e;r++){const n=this.readByte();this._palette[r].push(n)}for(;r<this._palette.length;r++)this._palette[r].push(255)}}decodeiCCP(e){let r="",n;for(;(n=this.readChar())!==NULL;)r+=n;const s=this.readUint8();if(s!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const a=this.readBytes(e-r.length-2);this._png.iccEmbeddedProfile={name:r,profile:inflate_1(a)}}decodetEXt(e){let r="",n;for(;(n=this.readChar())!==NULL;)r+=n;this._png.text[r]=this.readChars(e-r.length-1)}decodepHYs(){const e=this.readUint32(),r=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:r,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(e);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(e){const r=this._png.height,n=this._png.channels*this._png.depth/8,s=this._png.width*n,a=new Uint8Array(this._png.height*s);let o=empty,l=0,f,h;for(let c=0;c<r;c++){switch(f=e.subarray(l+1,l+1+s),h=a.subarray(c*s,(c+1)*s),e[l]){case 0:unfilterNone(f,h,s);break;case 1:unfilterSub(f,h,s,n);break;case 2:unfilterUp(f,h,o,s);break;case 3:unfilterAverage(f,h,o,s,n);break;case 4:unfilterPaeth(f,h,o,s,n);break;default:throw new Error(`Unsupported filter: ${e[l]}`)}o=h,l+=s+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const c=new Uint16Array(a.buffer);if(osIsLittleEndian)for(let u=0;u<c.length;u++)c[u]=swap16(c[u]);this._png.data=c}else this._png.data=a}}function unfilterNone(t,e,r){for(let n=0;n<r;n++)e[n]=t[n]}function unfilterSub(t,e,r,n){let s=0;for(;s<n;s++)e[s]=t[s];for(;s<r;s++)e[s]=t[s]+e[s-n]&255}function unfilterUp(t,e,r,n){let s=0;if(r.length===0)for(;s<n;s++)e[s]=t[s];else for(;s<n;s++)e[s]=t[s]+r[s]&255}function unfilterAverage(t,e,r,n,s){let a=0;if(r.length===0){for(;a<s;a++)e[a]=t[a];for(;a<n;a++)e[a]=t[a]+(e[a-s]>>1)&255}else{for(;a<s;a++)e[a]=t[a]+(r[a]>>1)&255;for(;a<n;a++)e[a]=t[a]+(e[a-s]+r[a]>>1)&255}}function unfilterPaeth(t,e,r,n,s){let a=0;if(r.length===0){for(;a<s;a++)e[a]=t[a];for(;a<n;a++)e[a]=t[a]+e[a-s]&255}else{for(;a<s;a++)e[a]=t[a]+r[a]&255;for(;a<n;a++)e[a]=t[a]+paethPredictor(e[a-s],r[a],r[a-s])&255}}function paethPredictor(t,e,r){const n=t+e-r,s=Math.abs(n-t),a=Math.abs(n-e),o=Math.abs(n-r);return s<=a&&s<=o?t:a<=o?e:r}function swap16(t){return(t&255)<<8|t>>8&255}function checkBitDepth(t){if(t!==1&&t!==2&&t!==4&&t!==8&&t!==16)throw new Error(`invalid bit depth: ${t}`);return t}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(e,r={}){super();this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,r.zlib),this._png=this._checkData(e),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(e){this.writeUint32(e.length),this.writeChars("IDAT"),this.writeBytes(e),this.writeCrc(e.length+4)}encodeData(){const{width:e,height:r,channels:n,depth:s,data:a}=this._png,o=n*e,l=new IOBuffer$4().setBigEndian();let f=0;for(let u=0;u<r;u++)if(l.writeByte(0),s===8)f=writeDataBytes(a,l,o,f);else if(s===16)f=writeDataUint16(a,l,o,f);else throw new Error("unreachable");const h=l.toArray(),c=deflate_1(h,this._zlibOptions);this.encodeIDAT(c)}_checkData(e){const{colorType:r,channels:n,depth:s}=getColorType(e),a={width:checkInteger(e.width,"width"),height:checkInteger(e.height,"height"),channels:n,data:e.data,depth:s,text:{}};this._colorType=r;const o=a.width*a.height*n;if(a.data.length!==o)throw new RangeError(`wrong data size. Found ${a.data.length}, expected ${o}`);return a}writeCrc(e){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-e,e),e))}}function checkInteger(t,e){if(Number.isInteger(t)&&t>0)return t;throw new TypeError(`${e} must be a positive integer`)}function getColorType(t){const{channels:e=4,depth:r=8}=t;if(e!==4&&e!==3&&e!==2&&e!==1)throw new RangeError(`unsupported number of channels: ${e}`);if(r!==8&&r!==16)throw new RangeError(`unsupported bit depth: ${r}`);const n={channels:e,depth:r,colorType:ColorType.UNKNOWN};switch(e){case 4:n.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:n.colorType=ColorType.TRUECOLOUR;break;case 1:n.colorType=ColorType.GREYSCALE;break;case 2:n.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return n}function writeDataBytes(t,e,r,n){for(let s=0;s<r;s++)e.writeByte(t[n++]);return n}function writeDataUint16(t,e,r,n){for(let s=0;s<r;s++)e.writeUint16(t[n++]);return n}var ResolutionUnitSpecifier;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(t,e){return new PngDecoder(t,e).decode()}function encodePng$1(t,e){return new PngEncoder(t,e).encode()}var encoder$1={exports:{}};(function(t){function e(n){var s=Math.floor,a=new Array(64),o=new Array(64),l=new Array(64),f=new Array(64),h,c,u,g,d=new Array(65535),p=new Array(65535),x=new Array(64),y=new Array(64),m=[],A=0,b=7,_=new Array(64),E=new Array(64),T=new Array(64),I=new Array(256),v=new Array(2048),k,w=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],M=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],D=[0,1,2,3,4,5,6,7,8,9,10,11],R=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],F=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],P=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],H=[0,1,2,3,4,5,6,7,8,9,10,11],Z=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],X=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ee(C){for(var re=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],oe=0;oe<64;oe++){var ae=s((re[oe]*C+50)/100);ae<1?ae=1:ae>255&&(ae=255),a[w[oe]]=ae}for(var fe=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],N=0;N<64;N++){var ve=s((fe[N]*C+50)/100);ve<1?ve=1:ve>255&&(ve=255),o[w[N]]=ve}for(var ue=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Q=0,J=0;J<8;J++)for(var V=0;V<8;V++)l[Q]=1/(a[w[Q]]*ue[J]*ue[V]*8),f[Q]=1/(o[w[Q]]*ue[J]*ue[V]*8),Q++}function G(C,re){for(var oe=0,ae=0,fe=new Array,N=1;N<=16;N++){for(var ve=1;ve<=C[N];ve++)fe[re[ae]]=[],fe[re[ae]][0]=oe,fe[re[ae]][1]=N,ae++,oe++;oe*=2}return fe}function se(){h=G(M,D),c=G(P,H),u=G(R,F),g=G(Z,X)}function ie(){for(var C=1,re=2,oe=1;oe<=15;oe++){for(var ae=C;ae<re;ae++)p[32767+ae]=oe,d[32767+ae]=[],d[32767+ae][1]=oe,d[32767+ae][0]=ae;for(var fe=-(re-1);fe<=-C;fe++)p[32767+fe]=oe,d[32767+fe]=[],d[32767+fe][1]=oe,d[32767+fe][0]=re-1+fe;C<<=1,re<<=1}}function Y(){for(var C=0;C<256;C++)v[C]=19595*C,v[C+256>>0]=38470*C,v[C+512>>0]=7471*C+32768,v[C+768>>0]=-11059*C,v[C+1024>>0]=-21709*C,v[C+1280>>0]=32768*C+8421375,v[C+1536>>0]=-27439*C,v[C+1792>>0]=-5329*C}function j(C){for(var re=C[0],oe=C[1]-1;oe>=0;)re&1<<oe&&(A|=1<<b),oe--,b--,b<0&&(A==255?(L(255),L(0)):L(A),b=7,A=0)}function L(C){m.push(C)}function W(C){L(C>>8&255),L(C&255)}function te(C,re){var oe,ae,fe,N,ve,ue,Q,J,V=0,be,we=8,_e=64;for(be=0;be<we;++be){oe=C[V],ae=C[V+1],fe=C[V+2],N=C[V+3],ve=C[V+4],ue=C[V+5],Q=C[V+6],J=C[V+7];var ne=oe+J,ce=oe-J,Me=ae+Q,Se=ae-Q,Ae=fe+ue,Ce=fe-ue,Ye=N+ve,He=N-ve,Pe=ne+Ye,Oe=ne-Ye,Ne=Me+Ae,Ue=Me-Ae;C[V]=Pe+Ne,C[V+4]=Pe-Ne;var Xe=(Ue+Oe)*.707106781;C[V+2]=Oe+Xe,C[V+6]=Oe-Xe,Pe=He+Ce,Ne=Ce+Se,Ue=Se+ce;var je=(Pe-Ue)*.382683433,Ve=.5411961*Pe+je,S=1.306562965*Ue+je,B=Ne*.707106781,$=ce+B,O=ce-B;C[V+5]=O+Ve,C[V+3]=O-Ve,C[V+1]=$+S,C[V+7]=$-S,V+=8}for(V=0,be=0;be<we;++be){oe=C[V],ae=C[V+8],fe=C[V+16],N=C[V+24],ve=C[V+32],ue=C[V+40],Q=C[V+48],J=C[V+56];var z=oe+J,q=oe-J,ke=ae+Q,Ee=ae-Q,Ie=fe+ue,De=fe-ue,Ze=N+ve,Te=N-ve,$e=z+Ze,Be=z-Ze,Fe=ke+Ie,Re=ke-Ie;C[V]=$e+Fe,C[V+32]=$e-Fe;var ze=(Re+Be)*.707106781;C[V+16]=Be+ze,C[V+48]=Be-ze,$e=Te+De,Fe=De+Ee,Re=Ee+q;var Ge=($e-Re)*.382683433,Le=.5411961*$e+Ge,Ke=1.306562965*Re+Ge,Qe=Fe*.707106781,Je=q+Qe,et=q-Qe;C[V+40]=et+Le,C[V+24]=et-Le,C[V+8]=Je+Ke,C[V+56]=Je-Ke,V++}var qe;for(be=0;be<_e;++be)qe=C[be]*re[be],x[be]=qe>0?qe+.5|0:qe-.5|0;return x}function de(){W(65504),W(16),L(74),L(70),L(73),L(70),L(0),L(1),L(1),L(0),W(1),W(1),L(0),L(0)}function le(C){if(!!C){W(65505),C[0]===69&&C[1]===120&&C[2]===105&&C[3]===102?W(C.length+2):(W(C.length+5+2),L(69),L(120),L(105),L(102),L(0));for(var re=0;re<C.length;re++)L(C[re])}}function ge(C,re){W(65472),W(17),L(8),W(re),W(C),L(3),L(1),L(17),L(0),L(2),L(17),L(1),L(3),L(17),L(1)}function xe(){W(65499),W(132),L(0);for(var C=0;C<64;C++)L(a[C]);L(1);for(var re=0;re<64;re++)L(o[re])}function ye(){W(65476),W(418),L(0);for(var C=0;C<16;C++)L(M[C+1]);for(var re=0;re<=11;re++)L(D[re]);L(16);for(var oe=0;oe<16;oe++)L(R[oe+1]);for(var ae=0;ae<=161;ae++)L(F[ae]);L(1);for(var fe=0;fe<16;fe++)L(P[fe+1]);for(var N=0;N<=11;N++)L(H[N]);L(17);for(var ve=0;ve<16;ve++)L(Z[ve+1]);for(var ue=0;ue<=161;ue++)L(X[ue])}function pe(){W(65498),W(12),L(3),L(1),L(0),L(2),L(17),L(3),L(17),L(0),L(63),L(0)}function K(C,re,oe,ae,fe){for(var N=fe[0],ve=fe[240],ue,Q=16,J=63,V=64,be=te(C,re),we=0;we<V;++we)y[w[we]]=be[we];var _e=y[0]-oe;oe=y[0],_e==0?j(ae[0]):(ue=32767+_e,j(ae[p[ue]]),j(d[ue]));for(var ne=63;ne>0&&y[ne]==0;ne--);if(ne==0)return j(N),oe;for(var ce=1,Me;ce<=ne;){for(var Se=ce;y[ce]==0&&ce<=ne;++ce);var Ae=ce-Se;if(Ae>=Q){Me=Ae>>4;for(var Ce=1;Ce<=Me;++Ce)j(ve);Ae=Ae&15}ue=32767+y[ce],j(fe[(Ae<<4)+p[ue]]),j(d[ue]),ce++}return ne!=J&&j(N),oe}function U(){for(var C=String.fromCharCode,re=0;re<256;re++)I[re]=C(re)}this.encode=function(C,re){new Date().getTime(),re&&me(re),m=new Array,A=0,b=7,W(65496),de(),le(C.exifBuffer),xe(),ge(C.width,C.height),ye(),pe();var oe=0,ae=0,fe=0;A=0,b=7,this.encode.displayName="_encode_";for(var N=C.data,ve=C.width,ue=C.height,Q=ve*4,J,V=0,be,we,_e,ne,ce,Me,Se,Ae;V<ue;){for(J=0;J<Q;){for(ne=Q*V+J,ce=ne,Me=-1,Se=0,Ae=0;Ae<64;Ae++)Se=Ae>>3,Me=(Ae&7)*4,ce=ne+Se*Q+Me,V+Se>=ue&&(ce-=Q*(V+1+Se-ue)),J+Me>=Q&&(ce-=J+Me-Q+4),be=N[ce++],we=N[ce++],_e=N[ce++],_[Ae]=(v[be]+v[we+256>>0]+v[_e+512>>0]>>16)-128,E[Ae]=(v[be+768>>0]+v[we+1024>>0]+v[_e+1280>>0]>>16)-128,T[Ae]=(v[be+1280>>0]+v[we+1536>>0]+v[_e+1792>>0]>>16)-128;oe=K(_,l,oe,h,u),ae=K(E,f,ae,c,g),fe=K(T,f,fe,c,g),J+=32}V+=8}if(b>=0){var Ce=[];Ce[1]=b+1,Ce[0]=(1<<b+1)-1,j(Ce)}return W(65497),Buffer.from(m)};function me(C){if(C<=0&&(C=1),C>100&&(C=100),k!=C){var re=0;C<50?re=Math.floor(5e3/C):re=Math.floor(200-C*2),ee(re),k=C}}function he(){var C=new Date().getTime();n||(n=50),U(),se(),ie(),Y(),me(n),new Date().getTime()-C}he()}t.exports=r;function r(n,s){typeof s=="undefined"&&(s=50);var a=new e(s),o=a.encode(n,s);return{data:o,width:n.width,height:n.height}}})(encoder$1);var decoder$1={exports:{}};(function(t){var e=function(){var s=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),a=4017,o=799,l=3406,f=2276,h=1567,c=3784,u=5793,g=2896;function d(){}function p(E,T){for(var I=0,v=[],k,w,M=16;M>0&&!E[M-1];)M--;v.push({children:[],index:0});var D=v[0],R;for(k=0;k<M;k++){for(w=0;w<E[k];w++){for(D=v.pop(),D.children[D.index]=T[I];D.index>0;){if(v.length===0)throw new Error("Could not recreate Huffman Table");D=v.pop()}for(D.index++,v.push(D);v.length<=k;)v.push(R={children:[],index:0}),D.children[D.index]=R.children,D=R;I++}k+1<M&&(v.push(R={children:[],index:0}),D.children[D.index]=R.children,D=R)}return v[0].children}function x(E,T,I,v,k,w,M,D,R,F){I.precision,I.samplesPerLine,I.scanLines;var P=I.mcusPerLine,H=I.progressive;I.maxH,I.maxV;var Z=T,X=0,ee=0;function G(){if(ee>0)return ee--,X>>ee&1;if(X=E[T++],X==255){var Q=E[T++];if(Q)throw new Error("unexpected marker: "+(X<<8|Q).toString(16))}return ee=7,X>>>7}function se(Q){for(var J=Q,V;(V=G())!==null;){if(J=J[V],typeof J=="number")return J;if(typeof J!="object")throw new Error("invalid huffman sequence")}return null}function ie(Q){for(var J=0;Q>0;){var V=G();if(V===null)return;J=J<<1|V,Q--}return J}function Y(Q){var J=ie(Q);return J>=1<<Q-1?J:J+(-1<<Q)+1}function j(Q,J){var V=se(Q.huffmanTableDC),be=V===0?0:Y(V);J[0]=Q.pred+=be;for(var we=1;we<64;){var _e=se(Q.huffmanTableAC),ne=_e&15,ce=_e>>4;if(ne===0){if(ce<15)break;we+=16;continue}we+=ce;var Me=s[we];J[Me]=Y(ne),we++}}function L(Q,J){var V=se(Q.huffmanTableDC),be=V===0?0:Y(V)<<R;J[0]=Q.pred+=be}function W(Q,J){J[0]|=G()<<R}var te=0;function de(Q,J){if(te>0){te--;return}for(var V=w,be=M;V<=be;){var we=se(Q.huffmanTableAC),_e=we&15,ne=we>>4;if(_e===0){if(ne<15){te=ie(ne)+(1<<ne)-1;break}V+=16;continue}V+=ne;var ce=s[V];J[ce]=Y(_e)*(1<<R),V++}}var le=0,ge;function xe(Q,J){for(var V=w,be=M,we=0;V<=be;){var _e=s[V],ne=J[_e]<0?-1:1;switch(le){case 0:var ce=se(Q.huffmanTableAC),Me=ce&15,we=ce>>4;if(Me===0)we<15?(te=ie(we)+(1<<we),le=4):(we=16,le=1);else{if(Me!==1)throw new Error("invalid ACn encoding");ge=Y(Me),le=we?2:3}continue;case 1:case 2:J[_e]?J[_e]+=(G()<<R)*ne:(we--,we===0&&(le=le==2?3:0));break;case 3:J[_e]?J[_e]+=(G()<<R)*ne:(J[_e]=ge<<R,le=0);break;case 4:J[_e]&&(J[_e]+=(G()<<R)*ne);break}V++}le===4&&(te--,te===0&&(le=0))}function ye(Q,J,V,be,we){var _e=V/P|0,ne=V%P,ce=_e*Q.v+be,Me=ne*Q.h+we;Q.blocks[ce]===void 0&&F.tolerantDecoding||J(Q,Q.blocks[ce][Me])}function pe(Q,J,V){var be=V/Q.blocksPerLine|0,we=V%Q.blocksPerLine;Q.blocks[be]===void 0&&F.tolerantDecoding||J(Q,Q.blocks[be][we])}var K=v.length,U,me,he,C,re,oe;H?w===0?oe=D===0?L:W:oe=D===0?de:xe:oe=j;var ae=0,fe,N;K==1?N=v[0].blocksPerLine*v[0].blocksPerColumn:N=P*I.mcusPerColumn,k||(k=N);for(var ve,ue;ae<N;){for(me=0;me<K;me++)v[me].pred=0;if(te=0,K==1)for(U=v[0],re=0;re<k;re++)pe(U,oe,ae),ae++;else for(re=0;re<k;re++){for(me=0;me<K;me++)for(U=v[me],ve=U.h,ue=U.v,he=0;he<ue;he++)for(C=0;C<ve;C++)ye(U,oe,ae,he,C);if(ae++,ae===N)break}if(ae===N)do{if(E[T]===255&&E[T+1]!==0)break;T+=1}while(T<E.length-2);if(ee=0,fe=E[T]<<8|E[T+1],fe<65280)throw new Error("marker was not found");if(fe>=65488&&fe<=65495)T+=2;else break}return T-Z}function y(E,T){var I=[],v=T.blocksPerLine,k=T.blocksPerColumn,w=v<<3,M=new Int32Array(64),D=new Uint8Array(64);function R(ie,Y,j){var L=T.quantizationTable,W,te,de,le,ge,xe,ye,pe,K,U=j,me;for(me=0;me<64;me++)U[me]=ie[me]*L[me];for(me=0;me<8;++me){var he=8*me;if(U[1+he]==0&&U[2+he]==0&&U[3+he]==0&&U[4+he]==0&&U[5+he]==0&&U[6+he]==0&&U[7+he]==0){K=u*U[0+he]+512>>10,U[0+he]=K,U[1+he]=K,U[2+he]=K,U[3+he]=K,U[4+he]=K,U[5+he]=K,U[6+he]=K,U[7+he]=K;continue}W=u*U[0+he]+128>>8,te=u*U[4+he]+128>>8,de=U[2+he],le=U[6+he],ge=g*(U[1+he]-U[7+he])+128>>8,pe=g*(U[1+he]+U[7+he])+128>>8,xe=U[3+he]<<4,ye=U[5+he]<<4,K=W-te+1>>1,W=W+te+1>>1,te=K,K=de*c+le*h+128>>8,de=de*h-le*c+128>>8,le=K,K=ge-ye+1>>1,ge=ge+ye+1>>1,ye=K,K=pe+xe+1>>1,xe=pe-xe+1>>1,pe=K,K=W-le+1>>1,W=W+le+1>>1,le=K,K=te-de+1>>1,te=te+de+1>>1,de=K,K=ge*f+pe*l+2048>>12,ge=ge*l-pe*f+2048>>12,pe=K,K=xe*o+ye*a+2048>>12,xe=xe*a-ye*o+2048>>12,ye=K,U[0+he]=W+pe,U[7+he]=W-pe,U[1+he]=te+ye,U[6+he]=te-ye,U[2+he]=de+xe,U[5+he]=de-xe,U[3+he]=le+ge,U[4+he]=le-ge}for(me=0;me<8;++me){var C=me;if(U[8+C]==0&&U[16+C]==0&&U[24+C]==0&&U[32+C]==0&&U[40+C]==0&&U[48+C]==0&&U[56+C]==0){K=u*j[me+0]+8192>>14,U[0+C]=K,U[8+C]=K,U[16+C]=K,U[24+C]=K,U[32+C]=K,U[40+C]=K,U[48+C]=K,U[56+C]=K;continue}W=u*U[0+C]+2048>>12,te=u*U[32+C]+2048>>12,de=U[16+C],le=U[48+C],ge=g*(U[8+C]-U[56+C])+2048>>12,pe=g*(U[8+C]+U[56+C])+2048>>12,xe=U[24+C],ye=U[40+C],K=W-te+1>>1,W=W+te+1>>1,te=K,K=de*c+le*h+2048>>12,de=de*h-le*c+2048>>12,le=K,K=ge-ye+1>>1,ge=ge+ye+1>>1,ye=K,K=pe+xe+1>>1,xe=pe-xe+1>>1,pe=K,K=W-le+1>>1,W=W+le+1>>1,le=K,K=te-de+1>>1,te=te+de+1>>1,de=K,K=ge*f+pe*l+2048>>12,ge=ge*l-pe*f+2048>>12,pe=K,K=xe*o+ye*a+2048>>12,xe=xe*a-ye*o+2048>>12,ye=K,U[0+C]=W+pe,U[56+C]=W-pe,U[8+C]=te+ye,U[48+C]=te-ye,U[16+C]=de+xe,U[40+C]=de-xe,U[24+C]=le+ge,U[32+C]=le-ge}for(me=0;me<64;++me){var re=128+(U[me]+8>>4);Y[me]=re<0?0:re>255?255:re}}_(w*k*8);for(var F,P,H=0;H<k;H++){var Z=H<<3;for(F=0;F<8;F++)I.push(new Uint8Array(w));for(var X=0;X<v;X++){R(T.blocks[H][X],D,M);var ee=0,G=X<<3;for(P=0;P<8;P++){var se=I[Z+P];for(F=0;F<8;F++)se[G+F]=D[ee++]}}}return I}function m(E){return E<0?0:E>255?255:E}d.prototype={load:function(T){var I=new XMLHttpRequest;I.open("GET",T,!0),I.responseType="arraybuffer",I.onload=function(){var v=new Uint8Array(I.response||I.mozResponseArrayBuffer);this.parse(v),this.onload&&this.onload()}.bind(this),I.send(null)},parse:function(T){var I=this.opts.maxResolutionInMP*1e3*1e3,v=0;T.length;function k(){var ne=T[v]<<8|T[v+1];return v+=2,ne}function w(){var ne=k(),ce=T.subarray(v,v+ne-2);return v+=ce.length,ce}function M(ne){var ce=0,Me=0,Se,Ae;for(Ae in ne.components)ne.components.hasOwnProperty(Ae)&&(Se=ne.components[Ae],ce<Se.h&&(ce=Se.h),Me<Se.v&&(Me=Se.v));var Ce=Math.ceil(ne.samplesPerLine/8/ce),Ye=Math.ceil(ne.scanLines/8/Me);for(Ae in ne.components)if(ne.components.hasOwnProperty(Ae)){Se=ne.components[Ae];var He=Math.ceil(Math.ceil(ne.samplesPerLine/8)*Se.h/ce),Pe=Math.ceil(Math.ceil(ne.scanLines/8)*Se.v/Me),Oe=Ce*Se.h,Ne=Ye*Se.v,Ue=Ne*Oe,Xe=[];_(Ue*256);for(var je=0;je<Ne;je++){for(var Ve=[],S=0;S<Oe;S++)Ve.push(new Int32Array(64));Xe.push(Ve)}Se.blocksPerLine=He,Se.blocksPerColumn=Pe,Se.blocks=Xe}ne.maxH=ce,ne.maxV=Me,ne.mcusPerLine=Ce,ne.mcusPerColumn=Ye}var D=null,R=null,F,P,H=[],Z=[],X=[],ee=[],G=k(),se=-1;if(this.comments=[],G!=65496)throw new Error("SOI not found");for(G=k();G!=65497;){var ie,Y;switch(G){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var j=w();if(G===65534){var L=String.fromCharCode.apply(null,j);this.comments.push(L)}G===65504&&j[0]===74&&j[1]===70&&j[2]===73&&j[3]===70&&j[4]===0&&(D={version:{major:j[5],minor:j[6]},densityUnits:j[7],xDensity:j[8]<<8|j[9],yDensity:j[10]<<8|j[11],thumbWidth:j[12],thumbHeight:j[13],thumbData:j.subarray(14,14+3*j[12]*j[13])}),G===65505&&j[0]===69&&j[1]===120&&j[2]===105&&j[3]===102&&j[4]===0&&(this.exifBuffer=j.subarray(5,j.length)),G===65518&&j[0]===65&&j[1]===100&&j[2]===111&&j[3]===98&&j[4]===101&&j[5]===0&&(R={version:j[6],flags0:j[7]<<8|j[8],flags1:j[9]<<8|j[10],transformCode:j[11]});break;case 65499:for(var W=k(),te=W+v-2;v<te;){var de=T[v++];_(256);var le=new Int32Array(64);if(de>>4===0)for(Y=0;Y<64;Y++){var ge=s[Y];le[ge]=T[v++]}else if(de>>4===1)for(Y=0;Y<64;Y++){var ge=s[Y];le[ge]=k()}else throw new Error("DQT: invalid table spec");H[de&15]=le}break;case 65472:case 65473:case 65474:k(),F={},F.extended=G===65473,F.progressive=G===65474,F.precision=T[v++],F.scanLines=k(),F.samplesPerLine=k(),F.components={},F.componentsOrder=[];var xe=F.scanLines*F.samplesPerLine;if(xe>I){var ye=Math.ceil((xe-I)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${ye}MP`)}var pe=T[v++],K;for(ie=0;ie<pe;ie++){K=T[v];var U=T[v+1]>>4,me=T[v+1]&15,he=T[v+2];F.componentsOrder.push(K),F.components[K]={h:U,v:me,quantizationIdx:he},v+=3}M(F),Z.push(F);break;case 65476:var C=k();for(ie=2;ie<C;){var re=T[v++],oe=new Uint8Array(16),ae=0;for(Y=0;Y<16;Y++,v++)ae+=oe[Y]=T[v];_(16+ae);var fe=new Uint8Array(ae);for(Y=0;Y<ae;Y++,v++)fe[Y]=T[v];ie+=17+ae,(re>>4===0?ee:X)[re&15]=p(oe,fe)}break;case 65501:k(),P=k();break;case 65500:k(),k();break;case 65498:k();var N=T[v++],ve=[],ue;for(ie=0;ie<N;ie++){ue=F.components[T[v++]];var Q=T[v++];ue.huffmanTableDC=ee[Q>>4],ue.huffmanTableAC=X[Q&15],ve.push(ue)}var J=T[v++],V=T[v++],be=T[v++],we=x(T,v,F,ve,P,J,V,be>>4,be&15,this.opts);v+=we;break;case 65535:T[v]!==255&&v--;break;default:if(T[v-3]==255&&T[v-2]>=192&&T[v-2]<=254){v-=3;break}else if(G===224||G==225){if(se!==-1)throw new Error(`first unknown JPEG marker at offset ${se.toString(16)}, second unknown JPEG marker ${G.toString(16)} at offset ${(v-1).toString(16)}`);se=v-1;const ne=k();if(T[v+ne-2]===255){v+=ne-2;break}}throw new Error("unknown JPEG marker "+G.toString(16))}G=k()}if(Z.length!=1)throw new Error("only single frame JPEGs supported");for(var ie=0;ie<Z.length;ie++){var _e=Z[ie].components;for(var Y in _e)_e[Y].quantizationTable=H[_e[Y].quantizationIdx],delete _e[Y].quantizationIdx}this.width=F.samplesPerLine,this.height=F.scanLines,this.jfif=D,this.adobe=R,this.components=[];for(var ie=0;ie<F.componentsOrder.length;ie++){var ue=F.components[F.componentsOrder[ie]];this.components.push({lines:y(F,ue),scaleX:ue.h/F.maxH,scaleY:ue.v/F.maxV})}},getData:function(T,I){var v=this.width/T,k=this.height/I,w,M,D,R,F,P,H,Z,X,ee,G=0,se,ie,Y,j,L,W,te,de,le,ge,xe,ye=T*I*this.components.length;_(ye);var pe=new Uint8Array(ye);switch(this.components.length){case 1:for(w=this.components[0],ee=0;ee<I;ee++)for(F=w.lines[0|ee*w.scaleY*k],X=0;X<T;X++)se=F[0|X*w.scaleX*v],pe[G++]=se;break;case 2:for(w=this.components[0],M=this.components[1],ee=0;ee<I;ee++)for(F=w.lines[0|ee*w.scaleY*k],P=M.lines[0|ee*M.scaleY*k],X=0;X<T;X++)se=F[0|X*w.scaleX*v],pe[G++]=se,se=P[0|X*M.scaleX*v],pe[G++]=se;break;case 3:for(xe=!0,this.adobe&&this.adobe.transformCode?xe=!0:typeof this.opts.colorTransform!="undefined"&&(xe=!!this.opts.colorTransform),w=this.components[0],M=this.components[1],D=this.components[2],ee=0;ee<I;ee++)for(F=w.lines[0|ee*w.scaleY*k],P=M.lines[0|ee*M.scaleY*k],H=D.lines[0|ee*D.scaleY*k],X=0;X<T;X++)xe?(se=F[0|X*w.scaleX*v],ie=P[0|X*M.scaleX*v],Y=H[0|X*D.scaleX*v],de=m(se+1.402*(Y-128)),le=m(se-.3441363*(ie-128)-.71413636*(Y-128)),ge=m(se+1.772*(ie-128))):(de=F[0|X*w.scaleX*v],le=P[0|X*M.scaleX*v],ge=H[0|X*D.scaleX*v]),pe[G++]=de,pe[G++]=le,pe[G++]=ge;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(xe=!1,this.adobe&&this.adobe.transformCode?xe=!0:typeof this.opts.colorTransform!="undefined"&&(xe=!!this.opts.colorTransform),w=this.components[0],M=this.components[1],D=this.components[2],R=this.components[3],ee=0;ee<I;ee++)for(F=w.lines[0|ee*w.scaleY*k],P=M.lines[0|ee*M.scaleY*k],H=D.lines[0|ee*D.scaleY*k],Z=R.lines[0|ee*R.scaleY*k],X=0;X<T;X++)xe?(se=F[0|X*w.scaleX*v],ie=P[0|X*M.scaleX*v],Y=H[0|X*D.scaleX*v],j=Z[0|X*R.scaleX*v],L=255-m(se+1.402*(Y-128)),W=255-m(se-.3441363*(ie-128)-.71413636*(Y-128)),te=255-m(se+1.772*(ie-128))):(L=F[0|X*w.scaleX*v],W=P[0|X*M.scaleX*v],te=H[0|X*D.scaleX*v],j=Z[0|X*R.scaleX*v]),pe[G++]=255-L,pe[G++]=255-W,pe[G++]=255-te,pe[G++]=255-j;break;default:throw new Error("Unsupported color mode")}return pe},copyToImageData:function(T,I){var v=T.width,k=T.height,w=T.data,M=this.getData(v,k),D=0,R=0,F,P,H,Z,X,ee,G,se,ie;switch(this.components.length){case 1:for(P=0;P<k;P++)for(F=0;F<v;F++)H=M[D++],w[R++]=H,w[R++]=H,w[R++]=H,I&&(w[R++]=255);break;case 3:for(P=0;P<k;P++)for(F=0;F<v;F++)G=M[D++],se=M[D++],ie=M[D++],w[R++]=G,w[R++]=se,w[R++]=ie,I&&(w[R++]=255);break;case 4:for(P=0;P<k;P++)for(F=0;F<v;F++)X=M[D++],ee=M[D++],H=M[D++],Z=M[D++],G=255-m(X*(1-Z/255)+Z),se=255-m(ee*(1-Z/255)+Z),ie=255-m(H*(1-Z/255)+Z),w[R++]=G,w[R++]=se,w[R++]=ie,I&&(w[R++]=255);break;default:throw new Error("Unsupported color mode")}}};var A=0,b=0;function _(E=0){var T=A+E;if(T>b){var I=Math.ceil((T-b)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${I}MB`)}A=T}return d.resetMaxMemoryUsage=function(E){A=0,b=E},d.getBytesAllocated=function(){return A},d.requestMemoryAllocation=_,d}();t.exports=r;function r(n,s={}){var a={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},o=We(We({},a),s),l=new Uint8Array(n),f=new e;f.opts=o,e.resetMaxMemoryUsage(o.maxMemoryUsageInMB*1024*1024),f.parse(l);var h=o.formatAsRGBA?4:3,c=f.width*f.height*h;try{e.requestMemoryAllocation(c);var u={width:f.width,height:f.height,exifBuffer:f.exifBuffer,data:o.useTArray?new Uint8Array(c):Buffer.alloc(c)};f.comments.length>0&&(u.comments=f.comments)}catch(g){throw g instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+c):g}return f.copyToImageData(u,o.formatAsRGBA),u}})(decoder$1);var encode$2=encoder$1.exports,decode$5=decoder$1.exports,jpegJs={encode:encode$2,decode:decode$5};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let t=0;t<chars.length;t++)lookup[chars.charCodeAt(t)]=t;function encode$1(t){let e,r=t.length,n="";for(e=0;e<r;e+=3)n+=chars[t[e]>>2],n+=chars[(t[e]&3)<<4|t[e+1]>>4],n+=chars[(t[e+1]&15)<<2|t[e+2]>>6],n+=chars[t[e+2]&63];return r%3===2?n=`${n.substring(0,n.length-1)}=`:r%3===1&&(n=`${n.substring(0,n.length-2)}==`),n}function decode$4(t){let e=t.length*.75,r=t.length,n=0,s,a,o,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const f=new Uint8Array(e);for(let h=0;h<r;h+=4)s=lookup[t.charCodeAt(h)],a=lookup[t.charCodeAt(h+1)],o=lookup[t.charCodeAt(h+2)],l=lookup[t.charCodeAt(h+3)],f[n++]=s<<2|a>>4,f[n++]=(a&15)<<4|o>>2,f[n++]=(o&3)<<6|l&63;return f}function toBase64URL(t,e){const r=encode$1(t);return`data:${e};base64,${r}`}const ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(t,e){let r=self.document.createElement("canvas");return r.width=t,r.height=e,r}function fetchBinary(t,{withCredentials:e=!1}={}){return new Promise(function(r,n){let s=new self.XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.withCredentials=e,s.onload=function(a){this.status!==200?n(a):r(this.response)},s.onerror=n,s.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(t){return t.includes("/")||(t=`image/${t}`),t}function encodeJpeg(t,e={}){const r={width:t.width,height:t.height,data:t.getRGBAData()};return jpegJs.encode(r,e.quality).data}function encodePng(t,e){const r={width:t.width,height:t.height,channels:t.channels,depth:t.bitDepth,data:t.data};return(r.depth===1||r.depth===32)&&(r.depth=8,r.channels=4,r.data=t.getRGBAData()),encodePng$1(r,e)}const exportMethods={save(t,e={}){const{useCanvas:r=!1,encoder:n=void 0}=e;let{format:s}=e;if(!s){const a=/\.(?<format>[a-zA-Z]+)$/.exec(t);a&&(s=a.groups.format.toLowerCase())}if(!s)throw new Error("file format not provided");return new Promise((a,o)=>{let l,f;switch(s.toLowerCase()){case"png":{r?l=this.getCanvas().pngStream():f=encodePng(this,n);break}case"jpg":case"jpeg":r?l=this.getCanvas().jpegStream():f=encodeJpeg(this,n);break;case"bmp":f=encode$4(this,n);break;default:throw new RangeError(`invalid output format: ${s}`)}if(l){let h=createWriteStream();h.on("finish",a),h.on("error",o),l.pipe(h)}else f&&writeFile()})},toDataURL(t="image/png",e={}){typeof t=="object"&&(e=t,t="image/png");const{useCanvas:r=!1,encoder:n=void 0}=e;t=getType(t);function s(a,o){const l=a(o,n);return toBase64URL(l,t)}return t==="image/bmp"?s(encode$4,this):t==="image/png"&&!r?s(encodePng,this):t==="image/jpeg"&&!r?s(encodeJpeg,this):this.getCanvas().toDataURL(t)},toBuffer(t={}){const{format:e="png",encoder:r=void 0}=t;switch(e.toLowerCase()){case"png":return encodePng(this,r);case"jpeg":case"jpg":return encodeJpeg(this,r);case"bmp":return encode$4(this,r);default:throw new RangeError(`invalid output format: ${e}`)}},toBase64(t="image/png",e={}){if(e.async)return this.toDataURL(t,e).then(function(r){return r.substring(r.indexOf(",")+1)});{const r=this.toDataURL(t,e);return r.substring(r.indexOf(",")+1)}},toBlob(t="image/png",e=.8){return canvasToBlob(this.getCanvas(),t,e)},getCanvas(){const t=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height);let e=createCanvas(this.width,this.height);return e.getContext("2d").putImageData(t,0,0),e}};function setExportMethods(t){for(const e in exportMethods)t.prototype[e]=exportMethods[e]}var hasOwn$1={exports:{}};const name="has-own",version="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"};var require$$0$2={name,version,description,main,scripts,author,license,repository,homepage,devDependencies};(function(t,e){var r=Object.prototype.hasOwnProperty;t.exports=e=function(s,a){return r.call(a,s)},e.version=require$$0$2.version})(hasOwn$1,hasOwn$1.exports);var hasOwn=hasOwn$1.exports;let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(t,e,r={}){let{inPlace:n=!1,returnThis:s=!0,partialArgs:a=[]}=r;return n?Image.prototype[t]=function(...o){this.computed=null;let l=e.apply(this,[...a,...o]);return s?this:l}:Image.prototype[t]=function(...o){return e.apply(this,[...a,...o])},Image}function extendProperty(t,e,r={}){let{partialArgs:n=[]}=r;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let s=e.apply(this,n);return this.computed[t]=s,s},Object.defineProperty(Image.prototype,t,computedPropertyDescriptor$1),Image}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK";var ColorModel=Object.freeze(Object.defineProperty({__proto__:null,GREY:GREY$1,RGB:RGB$1,HSL,HSV,CMYK:CMYK$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(t={}){const{clamped:e}=t;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const r=this.width*this.height*4;let n=e?new Uint8ClampedArray(r):new Uint8Array(r);return this.bitDepth===1?fillDataFromBinary(this,n):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,n))):this.components===1?fillDataFromGrey(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,n)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,n)):fillAlpha(this,n),n}function fillDataFromBinary(t,e){for(let r=0;r<t.size;r++){const n=t.getBit(r);e[r*4]=n*255,e[r*4+1]=n*255,e[r*4+2]=n*255}}function fillDataFromGrey32(t,e){const r=t.min[0],s=t.max[0]-r;for(let a=0;a<t.size;a++){const o=Math.floor(255*(t.data[a]-r)/s);e[a*4]=o,e[a*4+1]=o,e[a*4+2]=o}}function fillDataFromRGB32(t,e){const r=Math.min(...t.min),s=Math.max(...t.max)-r;for(let a=0;a<t.size;a++){const o=Math.floor(255*(t.data[a*3]-r)/s),l=Math.floor(255*(t.data[a*3+1]-r)/s),f=Math.floor(255*(t.data[a*3+2]-r)/s);e[a*4]=o,e[a*4+1]=l,e[a*4+2]=f}}function fillDataFromGrey(t,e){for(let r=0;r<t.size;r++)e[r*4]=t.data[r*t.channels]>>>t.bitDepth-8,e[r*4+1]=t.data[r*t.channels]>>>t.bitDepth-8,e[r*4+2]=t.data[r*t.channels]>>>t.bitDepth-8}function fillDataFromRGB(t,e){for(let r=0;r<t.size;r++)e[r*4]=t.data[r*t.channels]>>>t.bitDepth-8,e[r*4+1]=t.data[r*t.channels+1]>>>t.bitDepth-8,e[r*4+2]=t.data[r*t.channels+2]>>>t.bitDepth-8}function copyAlpha(t,e){for(let r=0;r<t.size;r++)e[r*4+3]=t.data[r*t.channels+t.components]>>t.bitDepth-8}function fillAlpha(t,e){for(let r=0;r<t.size;r++)e[r*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(t){const e=kinds[t];if(!e)throw new RangeError(`invalid image kind: ${t}`);return e}const validBitDepth=[1,8,16,32];function verifyKindDefinition(t){const{components:e,alpha:r,bitDepth:n,colorModel:s}=t;if(!Number.isInteger(e)||e<=0)throw new RangeError(`invalid components: ${e}. Must be a positive integer`);if(r!==0&&r!==1&&typeof r!="boolean")throw new TypeError(`invalid alpha: ${r}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(n))throw new RangeError(`invalid bitDepth: ${n}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[s])throw new RangeError(`invalid colorModel: ${s}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(t,e,r){let n=e*t;return r===1&&(n=Math.ceil(n/8)),n}function createPixelArray(t,e,r,n,s,a){const o=n*t;let l;switch(s){case 1:l=new Uint8Array(Math.ceil(o/8));break;case 8:l=new Uint8Array(o);break;case 16:l=new Uint16Array(o);break;case 32:l=new Float32Array(o);break;default:throw new Error(`Cannot create pixel array for bit depth ${s}`)}if(r)for(let f=e;f<l.length;f+=n)l[f]=a;return l}const defaultByteLength$1=1024*8,charArray=[];class IOBuffer$3{constructor(e,r){r=r||{},e===void 0&&(e=defaultByteLength$1),typeof e=="number"&&(e=new ArrayBuffer(e));let n=e.byteLength;const s=r.offset?r.offset>>>0:0;e.buffer&&(n=e.byteLength-s,e.byteLength!==e.buffer.byteLength?e=e.buffer.slice(e.byteOffset+s,e.byteOffset+e.byteLength):s?e=e.buffer.slice(s):e=e.buffer),this.buffer=e,this.length=n,this.byteLength=n,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=n||defaultByteLength$1,this._mark=0}available(e){return e===void 0&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(e){e===void 0&&(e=1),this.offset+=e}seek(e){this.offset=e}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(e){if(e===void 0&&(e=1),!this.available(e)){const r=this._increment+this._increment;this._increment=r;const n=this.length+r,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=n,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){e===void 0&&(e=1);for(var r=new Uint8Array(e),n=0;n<e;n++)r[n]=this.readByte();return r}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e){e===void 0&&(e=1),charArray.length=e;for(var r=0;r<e;r++)charArray[r]=this.readChar();return charArray.join("")}writeBoolean(e){this.writeUint8(e?255:0)}writeInt8(e){this.ensureAvailable(1),this._data.setInt8(this.offset++,e)}writeUint8(e){this.ensureAvailable(1),this._data.setUint8(this.offset++,e)}writeByte(e){this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var r=0;r<e.length;r++)this._data.setUint8(this.offset++,e[r])}writeInt16(e){this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2}writeUint16(e){this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2}writeInt32(e){this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4}writeUint32(e){this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4}writeFloat32(e){this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4}writeFloat64(e){this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8}writeChar(e){this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var r=0;r<e.length;r++)this.writeUint8(e.charCodeAt(r))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}var IOBuffer_1=IOBuffer$3,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};class IFD$2{constructor(e){if(!e)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=e,this._map=null}get(e){if(typeof e=="number")return this.fields.get(e);if(typeof e=="string")return this.fields.get(tags$1[this.kind].tagsByName[e]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const r=tags$1[this.kind].tagsById;for(var e of this.fields.keys())r[e]&&(this._map[r[e]]=this.fields.get(e))}return this._map}}var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd$1 extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var e=new Date,r=dateTimeRegex$1.exec(this.dateTime);return e.setFullYear(r[1],r[2]-1,r[3]),e.setHours(r[4],r[5],r[6]),e}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}function alwaysArray$1(t){return typeof t=="number"?[t]:t}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(t,e){return types$1.get(t)[0]*e};ifdValue.readData=function(t,e,r){return types$1.get(e)[1](t,r)};function readByte$1(t,e){if(e===1)return t.readUint8();for(var r=new Uint8Array(e),n=0;n<e;n++)r[n]=t.readUint8();return r}function readASCII$1(t,e){for(var r=[],n="",s=0;s<e;s++){var a=String.fromCharCode(t.readUint8());a==="\0"?(r.push(n),n=""):n+=a}return r.length===1?r[0]:r}function readShort$1(t,e){if(e===1)return t.readUint16();for(var r=new Uint16Array(e),n=0;n<e;n++)r[n]=t.readUint16();return r}function readLong$1(t,e){if(e===1)return t.readUint32();for(var r=new Uint32Array(e),n=0;n<e;n++)r[n]=t.readUint32();return r}function readRational$1(t,e){if(e===1)return t.readUint32()/t.readUint32();for(var r=new Array(e),n=0;n<e;n++)r[n]=t.readUint32()/t.readUint32();return r}function readSByte$1(t,e){if(e===1)return t.readInt8();for(var r=new Int8Array(e),n=0;n<e;n++)r[n]=t.readInt8();return r}function readSShort$1(t,e){if(e===1)return t.readInt16();for(var r=new Int16Array(e),n=0;n<e;n++)r[n]=t.readInt16();return r}function readSLong$1(t,e){if(e===1)return t.readInt32();for(var r=new Int32Array(e),n=0;n<e;n++)r[n]=t.readInt32();return r}function readSRational$1(t,e){if(e===1)return t.readInt32()/t.readInt32();for(var r=new Array(e),n=0;n<e;n++)r[n]=t.readInt32()/t.readInt32();return r}function readFloat$1(t,e){if(e===1)return t.readFloat32();for(var r=new Float32Array(e),n=0;n<e;n++)r[n]=t.readFloat32();return r}function readDouble$1(t,e){if(e===1)return t.readFloat64();for(var r=new Float64Array(e),n=0;n<e;n++)r[n]=t.readFloat64();return r}const IOBuffer$2=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder$2 extends IOBuffer$2{constructor(e,r){super(e,r);this._nextIFD=0}decode(e){e=Object.assign({},defaultOptions$d,e);const r=[];for(this.decodeHeader();this._nextIFD;)if(r.push(this.decodeIFD(e)),e.onlyFirst)return r[0];return r}decodeHeader(){let e=this.readUint16();if(e===18761)this.setLittleEndian();else if(e===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+e.toString(16));if(e=this.readUint16(),e!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(e){this.seek(this._nextIFD);var r;e.kind?r=new IFD$1(e.kind):r=new TiffIFD;const n=this.readUint16();for(var s=0;s<n;s++)this.decodeIFDEntry(r);return e.ignoreImageData||this.decodeImageData(r),this._nextIFD=this.readUint32(),r}decodeIFDEntry(e){const r=this.offset,n=this.readUint16(),s=this.readUint16(),a=this.readUint32();if(s<1||s>12){this.skip(4);return}IFDValue.getByteLength(s,a)>4&&this.seek(this.readUint32());const l=IFDValue.readData(this,s,a);if(e.fields.set(n,l),n===34665||n===34853){let f=this.offset,h;n===34665?h="exif":n===34853&&(h="gps"),this._nextIFD=l,e[h]=this.decodeIFD({kind:h,ignoreImageData:!0}),this.offset=f}this.seek(r),this.skip(12)}decodeImageData(e){const r=e.orientation;switch(r&&r!==1&&unsupported$1("orientation",r),e.type){case 1:case 2:this.readStripData(e);break;default:unsupported$1("image type",e.type);break}}readStripData(e){const r=e.width,n=e.height,s=validateBitDepth(e.bitsPerSample),a=e.sampleFormat;let o=r*n;const l=getDataArray$1(o,1,s,a),f=e.compression,c=e.rowsPerStrip*r,u=e.stripOffsets,g=e.stripByteCounts;for(var d=0,p=0;p<u.length;p++){var x=this.getStripData(f,u[p],g[p]),y=o>c?c:o;o-=y,s===8?d=fill8bit$1(l,x,d,y):s===16?d=fill16bit$1(l,x,d,y,this.isLittleEndian()):s===32&&a===3?d=fillFloat32$1(l,x,d,y,this.isLittleEndian()):unsupported$1("bitDepth",s)}e.data=l}getStripData(e,r,n){switch(e){case 1:return new DataView(this.buffer,r,n);case 2:case 32773:return unsupported$1("Compression",e);default:throw new Error("invalid compression: "+e)}}}var tiffDecoder=TIFFDecoder$2;function getDataArray$1(t,e,r,n){return r===8?new Uint8Array(t*e):r===16?new Uint16Array(t*e):r===32&&n===3?new Float32Array(t*e):unsupported$1("bit depth / sample format",r+" / "+n)}function fill8bit$1(t,e,r,n){for(var s=0;s<n;s++)t[r++]=e.getUint8(s);return r}function fill16bit$1(t,e,r,n,s){for(var a=0;a<n*2;a+=2)t[r++]=e.getUint16(a,s);return r}function fillFloat32$1(t,e,r,n,s){for(var a=0;a<n*4;a+=4)t[r++]=e.getFloat32(a,s);return r}function unsupported$1(t,e){throw new Error("Unsupported "+t+": "+e)}function validateBitDepth(t){if(t.length){const r=t;t=r[0];for(var e=0;e<r.length;e++)r[e]!==t&&unsupported$1("bit depth",r)}return t}const TIFFDecoder$1=tiffDecoder;var decode$3=function(e,r){return new TIFFDecoder$1(e,r).decode(r)};src$4.decode=decode$3;const IOBuffer$1=IOBuffer_1,tiff=src$4;function decode$2(t){const e=new IOBuffer$1(t),r={};if(e.setBigEndian(),e.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(e.readUint16()===65505){e.readUint16();const a=e.readBytes(6);if(a[0]===69&&a[1]===120&&a[2]===105&&a[3]===102&&a[4]===0&&a[5]===0){const o=tiff.decode(e,{onlyFirst:!0,ignoreImageData:!0,offset:e.offset});r.exif=o}}return r}var decode_1=decode$2,decode$1=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=t=>[...t].map(e=>e.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(t,e=0){let r=t[e],n=1,s=0;for(;++s<8;)n*=256,r+=t[e+s]*n;return r}const fileType=t=>{if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Buffer.isBuffer(t)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof t}\``);const e=t instanceof Uint8Array?t:new Uint8Array(t);if(!(e&&e.length>1))return null;const r=(s,a)=>{a=Object.assign({offset:0},a);for(let o=0;o<s.length;o++)if(a.mask){if(s[o]!==(a.mask[o]&e[o+a.offset]))return!1}else if(s[o]!==e[o+a.offset])return!1;return!0},n=(s,a)=>r(toBytes(s),a);if(r([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(r([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(r([71,73,70]))return{ext:"gif",mime:"image/gif"};if(r([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(r([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((r([73,73,42,0])||r([77,77,0,42]))&&r([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r([73,73,42,0])||r([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(r([66,77]))return{ext:"bmp",mime:"image/bmp"};if(r([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(r([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(r([80,75,3,4])){if(r([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(r(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(n("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(n("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(n("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const s=(f,h=0)=>f.findIndex((c,u,g)=>u>=h&&g[u]===80&&g[u+1]===75&&g[u+2]===3&&g[u+3]===4);let a=0,o=!1,l=null;do{const f=a+30;if(o||(o=r(oxmlContentTypes,{offset:f})||r(oxmlRels,{offset:f})),l||(n("word/",{offset:f})?l={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:n("ppt/",{offset:f})?l={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:n("xl/",{offset:f})&&(l={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),o&&l)return l;a=s(e,f)}while(a>=0);if(l)return l}if(r([80,75])&&(e[2]===3||e[2]===5||e[2]===7)&&(e[3]===4||e[3]===6||e[3]===8))return{ext:"zip",mime:"application/zip"};if(r([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(r([82,97,114,33,26,7])&&(e[6]===0||e[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(r([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(r([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(r([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(r([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(r([51,103,112,53])||r([0,0,0])&&r([102,116,121,112],{offset:4})&&(r([109,112,52,49],{offset:8})||r([109,112,52,50],{offset:8})||r([105,115,111,109],{offset:8})||r([105,115,111,50],{offset:8})||r([109,109,112,52],{offset:8})||r([77,52,86],{offset:8})||r([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(r([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(r([26,69,223,163])){const s=e.subarray(4,4100),a=s.findIndex((o,l,f)=>f[l]===66&&f[l+1]===130);if(a!==-1){const o=a+3,l=f=>[...f].every((h,c)=>s[o+c]===h.charCodeAt(0));if(l("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(l("webm"))return{ext:"webm",mime:"video/webm"}}}if(r([0,0,0,20,102,116,121,112,113,116,32,32])||r([102,114,101,101],{offset:4})||r([102,116,121,112,113,116,32,32],{offset:4})||r([109,100,97,116],{offset:4})||r([109,111,111,118],{offset:4})||r([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(r([82,73,70,70])){if(r([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(r([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(r([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(r([48,38,178,117,142,102,207,17,166,217])){let s=30;do{const a=readUInt64LE(e,s+16);if(r([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:s})){if(r([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:s+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(r([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:s+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}s+=a}while(s+24<=e.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(r([0,0,1,186])||r([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(r([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let s=0;s<2&&s<e.length-16;s++){if(r([73,68,51],{offset:s})||r([255,226],{offset:s,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(r([255,228],{offset:s,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,248],{offset:s,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,240],{offset:s,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(r([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(r([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(r([79,103,103,83]))return r([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:r([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:r([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:r([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:r([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(r([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(r([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(r([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(r([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(r([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(r([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((e[0]===67||e[0]===70)&&r([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(r([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(r([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(r([119,79,70,70])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(r([119,79,70,50])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(r([76,80],{offset:34})&&(r([0,0,1],{offset:8})||r([1,0,2],{offset:8})||r([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(r([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(r([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(r([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(r([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(r([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(r([37,33]))return{ext:"ps",mime:"application/postscript"};if(r([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(r([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(r([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(r([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(r([77,83,67,70])||r([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(r([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(r([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(r([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(r([31,160])||r([31,157]))return{ext:"Z",mime:"application/x-compress"};if(r([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(r([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(r([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(r([71],{offset:4})&&(r([71],{offset:192})||r([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(r([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(r([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(r([0,0,0,12,106,80,32,32,13,10,135,10])){if(r([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(r([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(r([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(r([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(r([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(r([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(r([102,116,121,112],{offset:4})){if(r([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(r([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(r([104,101,105,99],{offset:8})||r([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(r([104,101,118,99],{offset:8})||r([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return r([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:r([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:r([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:r([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:r([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:r([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:r([212,195,178,161])||r([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const t=new stream.PassThrough,e=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{t.fileType=fileType(e)}catch(r){reject(r)}readableStream.unshift(e),stream.pipeline?resolve(stream.pipeline(readableStream,t,()=>{})):resolve(readableStream.pipe(t))})})})(fileType$1);const fileType=fileType$1.exports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=t=>{const e=fileType(t);return imageExts.has(e&&e.ext)?e:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageType$1=imageType$2.exports;(function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function e(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let a=0;const o=n.length;let l=0,f=Math.max(32,o+(o>>1)+7),h=new Uint8Array(f>>3<<3);for(;a<o;){let c=n.charCodeAt(a++);if(c>=55296&&c<=56319){if(a<o){const u=n.charCodeAt(a);(u&64512)===56320&&(++a,c=((c&1023)<<10)+(u&1023)+65536)}if(c>=55296&&c<=56319)continue}if(l+4>h.length){f+=8,f*=1+a/n.length*2,f=f>>3<<3;const u=new Uint8Array(f);u.set(h),h=u}if((c&4294967168)===0){h[l++]=c;continue}else if((c&4294965248)===0)h[l++]=c>>6&31|192;else if((c&4294901760)===0)h[l++]=c>>12&15|224,h[l++]=c>>6&63|128;else if((c&4292870144)===0)h[l++]=c>>18&7|240,h[l++]=c>>12&63|128,h[l++]=c>>6&63|128;else continue;h[l++]=c&63|128}return h.slice(0,l)};function r(n="utf-8",s={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(s.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(n,s={stream:!1}){if(s.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const a=new Uint8Array(n);let o=0;const l=a.length,f=[];for(;o<l;){const h=a[o++];if(h===0)break;if((h&128)===0)f.push(h);else if((h&224)===192){const c=a[o++]&63;f.push((h&31)<<6|c)}else if((h&240)===224){const c=a[o++]&63,u=a[o++]&63;f.push((h&31)<<12|c<<6|u)}else if((h&248)===240){const c=a[o++]&63,u=a[o++]&63,g=a[o++]&63;let d=(h&7)<<18|c<<12|u<<6|g;d>65535&&(d-=65536,f.push(d>>>10&1023|55296),d=56320|d&1023),f.push(d)}}return String.fromCharCode.apply(null,f)},t.TextEncoder=e,t.TextDecoder=r})(typeof window!="undefined"?window:typeof self!="undefined"?self:globalThis);const decoder=new TextDecoder("utf-8");function decode(t){return decoder.decode(t)}const encoder=new TextEncoder;function encode(t){return encoder.encode(t)}const defaultByteLength=1024*8;class IOBuffer{constructor(e=defaultByteLength,r={}){let n=!1;typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const s=r.offset?r.offset>>>0:0,a=e.byteLength-s;let o=s;(ArrayBuffer.isView(e)||e instanceof IOBuffer)&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+s),e=e.buffer),n?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=e,this.length=a,this.byteLength=a,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,a),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const n=(this.offset+e)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){const r=new Uint8Array(e);for(let n=0;n<e;n++)r[n]=this.readByte();return r}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let r="";for(let n=0;n<e;n++)r+=this.readChar();return r}readUtf8(e=1){return decode(this.readBytes(e))}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let r=0;r<e.length;r++)this._data.setUint8(this.offset++,e[r]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let r=0;r<e.length;r++)this.writeUint8(e.charCodeAt(r));return this}writeUtf8(e){return this.writeBytes(encode(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function guessStripByteCounts(t){if(t.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const e=t.rowsPerStrip*t.width*t.samplesPerPixel*(t.bitsPerSample/8);return new Array(t.stripOffsets.length).fill(e)}function applyHorizontalDifferencing8Bit(t,e,r){let n=0;for(;n<t.length;){for(let s=r;s<e*r;s+=r)for(let a=0;a<r;a++)t[n+s+a]=t[n+s+a]+t[n+s-(r-a)]&255;n+=e*r}}function applyHorizontalDifferencing16Bit(t,e,r){let n=0;for(;n<t.length;){for(let s=r;s<e*r;s+=r)for(let a=0;a<r;a++)t[n+s+a]=t[n+s+a]+t[n+s-(r-a)]&65535;n+=e*r}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let t in tagsById$2)tagsByName$2[tagsById$2[t]]=Number(t);var exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"}));const tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let t in tagsById$1)tagsByName$1[tagsById$1[t]]=Number(t);var gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"}));const tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let t in tagsById)tagsByName[tagsById[t]]=Number(t);var standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"}));const tags={standard,exif,gps};class IFD{constructor(e){if(!e)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=e,this._hasMap=!1,this._map={}}get(e){if(typeof e=="number")return this.fields.get(e);if(typeof e=="string")return this.fields.get(tags[this.kind].tagsByName[e]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const e=tags[this.kind].tagsById;for(let r of this.fields.keys())e[r]&&(this._map[e[r]]=this.fields.get(r));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(t,e){const r=types.get(t);if(!r)throw new Error(`type not found: ${t}`);return r[0]*e}function readData(t,e,r){const n=types.get(e);if(!n)throw new Error(`type not found: ${e}`);return n[1](t,r)}function readByte(t,e){if(e===1)return t.readUint8();let r=new Uint8Array(e);for(let n=0;n<e;n++)r[n]=t.readUint8();return r}function readASCII(t,e){let r=[],n="";for(let s=0;s<e;s++){let a=String.fromCharCode(t.readUint8());a==="\0"?(r.push(n),n=""):n+=a}return r.length===1?r[0]:r}function readShort(t,e){if(e===1)return t.readUint16();let r=new Uint16Array(e);for(let n=0;n<e;n++)r[n]=t.readUint16();return r}function readLong(t,e){if(e===1)return t.readUint32();let r=new Uint32Array(e);for(let n=0;n<e;n++)r[n]=t.readUint32();return r}function readRational(t,e){if(e===1)return t.readUint32()/t.readUint32();let r=new Array(e);for(let n=0;n<e;n++)r[n]=t.readUint32()/t.readUint32();return r}function readSByte(t,e){if(e===1)return t.readInt8();let r=new Int8Array(e);for(let n=0;n<e;n++)r[n]=t.readInt8();return r}function readSShort(t,e){if(e===1)return t.readInt16();let r=new Int16Array(e);for(let n=0;n<e;n++)r[n]=t.readInt16();return r}function readSLong(t,e){if(e===1)return t.readInt32();let r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.readInt32();return r}function readSRational(t,e){if(e===1)return t.readInt32()/t.readInt32();let r=new Array(e);for(let n=0;n<e;n++)r[n]=t.readInt32()/t.readInt32();return r}function readFloat(t,e){if(e===1)return t.readFloat32();let r=new Float32Array(e);for(let n=0;n<e;n++)r[n]=t.readFloat32();return r}function readDouble(t,e){if(e===1)return t.readFloat64();let r=new Float64Array(e);for(let n=0;n<e;n++)r[n]=t.readFloat64();return r}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let e=0;e<256;e++)stringTable.push([e]);const t=[];for(let e=256;e<4096;e++)stringTable.push(t)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(e){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.outData=new IOBuffer(e.byteLength),this.initializeTable()}decode(){let e=0,r=0;for(;(e=this.getNextCode())!==EOI_CODE;)if(e===CLEAR_CODE){if(this.initializeTable(),e=this.getNextCode(),e===EOI_CODE)break;this.writeString(this.stringFromCode(e)),r=e}else if(this.isInTable(e))this.writeString(this.stringFromCode(e)),this.addStringToTable(this.stringFromCode(r).concat(this.stringFromCode(e)[0])),r=e;else{const s=this.stringFromCode(r).concat(this.stringFromCode(r)[0]);this.writeString(s),this.addStringToTable(s),r=e}const n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(e){this.outData.writeBytes(e)}stringFromCode(e){return stringTable[e]}isInTable(e){return e<this.tableLength}addStringToTable(e){if(stringTable[this.tableLength++]=e,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const e=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:e}}function decompressLzw(t){return new LzwDecoder(t).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let e=new Date,r=dateTimeRegex.exec(this.dateTime);if(r===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return e.setFullYear(Number(r[1]),Number(r[2])-1,Number(r[3])),e.setHours(Number(r[4]),Number(r[5]),Number(r[6])),e}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const e=this.get("BitsPerSample");return e&&typeof e!="number"?e[0]:e}get alpha(){const e=this.extraSamples;return e?e[0]!==0:!1}get associatedAlpha(){const e=this.extraSamples;return e?e[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const e=2**this.bitsPerSample,r=this.get("ColorMap");if(!r)return;if(r.length!==3*e)throw new Error(`ColorMap size must be ${e}`);const n=[];for(let s=0;s<e;s++)n.push([r[s],r[s+e],r[s+2*e]]);return n}}function alwaysArray(t){return typeof t=="number"?[t]:t}function decompressZlib(t){const e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),r=inflate_1(e);return new DataView(r.buffer,r.byteOffset,r.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer{constructor(e){super(e);this._nextIFD=0}get isMultiPage(){let e=0;for(this.decodeHeader();this._nextIFD;)if(e++,this.decodeIFD({ignoreImageData:!0},!0),e===2)return!0;if(e===1)return!1;throw unsupported("ifdCount",e)}get pageCount(){let e=0;for(this.decodeHeader();this._nextIFD;)e++,this.decodeIFD({ignoreImageData:!0},!0);if(e>0)return e;throw unsupported("ifdCount",e)}decode(e={}){e=Object.assign({},defaultOptions$c,e);const r=[];for(this.decodeHeader();this._nextIFD;)if(r.push(this.decodeIFD(e,!0)),e.onlyFirst)return[r[0]];return r}decodeHeader(){const e=this.readUint16();if(e===18761)this.setLittleEndian();else if(e===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${e.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(e,r){this.seek(this._nextIFD);let n;if(r)n=new TiffIfd;else{if(!e.kind)throw new Error("kind is missing");n=new IFD(e.kind)}const s=this.readUint16();for(let a=0;a<s;a++)this.decodeIFDEntry(n);if(!e.ignoreImageData){if(!(n instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(e){const r=this.offset,n=this.readUint16(),s=this.readUint16(),a=this.readUint32();if(s<1||s>12){this.skip(4);return}getByteLength(s,a)>4&&this.seek(this.readUint32());const l=readData(this,s,a);if(e.fields.set(n,l),n===34665||n===34853){let f=this.offset,h="exif";n===34665?h="exif":n===34853&&(h="gps"),this._nextIFD=l,e[h]=this.decodeIFD({kind:h,ignoreImageData:!0},!1),this.offset=f}this.seek(r),this.skip(12)}decodeImageData(e){const r=e.orientation;if(r&&r!==1)throw unsupported("orientation",r);switch(e.type){case 0:case 1:case 2:case 3:this.readStripData(e);break;default:throw unsupported("image type",e.type)}if(this.applyPredictor(e),this.convertAlpha(e),e.type===0){const n=e.bitsPerSample,s=Math.pow(2,n)-1;for(let a=0;a<e.data.length;a++)e.data[a]=s-e.data[a]}}readStripData(e){const r=e.width,n=e.height,s=e.bitsPerSample,a=e.sampleFormat,o=r*n*e.samplesPerPixel,l=getDataArray(o,s,a),h=e.rowsPerStrip*r*e.samplesPerPixel,c=e.stripOffsets,u=e.stripByteCounts||guessStripByteCounts(e);let g=o,d=0;for(let p=0;p<c.length;p++){let x=new DataView(this.buffer,this.byteOffset+c[p],u[p]),y=g>h?h:g;g-=y;let m=x;switch(e.compression){case 1:break;case 5:{m=decompressLzw(x);break}case 8:{m=decompressZlib(x);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",e.compression)}d=this.fillUncompressed(s,a,l,m,d,y)}e.data=l}fillUncompressed(e,r,n,s,a,o){if(e===8)return fill8bit(n,s,a,o);if(e===16)return fill16bit(n,s,a,o,this.isLittleEndian());if(e===32&&r===3)return fillFloat32(n,s,a,o,this.isLittleEndian());throw unsupported("bitDepth",e)}applyPredictor(e){const r=e.bitsPerSample;switch(e.predictor){case 1:break;case 2:{if(r===8)applyHorizontalDifferencing8Bit(e.data,e.width,e.components);else if(r===16)applyHorizontalDifferencing16Bit(e.data,e.width,e.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${r}`);break}default:throw new Error(`invalid predictor: ${e.predictor}`)}}convertAlpha(e){if(e.alpha&&e.associatedAlpha){const{data:r,components:n,maxSampleValue:s}=e;for(let a=0;a<r.length;a+=n){const o=r[a+n-1];for(let l=0;l<n-1;l++)r[a+l]=Math.round(r[a+l]*s/o)}}}}function getDataArray(t,e,r){if(e===8)return new Uint8Array(t);if(e===16)return new Uint16Array(t);if(e===32&&r===3)return new Float32Array(t);throw unsupported("bit depth / sample format",`${e} / ${r}`)}function fill8bit(t,e,r,n){for(let s=0;s<n;s++)t[r++]=e.getUint8(s);return r}function fill16bit(t,e,r,n,s){for(let a=0;a<n*2;a+=2)t[r++]=e.getUint16(a,s);return r}function fillFloat32(t,e,r,n,s){for(let a=0;a<n*4;a+=4)t[r++]=e.getFloat32(a,s);return r}function unsupported(t,e){return new Error(`Unsupported ${t}: ${e}`)}function decodeTIFF(t,e){return new TIFFDecoder(t).decode(e)}function matchAndCrop(t={}){let{algorithm:e="matchToPrevious",ignoreBorder:r=[0,0]}=t;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let n=e==="matchToPrevious",s=this[0],a=[];a[0]={position:[0,0],image:this[0]};let o=[0,0];for(let g=1;g<this.length;g++){let d=s.getBestMatch(this[g],{border:r});a[g]={position:[d[0]+o[0],d[1]+o[1]],image:this[g]},n&&(o[0]+=d[0],o[1]+=d[1],s=this[g])}let l=0,f=0,h=0,c=0;for(let g=0;g<a.length;g++){let d=a[g];d.position[0]>l&&(l=d.position[0]),d.position[0]<f&&(f=d.position[0]),d.position[1]>h&&(h=d.position[1]),d.position[1]<c&&(c=d.position[1])}f=0-f,c=0-c;for(let g=0;g<a.length;g++){let d=a[g];d.crop=d.image.crop({x:l-d.position[0],y:h-d.position[1],width:s.width-f-l,height:s.height-c-h})}let u=[];for(let g=0;g<a.length;g++)u[g]=a[g].crop;return new Stack(u)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].min;for(let e=1;e<this.length;e++)for(let r=0;r<t.length;r++)t[r]=Math.min(t[r],this[e].min[r]);return t}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].max;for(let e=1;e<this.length;e++)for(let r=0;r<t.length;r++)t[r]=Math.max(t[r],this[e].max[r]);return t}function median$2(t){let e=t.reduce((o,l)=>o+l);if(e===0)throw new Error("unreachable");let r=0,n=0,s=e/2,a;for(;;){if(t[r]>0){if(a!==void 0)return(a+r)/2;if(n+=t[r],n>s)return r;n===s&&(a=r)}r++}}function mean$2(t){let e=0,r=0;for(let n=0;n<t.length;n++)e+=t[n],r+=t[n]*n;return e===0?0:r/e}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let t=this.getHistograms({maxSlots:this[0].maxValue+1}),e=new Array(t.length);for(let r=0;r<t.length;r++){let n=t[r];e[r]=median$2(n)}return e}function histogram(t){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].getHistogram(t);for(let r=1;r<this.length;r++){let n=this[r].getHistogram(t);for(let s=0;s<e.length;s++)e[s]+=n[s]}return e}function histograms(t){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].getHistograms(t),r=e[0].length;for(let n=1;n<this.length;n++){let s=this[n].getHistograms(t);for(let a=0;a<e.length;a++)for(let o=0;o<r;o++)e[a][o]+=s[a][o]}return e}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let t=new Uint32Array(this[0].data.length);for(let n=0;n<this.length;n++){let s=this[n];for(let a=0;a<this[0].data.length;a++)t[a]+=s.data[a]}let e=Image.createFrom(this[0]),r=e.data;for(let n=0;n<this[0].data.length;n++)r[n]=t[n]/this.length;return e}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let t=Image.createFrom(this[0]);t.data.fill(0);for(const e of this)for(let r=0;r<t.data.length;r++)t.data[r]=Math.max(e.data[r],t.data[r]);return t}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let t=Image.createFrom(this[0]);t.data.fill(t.maxValue);for(const e of this)for(let r=0;r<t.data.length;r++)t.data[r]=Math.min(e.data[r],t.data[r]);return t}function extend$2(t){t.extendMethod("matchAndCrop",matchAndCrop),t.extendMethod("getMin",min$2),t.extendMethod("getMax",max$2),t.extendMethod("getMedian",median$1),t.extendMethod("getHistogram",histogram),t.extendMethod("getHistograms",histograms),t.extendMethod("getAverage",averageImage),t.extendMethod("getAverageImage",averageImage),t.extendMethod("getMaxImage",maxImage),t.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(e){if(Array.isArray(e)){super(e.length);for(let r=0;r<e.length;r++)this[r]=e[r]}else typeof e=="number"?super(e):super();this.computed=null}static load(e){return Promise.all(e.map(Image.load)).then(r=>new Stack(r))}static extendMethod(e,r,n={}){let{inPlace:s=!1,returnThis:a=!0,partialArgs:o=[]}=n;return s?Stack.prototype[e]=function(...l){this.computed=null;let f=r.apply(this,[...o,...l]);return a?this:f}:Stack.prototype[e]=function(...l){return r.apply(this,[...o,...l])},Stack}static extendProperty(e,r,n={}){let{partialArgs:s=[]}=n;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(e,this.computed))return this.computed[e];let a=r.apply(this,s);return this.computed[e]=a,a},Object.defineProperty(Stack.prototype,e,computedPropertyDescriptor),Stack}checkProcessable(e,r={}){if(typeof e!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${e} can not be applied on an empty stack`);this[0].checkProcessable(e,r);for(let n=1;n<this.length;n++){if((r.sameSize===void 0||r.sameSize)&&this[0].width!==this[n].width)throw new TypeError(`The process: ${e} can not be applied if width is not identical in all images`);if((r.sameSize===void 0||r.sameSize)&&this[0].height!==this[n].height)throw new TypeError(`The process: ${e} can not be applied if height is not identical in all images`);if((r.sameAlpha===void 0||r.sameAlpha)&&this[0].alpha!==this[n].alpha)throw new TypeError(`The process: ${e} can not be applied if alpha is not identical in all images`);if((r.sameBitDepth===void 0||r.sameBitDepth)&&this[0].bitDepth!==this[n].bitDepth)throw new TypeError(`The process: ${e} can not be applied if bitDepth is not identical in all images`);if((r.sameColorModel===void 0||r.sameColorModel)&&this[0].colorModel!==this[n].colorModel)throw new TypeError(`The process: ${e} can not be applied if colorModel is not identical in all images`);if((r.sameNumberChannels===void 0||r.sameNumberChannels)&&this[0].channels!==this[n].channels)throw new TypeError(`The process: ${e} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(t,e){if(typeof t!="function")throw new TypeError(`${t} is not a function`);let r=new Stack(this.length);for(let n=0;n<this.length;n++)r[n]=t.call(e,this[n],n,this);return r});extend$2(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(t,e){if(typeof t=="string")return loadURL(t,e);if(t instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(t)));if(t.buffer)return Promise.resolve(loadBinary(t));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(t,e){const r=imageType$1(t);if(r)switch(r.mime){case"image/png":return loadPNG(t);case"image/jpeg":return loadJPEG(t);case"image/tiff":return loadTIFF(t);default:return loadGeneric(n(r.mime))}return loadGeneric(n("application/octet-stream"));function n(s){return e||toBase64URL(t,s)}}function loadURL(t,e){const r=t.slice(0,64).match(isDataURL);let n;return r!==null?n=Promise.resolve(decode$4(t.slice(r[0].length))):n=fetchBinary(t,e),n.then(s=>{const a=new Uint8Array(s);return loadBinary(a,r?t:void 0)})}function loadPNG(t){const e=decodePng(t);let r=e.channels,n,s=0;return r===2||r===4?(n=r-1,s=1):n=r,e.palette?loadPNGFromPalette(e):new Image(e.width,e.height,e.data,{components:n,alpha:s,bitDepth:e.depth})}function loadPNGFromPalette(t){const e=t.width*t.height,r=t.palette[0].length,n=new Uint8Array(e*r),s=8/t.depth,a=t.depth<8?s:1,o=parseInt("1".repeat(t.depth),2),l=r===4;let f=0;for(let h=0;h<e;h++){const c=Math.floor(h/a);let u=t.data[c];t.depth<8&&(u=u>>>t.depth*(s-1-h%s)&o);const g=t.palette[u];n[f++]=g[0],n[f++]=g[1],n[f++]=g[2],l&&(n[f++]=g[3])}return new Image(t.width,t.height,n,{components:3,alpha:l,bitDepth:8})}function loadJPEG(t){const e=decode$1(t);let r;e.exif&&(r=getMetadata(e.exif));const n=jpegJs.decode(t,{useTArray:!0,maxMemoryUsageInMB:1024});let s=new Image(n.width,n.height,n.data,{meta:r});if(r&&r.tiff.tags.Orientation){const a=r.tiff.tags.Orientation;a>2&&(s=s.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[a])),[2,4,5,7].includes(a)&&(s=s.flipX())}return s}function loadTIFF(t){let e=decodeTIFF(t);return e.length===1?getImageFromIFD(e[0]):new Stack(e.map(getImageFromIFD))}function getMetadata(t){const e={tiff:{fields:t.fields,tags:t.map}};return t.exif&&(e.exif=t.exif),t.gps&&(e.gps=t.gps),e}function getImageFromIFD(t){if(t.type===3){const e=new Uint16Array(3*t.width*t.height),r=t.palette;let n=0;for(let s=0;s<t.data.length;s++){const a=t.data[s],o=r[a];e[n++]=o[0],e[n++]=o[1],e[n++]=o[2]}return new Image(t.width,t.height,e,{components:3,alpha:t.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(t)})}else return new Image(t.width,t.height,t.data,{components:t.type===2?3:1,alpha:t.alpha,colorModel:t.type===2?RGB$1:GREY$1,bitDepth:t.bitsPerSample.length?t.bitsPerSample[0]:t.bitsPerSample,meta:getMetadata(t)})}function loadGeneric(t,e){return e=e||{},new Promise(function(r,n){let s=new DOMImage;s.onload=function(){let a=s.width,o=s.height,f=createCanvas(a,o).getContext("2d");f.drawImage(s,0,0,a,o);let h=f.getImageData(0,0,a,o).data;r(new Image(a,o,h,e))},s.onerror=function(){n(new Error(`Could not load ${t}`))},s.src=t})}const valueMethods={getValueXY(t,e,r){return this.data[(e*this.width+t)*this.channels+r]},setValueXY(t,e,r,n){return this.data[(e*this.width+t)*this.channels+r]=n,this.computed=null,this},getValue(t,e){return this.data[t*this.channels+e]},setValue(t,e,r){return this.data[t*this.channels+e]=r,this.computed=null,this},getPixelXY(t,e){return this.getPixel(e*this.width+t)},setPixelXY(t,e,r){return this.setPixel(e*this.width+t,r)},getPixel(t){const e=new Array(this.channels),r=t*this.channels;for(let n=0;n<this.channels;n++)e[n]=this.data[r+n];return e},setPixel(t,e){const r=t*this.channels;for(let n=0;n<e.length;n++)this.data[r+n]=e[n];return this.computed=null,this}};function setValueMethods(t){for(const e in valueMethods)t.prototype[e]=valueMethods[e]}function getImageParameters(t){return{width:t.width,height:t.height,components:t.components,alpha:t.alpha,colorModel:t.colorModel,bitDepth:t.bitDepth}}function getOutputImage(t,e,r,n={}){const{out:s}=e;if(s===void 0)return n.copy?t.clone():Image.createFrom(t,r);{if(!Image.isImage(s))throw new TypeError("out must be an Image object");const a=Object.assign(getImageParameters(t),r);for(const o in a)if(s[o]!==a[o])throw new RangeError(`cannot use out. Its ${o} must be "${a[o]}" (found "${s[o]}")`);return s}}function getOutputImageOrInPlace(t,e,r){if(e.inPlace!==void 0&&typeof e.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(e.inPlace){if(e.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return t}return getOutputImage(t,e,null,r)}function abs(t={}){this.checkProcessable("abs",{bitDepth:[32]});const e=getOutputImageOrInPlace(this,t);return absolute(this,e),e}function absolute(t,e){for(let r=0;r<t.data.length;r++)e.data[r]=Math.abs(t.data[r])}function copyAlphaChannel(t,e){if(t.alpha===1&&e.alpha===1)for(let r=0;r<t.size;r++)e.data[r*e.channels+e.components]=t.data[r*t.channels+t.components]}function invert(t={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const e=getOutputImageOrInPlace(this,t);return this.bitDepth===1?invertBinary(this,e):(invertColor(this,e),this!==e&&copyAlphaChannel(this,e)),e}function invertBinary(t,e){for(let r=0;r<t.data.length;r++)e.data[r]=~t.data[r]}function invertColor(t,e){for(let r=0;r<t.data.length;r+=t.channels)for(let n=0;n<t.components;n++)e.data[r+n]=t.maxValue-t.data[r+n]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let t=0;t<this.height;t++){let e=t*this.width*this.channels;for(let r=0;r<Math.floor(this.width/2);r++){let n=r*this.channels+e,s=(this.width-r-1)*this.channels+e;for(let a=0;a<this.channels;a++){let o=this.data[n+a];this.data[n+a]=this.data[s+a],this.data[s+a]=o}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let t=0;t<Math.floor(this.height/2);t++)for(let e=0;e<this.width;e++){let r=e*this.channels+t*this.width*this.channels,n=e*this.channels+(this.height-1-t)*this.channels*this.width;for(let s=0;s<this.channels;s++){let a=this.data[r+s];this.data[r+s]=this.data[n+s],this.data[n+s]=a}}return this}function blurFilter(t={}){const{radius:e=1}=t;if(e<1)throw new Error("radius must be greater than 1");const r=2*e+1,n=new Array(r);for(let s=0;s<r;s++){n[s]=new Array(r);for(let a=0;a<r;a++)n[s][a]=1/(r*r)}return this.convolution(n)}var medianQuickselect_min={exports:{}};(function(t){(function(){function e(s){for(var a=0,o=s.length-1,l=void 0,f=void 0,h=void 0,c=n(a,o);;){if(o<=a)return s[c];if(o==a+1)return s[a]>s[o]&&r(s,a,o),s[c];for(l=n(a,o),s[l]>s[o]&&r(s,l,o),s[a]>s[o]&&r(s,a,o),s[l]>s[a]&&r(s,l,a),r(s,l,a+1),f=a+1,h=o;;){do f++;while(s[a]>s[f]);do h--;while(s[h]>s[a]);if(h<f)break;r(s,f,h)}r(s,a,h),h<=c&&(a=f),h>=c&&(o=h-1)}}var r=function(a,o,l){var f;return f=[a[l],a[o]],a[o]=f[0],a[l]=f[1],f},n=function(a,o){return~~((a+o)/2)};t.exports?t.exports=e:window.median=e})()})(medianQuickselect_min);var quickSelectMedian=medianQuickselect_min.exports;function validateArrayOfChannels(t,e={}){let{channels:r,allowAlpha:n,defaultAlpha:s}=e;return typeof n!="boolean"&&(n=!0),typeof r=="undefined"?allChannels(t,s):validateChannels(t,r,n)}function allChannels(t,e){let r=e?t.channels:t.components,n=new Array(r);for(let s=0;s<r;s++)n[s]=s;return n}function validateChannels(t,e,r){Array.isArray(e)||(e=[e]);for(let n=0;n<e.length;n++)e[n]=validateChannel(t,e[n],r);return e}function validateChannel(t,e,r=!0){if(e===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${t.channels}`);if(typeof e=="string"){switch(t.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(e))switch(e){case"r":e=0;break;case"g":e=1;break;case"b":e=2;break}break;case HSL:if("hsl".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"l":e=2;break}break;case HSV:if("hsv".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"v":e=2;break}break;case CMYK$1:if("cmyk".includes(e))switch(e){case"c":e=0;break;case"m":e=1;break;case"y":e=2;break;case"k":e=3;break}break;default:throw new Error(`Unexpected color model: ${t.colorModel}`)}if(e==="a"){if(!t.alpha)throw new Error("validateChannel : the image does not contain alpha channel");e=t.components}if(typeof e=="string")throw new Error(`validateChannel : undefined channel: ${e}`)}if(e>=t.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${t.channels}`);if(!r&&e>=t.components)throw new RangeError("validateChannel : alpha channel may not be selected");return e}function medianFilter(t={}){let{radius:e=1,border:r="copy",channels:n}=t;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),e<1)throw new Error("radius must be greater than 0");n=validateArrayOfChannels(this,n);let s=e,a=e,o=Image.createFrom(this),l=(s*2+1)*(a*2+1),f=new Array(l);for(let h=0;h<n.length;h++){let c=n[h];for(let u=a;u<this.height-a;u++)for(let g=s;g<this.width-s;g++){let d=0;for(let x=-a;x<=a;x++)for(let y=-s;y<=s;y++){let m=((u+x)*this.width+g+y)*this.channels+c;f[d++]=this.data[m]}let p=(u*this.width+g)*this.channels+c;o.data[p]=quickSelectMedian(f)}}if(this.alpha&&!n.includes(this.channels))for(let h=this.components;h<this.data.length;h=h+this.channels)o.data[h]=this.data[h];return o.setBorder({size:[s,a],algorithm:r}),o}function gaussianFilter(t={}){let{radius:e=1,sigma:r,channels:n,border:s="copy"}=t;this.checkProcessable("gaussian",{bitDepth:[8,16]});const a=getKernel(e,r);return this.convolution([a,a],{border:s,channels:n,algorithm:"separable"})}function getKernel(t,e){const r=t*2+1,n=new Array(r),s=e||((r-1)*.5-1)*.3+.8,a=-.5/(s*s);let o=0;for(let l=0;l<r;l++){const f=l-t,h=Math.exp(a*f*f);n[l]=h,o+=h}for(let l=0;l<r;l++)n[l]/=o;return n}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(t){(function(){var e;e=t;var r={release:"0.3.0",date:"2013-03"};e.toString=function(){return"version "+r.release+", released "+r.date};for(var n=0,s=null,a=null,o={init:function(h){if(h!==0&&(h&h-1)===0)n=h,o._initArray(),o._makeBitReversalTable(),o._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(h,c){o.fft(h,c,1)},ifft1d:function(h,c){var u=1/n;o.fft(h,c,-1);for(var g=0;g<n;g++)h[g]*=u,c[g]*=u},bt1d:function(h,c){o.fft(h,c,-1)},fft2d:function(h,c){for(var u=[],g=[],d=0,p=0;p<n;p++){d=p*n;for(var x=0;x<n;x++)u[x]=h[x+d],g[x]=c[x+d];o.fft1d(u,g);for(var y=0;y<n;y++)h[y+d]=u[y],c[y+d]=g[y]}for(var m=0;m<n;m++){for(var A=0;A<n;A++)d=m+A*n,u[A]=h[d],g[A]=c[d];o.fft1d(u,g);for(var b=0;b<n;b++)d=m+b*n,h[d]=u[b],c[d]=g[b]}},ifft2d:function(h,c){for(var u=[],g=[],d=0,p=0;p<n;p++){d=p*n;for(var x=0;x<n;x++)u[x]=h[x+d],g[x]=c[x+d];o.ifft1d(u,g);for(var y=0;y<n;y++)h[y+d]=u[y],c[y+d]=g[y]}for(var m=0;m<n;m++){for(var A=0;A<n;A++)d=m+A*n,u[A]=h[d],g[A]=c[d];o.ifft1d(u,g);for(var b=0;b<n;b++)d=m+b*n,h[d]=u[b],c[d]=g[b]}},fft:function(h,c,u){for(var g,d,p,x,y,m,A,b,_,E=n>>2,T=0;T<n;T++)x=s[T],T<x&&(y=h[T],h[T]=h[x],h[x]=y,y=c[T],c[T]=c[x],c[x]=y);for(var I=1;I<n;I<<=1){d=0,g=n/(I<<1);for(var v=0;v<I;v++){m=a[d+E],A=u*a[d];for(var k=v;k<n;k+=I<<1)p=k+I,b=m*h[p]+A*c[p],_=m*c[p]-A*h[p],h[p]=h[k]-b,h[k]+=b,c[p]=c[k]-_,c[k]+=_;d+=g}}},_initArray:function(){typeof Uint32Array!="undefined"?s=new Uint32Array(n):s=[],typeof Float64Array!="undefined"?a=new Float64Array(n*1.25):a=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var h=0,c=0,u=0;for(s[0]=0;++h<n;){for(u=n>>1;u<=c;)c-=u,u>>=1;c+=u,s[h]=c}},_makeCosSinTable:function(){var h=n>>1,c=n>>2,u=n>>3,g=h+c,d=Math.sin(Math.PI/n),p=2*d*d,x=Math.sqrt(p*(2-p)),y=a[c]=1,m=a[0]=0;d=2*p;for(var A=1;A<u;A++)y-=p,p+=d*y,m+=x,x-=d*m,a[A]=m,a[c-A]=y;u!==0&&(a[u]=Math.sqrt(.5));for(var b=0;b<c;b++)a[h-b]=a[b];for(var _=0;_<g;_++)a[_+h]=-a[_]}},l=["init","fft1d","ifft1d","fft2d","ifft2d"],f=0;f<l.length;f++)e[l[f]]=o[l[f]];return e.bt=o.bt1d,e.fft=o.fft1d,e.ifft=o.ifft1d,e}).call(commonjsGlobal)})(fftlib);var FFT=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(t,e,r){var n=new Array(e*r),s=e/2,a=(r-1)*2;FFT.init(s);for(var o={re:new Array(s),im:new Array(s)},l=0;l<r;l++){for(var f=s-1;f>=0;f--)o.re[f]=t[f*2*r+l],o.im[f]=t[(f*2+1)*r+l];FFT.bt(o.re,o.im);for(var f=s-1;f>=0;f--)n[f*2*r+l]=o.re[f],n[(f*2+1)*r+l]=o.im[f]}var h=new Array(s*a);FFT.init(a);for(var c={re:new Array(a),im:new Array(a)},u=a*s,f=0;f<e;f+=2){c.re[0]=n[f*r],c.im[0]=n[(f+1)*r];for(var l=1;l<r;l++)c.re[l]=n[f*r+l],c.im[l]=n[(f+1)*r+l],c.re[a-l]=n[f*r+l],c.im[a-l]=-n[(f+1)*r+l];FFT.bt(c.re,c.im);for(var g=f/2*a,l=a-1;l>=0;l--)h[g+l]=c.re[l]/u}return h},fft2DArray:function(t,e,r,n){Object.assign({},{inplace:!0});var s=r/2+1,a=e*2,o=new Array(a*s);FFT.init(r);for(var l={re:new Array(r),im:new Array(r)},f={re:new Array(r),im:new Array(r)},h={re:new Array(r),im:new Array(r)},c,u,g,d,p,x=0;x<e/2;x++){c=x*2*r,l.re=t.slice(c,c+r),c=(x*2+1)*r,l.im=t.slice(c,c+r),FFT.fft1d(l.re,l.im),this.reconstructTwoRealFFT(l,f,h),u=x*4*s,g=(x*4+1)*s,d=(x*4+2)*s,p=(x*4+3)*s;for(var y=s-1;y>=0;y--)o[u+y]=f.re[y],o[g+y]=f.im[y],o[d+y]=h.re[y],o[p+y]=h.im[y]}f=null,h=null;var m=new Array(a*s);FFT.init(e);for(var A={re:new Array(e),im:new Array(e)},b=s-1;b>=0;b--){for(var x=e-1;x>=0;x--)A.re[x]=o[x*2*s+b],A.im[x]=o[(x*2+1)*s+b],isNaN(A.re[x])&&(A.re[x]=0),isNaN(A.im[x])&&(A.im[x]=0);FFT.fft1d(A.re,A.im);for(var x=e-1;x>=0;x--)m[x*2*s+b]=A.re[x],m[(x*2+1)*s+b]=A.im[x]}return m},reconstructTwoRealFFT:function(t,e,r){var n=t.re.length;e.re[0]=t.re[0],e.im[0]=0,r.re[0]=t.im[0],r.im[0]=0;for(var s,a,o,l,f,h=n/2;h>0;h--)f=n-h,s=.5*(t.re[h]-t.re[f]),a=.5*(t.re[h]+t.re[f]),o=.5*(t.im[h]-t.im[f]),l=.5*(t.im[h]+t.im[f]),e.re[h]=a,e.im[h]=o,e.re[f]=a,e.im[f]=-o,r.re[h]=l,r.im[h]=-s,r.re[f]=l,r.im[f]=s},convolute2DI:function(t,e,r,n){for(var s,a,o=0;o<r/2;o++)for(var l=0;l<n;l++)s=t[o*2*n+l]*e[o*2*n+l]-t[(o*2+1)*n+l]*e[(o*2+1)*n+l],a=t[o*2*n+l]*e[(o*2+1)*n+l]+t[(o*2+1)*n+l]*e[o*2*n+l],t[o*2*n+l]=s,t[(o*2+1)*n+l]=a},convolute:function(t,e,r,n,s){for(var a=new Array(n*r),o=0;o<r*n;o++)a[o]=t[o];a=this.fft2DArray(a,r,n);for(var l=e.length,f=e[0].length,h=new Array(n*r),o=0;o<n*r;o++)h[o]=0;for(var c,u,g=Math.floor((l-1)/2),d=Math.floor((f-1)/2),p=0;p<l;p++){c=(p-g+r)%r;for(var x=0;x<f;x++)u=(x-d+n)%n,h[c*n+u]=e[p][x]}h=this.fft2DArray(h,r,n);var y=r*2,m=n/2+1;return this.convolute2DI(a,h,y,m),this.ifft2DArray(a,y,m)},toRadix2:function(t,e,r){var n,s,a,o,l=r,f=e;if(!(r!==0&&(r&r-1)===0)){for(l=0;r>>++l!=0;);l=1<<l}if(!(e!==0&&(e&e-1)===0)){for(f=0;e>>++f!=0;);f=1<<f}if(f==e&&l==r)return{data:t,rows:e,cols:r};var h=new Array(f*l),c=Math.floor((f-e)/2)-e,u=Math.floor((l-r)/2)-r;for(n=0;n<f;n++)for(a=n*l,o=(n-c)%e*r,s=0;s<l;s++)h[a+s]=t[o+(s-u)%r];return{data:h,rows:f,cols:l}},crop:function(t,e,r,n,s,a){if(e==n&&r==s)return t;Object.assign({},a);var o=new Array(s*n),l=Math.floor((e-n)/2),f=Math.floor((r-s)/2),h,c,u,g;for(u=0;u<n;u++)for(h=u*s,c=(u+l)*r,g=0;g<s;g++)o[h+g]=t[c+(g+f)];return o}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(t,e,r){var n=matrix2Array(t),s=n.data,a=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},r),o,l;if(a.rows&&a.cols)o=a.rows,l=a.cols;else throw new Error("Invalid number of rows or columns "+o+" "+l);var f=a.divisor,h,c,u=e.length,g=e[0].length;if(a.normalize)for(f=0,h=0;h<u;h++)for(c=0;c<g;c++)f+=e[h][c];if(f===0)throw new RangeError("convolution: The divisor is equal to zero");var d=FFTUtils.toRadix2(s,o,l),p=FFTUtils.convolute(d.data,e,d.rows,d.cols);if(p=FFTUtils.crop(p,d.rows,d.cols,o,l),f!=0&&f!=1)for(h=0;h<p.length;h++)p[h]/=f;return p}function convolutionDirect(t,e,r){var n=matrix2Array(t),s=n.data,a=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},r),o,l;if(a.rows&&a.cols)o=a.rows,l=a.cols;else throw new Error("Invalid number of rows or columns "+o+" "+l);var f=a.divisor,h=e.length,c=e[0].length,u,g,d,p,x,y,m,A,b;if(a.normalize)for(f=0,u=0;u<h;u++)for(g=0;g<c;g++)f+=e[u][g];if(f===0)throw new RangeError("convolution: The divisor is equal to zero");var _=new Array(o*l),E=Math.floor(h/2),T=Math.floor(c/2);for(p=0;p<o;p++)for(d=0;d<l;d++){for(y=0,g=0;g<h;g++)for(u=0;u<c;u++)m=e[h-g-1][c-u-1],A=(p+g-E+o)%o,b=(d+u-T+l)%l,x=A*l+b,y+=s[x]*m;x=p*l+d,_[x]=y/f}return _}function LoG(t,e,r){var n=1e3;r&&r.factor&&(n=r.factor);var s=new Array(e),a,o,l,f;n*=-1;var h=(e-1)/2,c=2*t*t;for(a=0;a<e;a++)for(s[a]=new Array(e),f=(a-h)*(a-h),o=0;o<e;o++)l=-((o-h)*(o-h)+f)/c,s[a][o]=Math.round(n*(1+l)*Math.exp(l));return s}function matrix2Array(t){var e=t,r,n;if(typeof t[0]!="number"){r=t.length,n=t[0].length,e=new Array(r*n);for(var s=0;s<r;s++)for(var a=0;a<n;a++)e[s*n+a]=t[s][a]}else{var o=Math.sqrt(t.length);Number.isInteger(o)&&(r=o,n=o)}return{data:e,rows:r,cols:n}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(t){return!(typeof t!="number"||t!==t||t===1/0||t===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite$1(t)&&Math.floor(t)===t};function validateKernel(t){let e,r;if(Array.isArray(t))if(Array.isArray(t[0])){if((t.length&1)===0||(t[0].length&1)===0)throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");e=Math.floor(t.length/2),r=Math.floor(t[0].length/2)}else{let n=Math.sqrt(t.length);if(isInteger(n))r=e=Math.floor(Math.sqrt(t.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let s=new Array(n);for(let a=0;a<n;a++){s[a]=new Array(n);for(let o=0;o<n;o++)s[a][o]=t[a*n+o]}t=s}else throw new Error(`validateKernel: Invalid Kernel: ${t}`);return{kernel:t,kWidth:r,kHeight:e}}function clamp(t,e){return Math.round(Math.min(Math.max(t,0),e.maxValue))}function directConvolution(t,e,r){if(r===void 0){const a=t.length+e.length-1;r=new Array(a)}fill(r);for(var n=0;n<t.length;n++)for(var s=0;s<e.length;s++)r[n+s]+=t[n]*e[s];return r}function fill(t){for(var e=0;e<t.length;e++)t[e]=0}function convolutionSeparable(t,e,r,n){const s=new Array(t.length);let a,o,l,f;f=e[1],l=(f.length-1)/2,o=new Array(r+f.length-1),a=new Array(r);for(let h=0;h<n;h++){for(let c=0;c<r;c++)a[c]=t[h*r+c];directConvolution(a,f,o);for(let c=0;c<r;c++)s[h*r+c]=o[l+c]}f=e[0],l=(f.length-1)/2,o=new Array(n+f.length-1),a=new Array(n);for(let h=0;h<r;h++){for(let c=0;c<n;c++)a[c]=s[c*r+h];directConvolution(a,f,o);for(let c=0;c<n;c++)s[c*r+h]=o[l+c]}return s}const toString$1=Object.prototype.toString;function isAnyArray(t){return toString$1.call(t).endsWith("Array]")}function max$1(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(t))throw new TypeError("input must be an array");if(t.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,n=r===void 0?0:r,s=e.toIndex,a=s===void 0?t.length:s;if(n<0||n>=t.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(a<=n||a>t.length||!Number.isInteger(a))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=t[n],l=n+1;l<a;l++)t[l]>o&&(o=t[l]);return o}function min$1(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(t))throw new TypeError("input must be an array");if(t.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,n=r===void 0?0:r,s=e.toIndex,a=s===void 0?t.length:s;if(n<0||n>=t.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(a<=n||a>t.length||!Number.isInteger(a))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=t[n],l=n+1;l<a;l++)t[l]<o&&(o=t[l]);return o}function rescale(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(t)){if(t.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(e.output!==void 0){if(!isAnyArray(e.output))throw new TypeError("output option must be an array if specified");r=e.output}else r=new Array(t.length);var n=min$1(t),s=max$1(t);if(n===s)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var a=e.min,o=a===void 0?e.autoMinMax?n:0:a,l=e.max,f=l===void 0?e.autoMinMax?s:1:l;if(o>=f)throw new RangeError("min option must be smaller than max option");for(var h=(f-o)/(s-n),c=0;c<t.length;c++)r[c]=(t[c]-n)*h+o;return r}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(t,e={}){const{maxRows:r=15,maxColumns:n=10,maxNumSize:s=8}=e;return`${t.constructor.name} {
${indent}[
${indentData}${inspectData(t,r,n,s)}
${indent}]
${indent}rows: ${t.rows}
${indent}columns: ${t.columns}
}`}function inspectData(t,e,r,n){const{rows:s,columns:a}=t,o=Math.min(s,e),l=Math.min(a,r),f=[];for(let h=0;h<o;h++){let c=[];for(let u=0;u<l;u++)c.push(formatNumber(t.get(h,u),n));f.push(`${c.join(" ")}`)}return l!==a&&(f[f.length-1]+=` ... ${a-r} more columns`),o!==s&&f.push(`... ${s-e} more rows`),f.join(`
${indentData}`)}function formatNumber(t,e){const r=String(t);if(r.length<=e)return r.padEnd(e," ");const n=t.toPrecision(e-2);if(n.length<=e)return n;const s=t.toExponential(e-2),a=s.indexOf("e"),o=s.slice(a);return s.slice(0,e-o.length)+o}function installMathOperations(t,e){t.prototype.add=function(n){return typeof n=="number"?this.addS(n):this.addM(n)},t.prototype.addS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)+n);return this},t.prototype.addM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)+n.get(s,a));return this},t.add=function(n,s){return new e(n).add(s)},t.prototype.sub=function(n){return typeof n=="number"?this.subS(n):this.subM(n)},t.prototype.subS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)-n);return this},t.prototype.subM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)-n.get(s,a));return this},t.sub=function(n,s){return new e(n).sub(s)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(n){return typeof n=="number"?this.mulS(n):this.mulM(n)},t.prototype.mulS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)*n);return this},t.prototype.mulM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)*n.get(s,a));return this},t.mul=function(n,s){return new e(n).mul(s)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(n){return typeof n=="number"?this.divS(n):this.divM(n)},t.prototype.divS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)/n);return this},t.prototype.divM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)/n.get(s,a));return this},t.div=function(n,s){return new e(n).div(s)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(n){return typeof n=="number"?this.modS(n):this.modM(n)},t.prototype.modS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)%n);return this},t.prototype.modM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)%n.get(s,a));return this},t.mod=function(n,s){return new e(n).mod(s)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(n){return typeof n=="number"?this.andS(n):this.andM(n)},t.prototype.andS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)&n);return this},t.prototype.andM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)&n.get(s,a));return this},t.and=function(n,s){return new e(n).and(s)},t.prototype.or=function(n){return typeof n=="number"?this.orS(n):this.orM(n)},t.prototype.orS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)|n);return this},t.prototype.orM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)|n.get(s,a));return this},t.or=function(n,s){return new e(n).or(s)},t.prototype.xor=function(n){return typeof n=="number"?this.xorS(n):this.xorM(n)},t.prototype.xorS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)^n);return this},t.prototype.xorM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)^n.get(s,a));return this},t.xor=function(n,s){return new e(n).xor(s)},t.prototype.leftShift=function(n){return typeof n=="number"?this.leftShiftS(n):this.leftShiftM(n)},t.prototype.leftShiftS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)<<n);return this},t.prototype.leftShiftM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)<<n.get(s,a));return this},t.leftShift=function(n,s){return new e(n).leftShift(s)},t.prototype.signPropagatingRightShift=function(n){return typeof n=="number"?this.signPropagatingRightShiftS(n):this.signPropagatingRightShiftM(n)},t.prototype.signPropagatingRightShiftS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)>>n);return this},t.prototype.signPropagatingRightShiftM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)>>n.get(s,a));return this},t.signPropagatingRightShift=function(n,s){return new e(n).signPropagatingRightShift(s)},t.prototype.rightShift=function(n){return typeof n=="number"?this.rightShiftS(n):this.rightShiftM(n)},t.prototype.rightShiftS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)>>>n);return this},t.prototype.rightShiftM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,this.get(s,a)>>>n.get(s,a));return this},t.rightShift=function(n,s){return new e(n).rightShift(s)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,~this.get(n,s));return this},t.not=function(n){return new e(n).not()},t.prototype.abs=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.abs(this.get(n,s)));return this},t.abs=function(n){return new e(n).abs()},t.prototype.acos=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.acos(this.get(n,s)));return this},t.acos=function(n){return new e(n).acos()},t.prototype.acosh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.acosh(this.get(n,s)));return this},t.acosh=function(n){return new e(n).acosh()},t.prototype.asin=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.asin(this.get(n,s)));return this},t.asin=function(n){return new e(n).asin()},t.prototype.asinh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.asinh(this.get(n,s)));return this},t.asinh=function(n){return new e(n).asinh()},t.prototype.atan=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.atan(this.get(n,s)));return this},t.atan=function(n){return new e(n).atan()},t.prototype.atanh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.atanh(this.get(n,s)));return this},t.atanh=function(n){return new e(n).atanh()},t.prototype.cbrt=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.cbrt(this.get(n,s)));return this},t.cbrt=function(n){return new e(n).cbrt()},t.prototype.ceil=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.ceil(this.get(n,s)));return this},t.ceil=function(n){return new e(n).ceil()},t.prototype.clz32=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.clz32(this.get(n,s)));return this},t.clz32=function(n){return new e(n).clz32()},t.prototype.cos=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.cos(this.get(n,s)));return this},t.cos=function(n){return new e(n).cos()},t.prototype.cosh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.cosh(this.get(n,s)));return this},t.cosh=function(n){return new e(n).cosh()},t.prototype.exp=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.exp(this.get(n,s)));return this},t.exp=function(n){return new e(n).exp()},t.prototype.expm1=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.expm1(this.get(n,s)));return this},t.expm1=function(n){return new e(n).expm1()},t.prototype.floor=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.floor(this.get(n,s)));return this},t.floor=function(n){return new e(n).floor()},t.prototype.fround=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.fround(this.get(n,s)));return this},t.fround=function(n){return new e(n).fround()},t.prototype.log=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.log(this.get(n,s)));return this},t.log=function(n){return new e(n).log()},t.prototype.log1p=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.log1p(this.get(n,s)));return this},t.log1p=function(n){return new e(n).log1p()},t.prototype.log10=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.log10(this.get(n,s)));return this},t.log10=function(n){return new e(n).log10()},t.prototype.log2=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.log2(this.get(n,s)));return this},t.log2=function(n){return new e(n).log2()},t.prototype.round=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.round(this.get(n,s)));return this},t.round=function(n){return new e(n).round()},t.prototype.sign=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.sign(this.get(n,s)));return this},t.sign=function(n){return new e(n).sign()},t.prototype.sin=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.sin(this.get(n,s)));return this},t.sin=function(n){return new e(n).sin()},t.prototype.sinh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.sinh(this.get(n,s)));return this},t.sinh=function(n){return new e(n).sinh()},t.prototype.sqrt=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.sqrt(this.get(n,s)));return this},t.sqrt=function(n){return new e(n).sqrt()},t.prototype.tan=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.tan(this.get(n,s)));return this},t.tan=function(n){return new e(n).tan()},t.prototype.tanh=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.tanh(this.get(n,s)));return this},t.tanh=function(n){return new e(n).tanh()},t.prototype.trunc=function(){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.trunc(this.get(n,s)));return this},t.trunc=function(n){return new e(n).trunc()},t.pow=function(n,s){return new e(n).pow(s)},t.prototype.pow=function(n){return typeof n=="number"?this.powS(n):this.powM(n)},t.prototype.powS=function(n){for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,Math.pow(this.get(s,a),n));return this},t.prototype.powM=function(n){if(n=e.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let a=0;a<this.columns;a++)this.set(s,a,Math.pow(this.get(s,a),n.get(s,a)));return this}}function checkRowIndex(t,e,r){let n=r?t.rows:t.rows-1;if(e<0||e>n)throw new RangeError("Row index out of range")}function checkColumnIndex(t,e,r){let n=r?t.columns:t.columns-1;if(e<0||e>n)throw new RangeError("Column index out of range")}function checkRowVector(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function checkColumnVector(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function checkRowIndices(t,e){if(!isAnyArray(e))throw new TypeError("row indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=t.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(t,e){if(!isAnyArray(e))throw new TypeError("column indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=t.columns)throw new RangeError("column indices are out of range")}function checkRange(t,e,r,n,s){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",e),checkNumber("endRow",r),checkNumber("startColumn",n),checkNumber("endColumn",s),e>r||n>s||e<0||e>=t.rows||r<0||r>=t.rows||n<0||n>=t.columns||s<0||s>=t.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$1(t,e=0){let r=[];for(let n=0;n<t;n++)r.push(e);return r}function checkNumber(t,e){if(typeof e!="number")throw new TypeError(`${t} must be a number`)}function checkNonEmpty(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(t){let e=newArray$1(t.rows);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[r]+=t.get(r,n);return e}function sumByColumn(t){let e=newArray$1(t.columns);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[n]+=t.get(r,n);return e}function sumAll(t){let e=0;for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)e+=t.get(r,n);return e}function productByRow(t){let e=newArray$1(t.rows,1);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[r]*=t.get(r,n);return e}function productByColumn(t){let e=newArray$1(t.columns,1);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[n]*=t.get(r,n);return e}function productAll(t){let e=1;for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)e*=t.get(r,n);return e}function varianceByRow(t,e,r){const n=t.rows,s=t.columns,a=[];for(let o=0;o<n;o++){let l=0,f=0,h=0;for(let c=0;c<s;c++)h=t.get(o,c)-r[o],l+=h,f+=h*h;e?a.push((f-l*l/s)/(s-1)):a.push((f-l*l/s)/s)}return a}function varianceByColumn(t,e,r){const n=t.rows,s=t.columns,a=[];for(let o=0;o<s;o++){let l=0,f=0,h=0;for(let c=0;c<n;c++)h=t.get(c,o)-r[o],l+=h,f+=h*h;e?a.push((f-l*l/n)/(n-1)):a.push((f-l*l/n)/n)}return a}function varianceAll(t,e,r){const n=t.rows,s=t.columns,a=n*s;let o=0,l=0,f=0;for(let h=0;h<n;h++)for(let c=0;c<s;c++)f=t.get(h,c)-r,o+=f,l+=f*f;return e?(l-o*o/a)/(a-1):(l-o*o/a)/a}function centerByRow(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)-e[r])}function centerByColumn(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)-e[n])}function centerAll(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)-e)}function getScaleByRow(t){const e=[];for(let r=0;r<t.rows;r++){let n=0;for(let s=0;s<t.columns;s++)n+=Math.pow(t.get(r,s),2)/(t.columns-1);e.push(Math.sqrt(n))}return e}function scaleByRow(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)/e[r])}function getScaleByColumn(t){const e=[];for(let r=0;r<t.columns;r++){let n=0;for(let s=0;s<t.rows;s++)n+=Math.pow(t.get(s,r),2)/(t.rows-1);e.push(Math.sqrt(n))}return e}function scaleByColumn(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)/e[n])}function getScaleAll(t){const e=t.size-1;let r=0;for(let n=0;n<t.columns;n++)for(let s=0;s<t.rows;s++)r+=Math.pow(t.get(s,n),2)/e;return Math.sqrt(r)}function scaleAll(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)/e)}class AbstractMatrix{static from1DArray(e,r,n){if(e*r!==n.length)throw new RangeError("data length does not match given dimensions");let a=new Matrix$2(e,r);for(let o=0;o<e;o++)for(let l=0;l<r;l++)a.set(o,l,n[o*r+l]);return a}static rowVector(e){let r=new Matrix$2(1,e.length);for(let n=0;n<e.length;n++)r.set(0,n,e[n]);return r}static columnVector(e){let r=new Matrix$2(e.length,1);for(let n=0;n<e.length;n++)r.set(n,0,e[n]);return r}static zeros(e,r){return new Matrix$2(e,r)}static ones(e,r){return new Matrix$2(e,r).fill(1)}static rand(e,r,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{random:s=Math.random}=n;let a=new Matrix$2(e,r);for(let o=0;o<e;o++)for(let l=0;l<r;l++)a.set(o,l,s());return a}static randInt(e,r,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{min:s=0,max:a=1e3,random:o=Math.random}=n;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(a))throw new TypeError("max must be an integer");if(s>=a)throw new RangeError("min must be smaller than max");let l=a-s,f=new Matrix$2(e,r);for(let h=0;h<e;h++)for(let c=0;c<r;c++){let u=s+Math.round(o()*l);f.set(h,c,u)}return f}static eye(e,r,n){r===void 0&&(r=e),n===void 0&&(n=1);let s=Math.min(e,r),a=this.zeros(e,r);for(let o=0;o<s;o++)a.set(o,o,n);return a}static diag(e,r,n){let s=e.length;r===void 0&&(r=s),n===void 0&&(n=r);let a=Math.min(s,r,n),o=this.zeros(r,n);for(let l=0;l<a;l++)o.set(l,l,e[l]);return o}static min(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let n=e.rows,s=e.columns,a=new Matrix$2(n,s);for(let o=0;o<n;o++)for(let l=0;l<s;l++)a.set(o,l,Math.min(e.get(o,l),r.get(o,l)));return a}static max(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let n=e.rows,s=e.columns,a=new this(n,s);for(let o=0;o<n;o++)for(let l=0;l<s;l++)a.set(o,l,Math.max(e.get(o,l),r.get(o,l)));return a}static checkMatrix(e){return AbstractMatrix.isMatrix(e)?e:new Matrix$2(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)e.call(this,r,n);return this}to1DArray(){let e=[];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)e.push(this.get(r,n));return e}to2DArray(){let e=[];for(let r=0;r<this.rows;r++){e.push([]);for(let n=0;n<this.columns;n++)e[r].push(this.get(r,n))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let r=0;r<=e;r++)if(this.get(e,r)!==this.get(r,e))return!1;return!0}return!1}isEchelonForm(){let e=0,r=0,n=-1,s=!0,a=!1;for(;e<this.rows&&s;){for(r=0,a=!1;r<this.columns&&a===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>n?(a=!0,n=r):(s=!1,a=!0);e++}return s}isReducedEchelonForm(){let e=0,r=0,n=-1,s=!0,a=!1;for(;e<this.rows&&s;){for(r=0,a=!1;r<this.columns&&a===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>n?(a=!0,n=r):(s=!1,a=!0);for(let o=r+1;o<this.rows;o++)this.get(e,o)!==0&&(s=!1);e++}return s}echelonForm(){let e=this.clone(),r=0,n=0;for(;r<e.rows&&n<e.columns;){let s=r;for(let a=r;a<e.rows;a++)e.get(a,n)>e.get(s,n)&&(s=a);if(e.get(s,n)===0)n++;else{e.swapRows(r,s);let a=e.get(r,n);for(let o=n;o<e.columns;o++)e.set(r,o,e.get(r,o)/a);for(let o=r+1;o<e.rows;o++){let l=e.get(o,n)/e.get(r,n);e.set(o,n,0);for(let f=n+1;f<e.columns;f++)e.set(o,f,e.get(o,f)-e.get(r,f)*l)}r++,n++}}return e}reducedEchelonForm(){let e=this.echelonForm(),r=e.columns,n=e.rows,s=n-1;for(;s>=0;)if(e.maxRow(s)===0)s--;else{let a=0,o=!1;for(;a<n&&o===!1;)e.get(s,a)===1?o=!0:a++;for(let l=0;l<s;l++){let f=e.get(l,a);for(let h=a;h<r;h++){let c=e.get(l,h)-f*e.get(s,h);e.set(l,h,c)}}s--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:n=1}=e;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let s=new Matrix$2(this.rows*r,this.columns*n);for(let a=0;a<r;a++)for(let o=0;o<n;o++)s.setSubMatrix(this,this.rows*a,this.columns*o);return s}fill(e){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,e);return this}neg(){return this.mulS(-1)}getRow(e){checkRowIndex(this,e);let r=[];for(let n=0;n<this.columns;n++)r.push(this.get(e,n));return r}getRowVector(e){return Matrix$2.rowVector(this.getRow(e))}setRow(e,r){checkRowIndex(this,e),r=checkRowVector(this,r);for(let n=0;n<this.columns;n++)this.set(e,n,r[n]);return this}swapRows(e,r){checkRowIndex(this,e),checkRowIndex(this,r);for(let n=0;n<this.columns;n++){let s=this.get(e,n);this.set(e,n,this.get(r,n)),this.set(r,n,s)}return this}getColumn(e){checkColumnIndex(this,e);let r=[];for(let n=0;n<this.rows;n++)r.push(this.get(n,e));return r}getColumnVector(e){return Matrix$2.columnVector(this.getColumn(e))}setColumn(e,r){checkColumnIndex(this,e),r=checkColumnVector(this,r);for(let n=0;n<this.rows;n++)this.set(n,e,r[n]);return this}swapColumns(e,r){checkColumnIndex(this,e),checkColumnIndex(this,r);for(let n=0;n<this.rows;n++){let s=this.get(n,e);this.set(n,e,this.get(n,r)),this.set(n,r,s)}return this}addRowVector(e){e=checkRowVector(this,e);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+e[n]);return this}subRowVector(e){e=checkRowVector(this,e);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-e[n]);return this}mulRowVector(e){e=checkRowVector(this,e);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*e[n]);return this}divRowVector(e){e=checkRowVector(this,e);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/e[n]);return this}addColumnVector(e){e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+e[r]);return this}subColumnVector(e){e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-e[r]);return this}mulColumnVector(e){e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*e[r]);return this}divColumnVector(e){e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/e[r]);return this}mulRow(e,r){checkRowIndex(this,e);for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*r);return this}mulColumn(e,r){checkColumnIndex(this,e);for(let n=0;n<this.rows;n++)this.set(n,e,this.get(n,e)*r);return this}max(){if(this.isEmpty())return NaN;let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>e&&(e=this.get(r,n));return e}maxIndex(){checkNonEmpty(this);let e=this.get(0,0),r=[0,0];for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.get(n,s)>e&&(e=this.get(n,s),r[0]=n,r[1]=s);return r}min(){if(this.isEmpty())return NaN;let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<e&&(e=this.get(r,n));return e}minIndex(){checkNonEmpty(this);let e=this.get(0,0),r=[0,0];for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.get(n,s)<e&&(e=this.get(n,s),r[0]=n,r[1]=s);return r}maxRow(e){if(checkRowIndex(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let n=1;n<this.columns;n++)this.get(e,n)>r&&(r=this.get(e,n));return r}maxRowIndex(e){checkRowIndex(this,e),checkNonEmpty(this);let r=this.get(e,0),n=[e,0];for(let s=1;s<this.columns;s++)this.get(e,s)>r&&(r=this.get(e,s),n[1]=s);return n}minRow(e){if(checkRowIndex(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let n=1;n<this.columns;n++)this.get(e,n)<r&&(r=this.get(e,n));return r}minRowIndex(e){checkRowIndex(this,e),checkNonEmpty(this);let r=this.get(e,0),n=[e,0];for(let s=1;s<this.columns;s++)this.get(e,s)<r&&(r=this.get(e,s),n[1]=s);return n}maxColumn(e){if(checkColumnIndex(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let n=1;n<this.rows;n++)this.get(n,e)>r&&(r=this.get(n,e));return r}maxColumnIndex(e){checkColumnIndex(this,e),checkNonEmpty(this);let r=this.get(0,e),n=[0,e];for(let s=1;s<this.rows;s++)this.get(s,e)>r&&(r=this.get(s,e),n[0]=s);return n}minColumn(e){if(checkColumnIndex(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let n=1;n<this.rows;n++)this.get(n,e)<r&&(r=this.get(n,e));return r}minColumnIndex(e){checkColumnIndex(this,e),checkNonEmpty(this);let r=this.get(0,e),n=[0,e];for(let s=1;s<this.rows;s++)this.get(s,e)<r&&(r=this.get(s,e),n[0]=s);return n}diag(){let e=Math.min(this.rows,this.columns),r=[];for(let n=0;n<e;n++)r.push(this.get(n,n));return r}norm(e="frobenius"){let r=0;if(e==="max")return this.max();if(e==="frobenius"){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)r=r+this.get(n,s)*this.get(n,s);return Math.sqrt(r)}else throw new RangeError(`unknown norm type: ${e}`)}cumulativeSum(){let e=0;for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)e+=this.get(r,n),this.set(r,n,e);return this}dot(e){AbstractMatrix.isMatrix(e)&&(e=e.to1DArray());let r=this.to1DArray();if(r.length!==e.length)throw new RangeError("vectors do not have the same size");let n=0;for(let s=0;s<r.length;s++)n+=r[s]*e[s];return n}mmul(e){e=Matrix$2.checkMatrix(e);let r=this.rows,n=this.columns,s=e.columns,a=new Matrix$2(r,s),o=new Float64Array(n);for(let l=0;l<s;l++){for(let f=0;f<n;f++)o[f]=e.get(f,l);for(let f=0;f<r;f++){let h=0;for(let c=0;c<n;c++)h+=this.get(f,c)*o[c];a.set(f,l,h)}}return a}strassen2x2(e){e=Matrix$2.checkMatrix(e);let r=new Matrix$2(2,2);const n=this.get(0,0),s=e.get(0,0),a=this.get(0,1),o=e.get(0,1),l=this.get(1,0),f=e.get(1,0),h=this.get(1,1),c=e.get(1,1),u=(n+h)*(s+c),g=(l+h)*s,d=n*(o-c),p=h*(f-s),x=(n+a)*c,y=(l-n)*(s+o),m=(a-h)*(f+c),A=u+p-x+m,b=d+x,_=g+p,E=u-g+d+y;return r.set(0,0,A),r.set(0,1,b),r.set(1,0,_),r.set(1,1,E),r}strassen3x3(e){e=Matrix$2.checkMatrix(e);let r=new Matrix$2(3,3);const n=this.get(0,0),s=this.get(0,1),a=this.get(0,2),o=this.get(1,0),l=this.get(1,1),f=this.get(1,2),h=this.get(2,0),c=this.get(2,1),u=this.get(2,2),g=e.get(0,0),d=e.get(0,1),p=e.get(0,2),x=e.get(1,0),y=e.get(1,1),m=e.get(1,2),A=e.get(2,0),b=e.get(2,1),_=e.get(2,2),E=(n+s+a-o-l-c-u)*y,T=(n-o)*(-d+y),I=l*(-g+d+x-y-m-A+_),v=(-n+o+l)*(g-d+y),k=(o+l)*(-g+d),w=n*g,M=(-n+h+c)*(g-p+m),D=(-n+h)*(p-m),R=(h+c)*(-g+p),F=(n+s+a-l-f-h-c)*m,P=c*(-g+p+x-y-m-A+b),H=(-a+c+u)*(y+A-b),Z=(a-u)*(y-b),X=a*A,ee=(c+u)*(-A+b),G=(-a+l+f)*(m+A-_),se=(a-f)*(m-_),ie=(l+f)*(-A+_),Y=s*x,j=f*b,L=o*p,W=h*d,te=u*_,de=w+X+Y,le=E+v+k+w+H+X+ee,ge=w+M+R+F+X+G+ie,xe=T+I+v+w+X+G+se,ye=T+v+k+w+j,pe=X+G+se+ie+L,K=w+M+D+P+H+Z+X,U=H+Z+X+ee+W,me=w+M+D+R+te;return r.set(0,0,de),r.set(0,1,le),r.set(0,2,ge),r.set(1,0,xe),r.set(1,1,ye),r.set(1,2,pe),r.set(2,0,K),r.set(2,1,U),r.set(2,2,me),r}mmulStrassen(e){e=Matrix$2.checkMatrix(e);let r=this.clone(),n=r.rows,s=r.columns,a=e.rows,o=e.columns;s!==a&&console.warn(`Multiplying ${n} x ${s} and ${a} x ${o} matrix: dimensions do not match.`);function l(u,g,d){let p=u.rows,x=u.columns;if(p===g&&x===d)return u;{let y=AbstractMatrix.zeros(g,d);return y=y.setSubMatrix(u,0,0),y}}let f=Math.max(n,a),h=Math.max(s,o);r=l(r,f,h),e=l(e,f,h);function c(u,g,d,p){if(d<=512||p<=512)return u.mmul(g);d%2===1&&p%2===1?(u=l(u,d+1,p+1),g=l(g,d+1,p+1)):d%2===1?(u=l(u,d+1,p),g=l(g,d+1,p)):p%2===1&&(u=l(u,d,p+1),g=l(g,d,p+1));let x=parseInt(u.rows/2,10),y=parseInt(u.columns/2,10),m=u.subMatrix(0,x-1,0,y-1),A=g.subMatrix(0,x-1,0,y-1),b=u.subMatrix(0,x-1,y,u.columns-1),_=g.subMatrix(0,x-1,y,g.columns-1),E=u.subMatrix(x,u.rows-1,0,y-1),T=g.subMatrix(x,g.rows-1,0,y-1),I=u.subMatrix(x,u.rows-1,y,u.columns-1),v=g.subMatrix(x,g.rows-1,y,g.columns-1),k=c(AbstractMatrix.add(m,I),AbstractMatrix.add(A,v),x,y),w=c(AbstractMatrix.add(E,I),A,x,y),M=c(m,AbstractMatrix.sub(_,v),x,y),D=c(I,AbstractMatrix.sub(T,A),x,y),R=c(AbstractMatrix.add(m,b),v,x,y),F=c(AbstractMatrix.sub(E,m),AbstractMatrix.add(A,_),x,y),P=c(AbstractMatrix.sub(b,I),AbstractMatrix.add(T,v),x,y),H=AbstractMatrix.add(k,D);H.sub(R),H.add(P);let Z=AbstractMatrix.add(M,R),X=AbstractMatrix.add(w,D),ee=AbstractMatrix.sub(k,w);ee.add(M),ee.add(F);let G=AbstractMatrix.zeros(2*H.rows,2*H.columns);return G=G.setSubMatrix(H,0,0),G=G.setSubMatrix(Z,H.rows,0),G=G.setSubMatrix(X,0,H.columns),G=G.setSubMatrix(ee,H.rows,H.columns),G.subMatrix(0,d-1,0,p-1)}return c(r,e,f,h)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:n=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(r>=n)throw new RangeError("min must be smaller than max");let s=new Matrix$2(this.rows,this.columns);for(let a=0;a<this.rows;a++){const o=this.getRow(a);o.length>0&&rescale(o,{min:r,max:n,output:o}),s.setRow(a,o)}return s}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:n=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(r>=n)throw new RangeError("min must be smaller than max");let s=new Matrix$2(this.rows,this.columns);for(let a=0;a<this.columns;a++){const o=this.getColumn(a);o.length&&rescale(o,{min:r,max:n,output:o}),s.setColumn(a,o)}return s}flipRows(){const e=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let n=0;n<e;n++){let s=this.get(r,n),a=this.get(r,this.columns-1-n);this.set(r,n,a),this.set(r,this.columns-1-n,s)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let n=0;n<e;n++){let s=this.get(n,r),a=this.get(this.rows-1-n,r);this.set(n,r,a),this.set(this.rows-1-n,r,s)}return this}kroneckerProduct(e){e=Matrix$2.checkMatrix(e);let r=this.rows,n=this.columns,s=e.rows,a=e.columns,o=new Matrix$2(r*s,n*a);for(let l=0;l<r;l++)for(let f=0;f<n;f++)for(let h=0;h<s;h++)for(let c=0;c<a;c++)o.set(s*l+h,a*f+c,this.get(l,f)*e.get(h,c));return o}kroneckerSum(e){if(e=Matrix$2.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,n=e.rows,s=this.kroneckerProduct(Matrix$2.eye(n,n)),a=Matrix$2.eye(r,r).kroneckerProduct(e);return s.add(a)}transpose(){let e=new Matrix$2(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)e.set(n,r,this.get(r,n));return e}sortRows(e=compareNumbers){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(e));return this}sortColumns(e=compareNumbers){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(e));return this}subMatrix(e,r,n,s){checkRange(this,e,r,n,s);let a=new Matrix$2(r-e+1,s-n+1);for(let o=e;o<=r;o++)for(let l=n;l<=s;l++)a.set(o-e,l-n,this.get(o,l));return a}subMatrixRow(e,r,n){if(r===void 0&&(r=0),n===void 0&&(n=this.columns-1),r>n||r<0||r>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let s=new Matrix$2(e.length,n-r+1);for(let a=0;a<e.length;a++)for(let o=r;o<=n;o++){if(e[a]<0||e[a]>=this.rows)throw new RangeError(`Row index out of range: ${e[a]}`);s.set(a,o-r,this.get(e[a],o))}return s}subMatrixColumn(e,r,n){if(r===void 0&&(r=0),n===void 0&&(n=this.rows-1),r>n||r<0||r>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let s=new Matrix$2(n-r+1,e.length);for(let a=0;a<e.length;a++)for(let o=r;o<=n;o++){if(e[a]<0||e[a]>=this.columns)throw new RangeError(`Column index out of range: ${e[a]}`);s.set(o-r,a,this.get(o,e[a]))}return s}setSubMatrix(e,r,n){if(e=Matrix$2.checkMatrix(e),e.isEmpty())return this;let s=r+e.rows-1,a=n+e.columns-1;checkRange(this,r,s,n,a);for(let o=0;o<e.rows;o++)for(let l=0;l<e.columns;l++)this.set(r+o,n+l,e.get(o,l));return this}selection(e,r){checkRowIndices(this,e),checkColumnIndices(this,r);let n=new Matrix$2(e.length,r.length);for(let s=0;s<e.length;s++){let a=e[s];for(let o=0;o<r.length;o++){let l=r[o];n.set(s,o,this.get(a,l))}}return n}trace(){let e=Math.min(this.rows,this.columns),r=0;for(let n=0;n<e;n++)r+=this.get(n,n);return r}clone(){let e=new Matrix$2(this.rows,this.columns);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)e.set(r,n,this.get(r,n));return e}sum(e){switch(e){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const r=this.sum(e);switch(e){case"row":{for(let n=0;n<this.rows;n++)r[n]/=this.columns;return r}case"column":{for(let n=0;n<this.columns;n++)r[n]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:n=!0,mean:s=this.mean(e)}=r;if(typeof n!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!isAnyArray(s))throw new TypeError("mean must be an array");return varianceByRow(this,n,s)}case"column":{if(!isAnyArray(s))throw new TypeError("mean must be an array");return varianceByColumn(this,n,s)}case void 0:{if(typeof s!="number")throw new TypeError("mean must be a number");return varianceAll(this,n,s)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,r){typeof e=="object"&&(r=e,e=void 0);const n=this.variance(e,r);if(e===void 0)return Math.sqrt(n);for(let s=0;s<n.length;s++)n[s]=Math.sqrt(n[s]);return n}center(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:n=this.mean(e)}=r;switch(e){case"row":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByRow(this,n),this}case"column":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByColumn(this,n),this}case void 0:{if(typeof n!="number")throw new TypeError("center must be a number");return centerAll(this,n),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");let n=r.scale;switch(e){case"row":{if(n===void 0)n=getScaleByRow(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByRow(this,n),this}case"column":{if(n===void 0)n=getScaleByColumn(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByColumn(this,n),this}case void 0:{if(n===void 0)n=getScaleAll(this);else if(typeof n!="number")throw new TypeError("scale must be a number");return scaleAll(this,n),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return inspectMatrixWithOptions(this,e)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol!="undefined"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(t,e){return t-e}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;class Matrix$2 extends AbstractMatrix{constructor(e,r){super();if(Matrix$2.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>=0)if(this.data=[],Number.isInteger(r)&&r>=0)for(let n=0;n<e;n++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");else if(isAnyArray(e)){const n=e;if(e=n.length,r=e?n[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let s=0;s<e;s++){if(n[s].length!==r)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(n[s]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=e,this.columns=r}set(e,r,n){return this.data[e][r]=n,this}get(e,r){return this.data[e][r]}removeRow(e){return checkRowIndex(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,r){return r===void 0&&(r=e,e=this.rows),checkRowIndex(this,e,!0),r=Float64Array.from(checkRowVector(this,r)),this.data.splice(e,0,r),this.rows+=1,this}removeColumn(e){checkColumnIndex(this,e);for(let r=0;r<this.rows;r++){const n=new Float64Array(this.columns-1);for(let s=0;s<e;s++)n[s]=this.data[r][s];for(let s=e+1;s<this.columns;s++)n[s-1]=this.data[r][s];this.data[r]=n}return this.columns-=1,this}addColumn(e,r){typeof r=="undefined"&&(r=e,e=this.columns),checkColumnIndex(this,e,!0),r=checkColumnVector(this,r);for(let n=0;n<this.rows;n++){const s=new Float64Array(this.columns+1);let a=0;for(;a<e;a++)s[a]=this.data[n][a];for(s[a++]=r[n];a<this.columns+1;a++)s[a]=this.data[n][a-1];this.data[n]=s}return this.columns+=1,this}}installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(e,r,n){super();this.matrix=e,this.rows=r,this.columns=n}}class MatrixColumnView extends BaseView{constructor(e,r){checkColumnIndex(e,r);super(e,e.rows,1);this.column=r}set(e,r,n){return this.matrix.set(e,this.column,n),this}get(e){return this.matrix.get(e,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(e,r){checkColumnIndices(e,r);super(e,e.rows,r.length);this.columnIndices=r}set(e,r,n){return this.matrix.set(e,this.columnIndices[r],n),this}get(e,r){return this.matrix.get(e,this.columnIndices[r])}}class MatrixFlipColumnView extends BaseView{constructor(e){super(e,e.rows,e.columns)}set(e,r,n){return this.matrix.set(e,this.columns-r-1,n),this}get(e,r){return this.matrix.get(e,this.columns-r-1)}}class MatrixFlipRowView extends BaseView{constructor(e){super(e,e.rows,e.columns)}set(e,r,n){return this.matrix.set(this.rows-e-1,r,n),this}get(e,r){return this.matrix.get(this.rows-e-1,r)}}class MatrixRowView extends BaseView{constructor(e,r){checkRowIndex(e,r);super(e,1,e.columns);this.row=r}set(e,r,n){return this.matrix.set(this.row,r,n),this}get(e,r){return this.matrix.get(this.row,r)}}class MatrixRowSelectionView extends BaseView{constructor(e,r){checkRowIndices(e,r);super(e,r.length,e.columns);this.rowIndices=r}set(e,r,n){return this.matrix.set(this.rowIndices[e],r,n),this}get(e,r){return this.matrix.get(this.rowIndices[e],r)}}class MatrixSelectionView extends BaseView{constructor(e,r,n){checkRowIndices(e,r),checkColumnIndices(e,n);super(e,r.length,n.length);this.rowIndices=r,this.columnIndices=n}set(e,r,n){return this.matrix.set(this.rowIndices[e],this.columnIndices[r],n),this}get(e,r){return this.matrix.get(this.rowIndices[e],this.columnIndices[r])}}class MatrixSubView extends BaseView{constructor(e,r,n,s,a){checkRange(e,r,n,s,a);super(e,n-r+1,a-s+1);this.startRow=r,this.startColumn=s}set(e,r,n){return this.matrix.set(this.startRow+e,this.startColumn+r,n),this}get(e,r){return this.matrix.get(this.startRow+e,this.startColumn+r)}}class MatrixTransposeView$1 extends BaseView{constructor(e){super(e,e.columns,e.rows)}set(e,r,n){return this.matrix.set(r,e,n),this}get(e,r){return this.matrix.get(r,e)}}class WrapperMatrix1D extends AbstractMatrix{constructor(e,r={}){const{rows:n=1}=r;if(e.length%n!==0)throw new Error("the data length is not divisible by the number of rows");super();this.rows=n,this.columns=e.length/n,this.data=e}set(e,r,n){let s=this._calculateIndex(e,r);return this.data[s]=n,this}get(e,r){let n=this._calculateIndex(e,r);return this.data[n]}_calculateIndex(e,r){return e*this.columns+r}}class WrapperMatrix2D extends AbstractMatrix{constructor(e){super();this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,r,n){return this.data[e][r]=n,this}get(e,r){return this.data[e][r]}}function wrap(t,e){if(isAnyArray(t))return t[0]&&isAnyArray(t[0])?new WrapperMatrix2D(t):new WrapperMatrix1D(t,e);throw new Error("the argument is not an array")}class LuDecomposition{constructor(e){e=WrapperMatrix2D.checkMatrix(e);let r=e.clone(),n=r.rows,s=r.columns,a=new Float64Array(n),o=1,l,f,h,c,u,g,d,p,x;for(l=0;l<n;l++)a[l]=l;for(p=new Float64Array(n),f=0;f<s;f++){for(l=0;l<n;l++)p[l]=r.get(l,f);for(l=0;l<n;l++){for(x=Math.min(l,f),u=0,h=0;h<x;h++)u+=r.get(l,h)*p[h];p[l]-=u,r.set(l,f,p[l])}for(c=f,l=f+1;l<n;l++)Math.abs(p[l])>Math.abs(p[c])&&(c=l);if(c!==f){for(h=0;h<s;h++)g=r.get(c,h),r.set(c,h,r.get(f,h)),r.set(f,h,g);d=a[c],a[c]=a[f],a[f]=d,o=-o}if(f<n&&r.get(f,f)!==0)for(l=f+1;l<n;l++)r.set(l,f,r.get(l,f)/r.get(f,f))}this.LU=r,this.pivotVector=a,this.pivotSign=o}isSingular(){let e=this.LU,r=e.columns;for(let n=0;n<r;n++)if(e.get(n,n)===0)return!0;return!1}solve(e){e=Matrix$2.checkMatrix(e);let r=this.LU;if(r.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let s=e.columns,a=e.subMatrixRow(this.pivotVector,0,s-1),o=r.columns,l,f,h;for(h=0;h<o;h++)for(l=h+1;l<o;l++)for(f=0;f<s;f++)a.set(l,f,a.get(l,f)-a.get(h,f)*r.get(l,h));for(h=o-1;h>=0;h--){for(f=0;f<s;f++)a.set(h,f,a.get(h,f)/r.get(h,h));for(l=0;l<h;l++)for(f=0;f<s;f++)a.set(l,f,a.get(l,f)-a.get(h,f)*r.get(l,h))}return a}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,n=e.columns;for(let s=0;s<n;s++)r*=e.get(s,s);return r}get lowerTriangularMatrix(){let e=this.LU,r=e.rows,n=e.columns,s=new Matrix$2(r,n);for(let a=0;a<r;a++)for(let o=0;o<n;o++)a>o?s.set(a,o,e.get(a,o)):a===o?s.set(a,o,1):s.set(a,o,0);return s}get upperTriangularMatrix(){let e=this.LU,r=e.rows,n=e.columns,s=new Matrix$2(r,n);for(let a=0;a<r;a++)for(let o=0;o<n;o++)a<=o?s.set(a,o,e.get(a,o)):s.set(a,o,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):e!==0?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class QrDecomposition{constructor(e){e=WrapperMatrix2D.checkMatrix(e);let r=e.clone(),n=e.rows,s=e.columns,a=new Float64Array(s),o,l,f,h;for(f=0;f<s;f++){let c=0;for(o=f;o<n;o++)c=hypotenuse$1(c,r.get(o,f));if(c!==0){for(r.get(f,f)<0&&(c=-c),o=f;o<n;o++)r.set(o,f,r.get(o,f)/c);for(r.set(f,f,r.get(f,f)+1),l=f+1;l<s;l++){for(h=0,o=f;o<n;o++)h+=r.get(o,f)*r.get(o,l);for(h=-h/r.get(f,f),o=f;o<n;o++)r.set(o,l,r.get(o,l)+h*r.get(o,f))}}a[f]=-c}this.QR=r,this.Rdiag=a}solve(e){e=Matrix$2.checkMatrix(e);let r=this.QR,n=r.rows;if(e.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let s=e.columns,a=e.clone(),o=r.columns,l,f,h,c;for(h=0;h<o;h++)for(f=0;f<s;f++){for(c=0,l=h;l<n;l++)c+=r.get(l,h)*a.get(l,f);for(c=-c/r.get(h,h),l=h;l<n;l++)a.set(l,f,a.get(l,f)+c*r.get(l,h))}for(h=o-1;h>=0;h--){for(f=0;f<s;f++)a.set(h,f,a.get(h,f)/this.Rdiag[h]);for(l=0;l<h;l++)for(f=0;f<s;f++)a.set(l,f,a.get(l,f)-a.get(h,f)*r.get(l,h))}return a.subMatrix(0,o-1,0,s-1)}isFullRank(){let e=this.QR.columns;for(let r=0;r<e;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,r=e.columns,n=new Matrix$2(r,r),s,a;for(s=0;s<r;s++)for(a=0;a<r;a++)s<a?n.set(s,a,e.get(s,a)):s===a?n.set(s,a,this.Rdiag[s]):n.set(s,a,0);return n}get orthogonalMatrix(){let e=this.QR,r=e.rows,n=e.columns,s=new Matrix$2(r,n),a,o,l,f;for(l=n-1;l>=0;l--){for(a=0;a<r;a++)s.set(a,l,0);for(s.set(l,l,1),o=l;o<n;o++)if(e.get(l,l)!==0){for(f=0,a=l;a<r;a++)f+=e.get(a,l)*s.get(a,o);for(f=-f/e.get(l,l),a=l;a<r;a++)s.set(a,o,s.get(a,o)+f*e.get(a,l))}}return s}}class SingularValueDecomposition{constructor(e,r={}){if(e=WrapperMatrix2D.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let n=e.rows,s=e.columns;const{computeLeftSingularVectors:a=!0,computeRightSingularVectors:o=!0,autoTranspose:l=!1}=r;let f=Boolean(a),h=Boolean(o),c=!1,u;if(n<s)if(!l)u=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{u=e.transpose(),n=u.rows,s=u.columns,c=!0;let w=f;f=h,h=w}else u=e.clone();let g=Math.min(n,s),d=Math.min(n+1,s),p=new Float64Array(d),x=new Matrix$2(n,g),y=new Matrix$2(s,s),m=new Float64Array(s),A=new Float64Array(n),b=new Float64Array(d);for(let w=0;w<d;w++)b[w]=w;let _=Math.min(n-1,s),E=Math.max(0,Math.min(s-2,n)),T=Math.max(_,E);for(let w=0;w<T;w++){if(w<_){p[w]=0;for(let M=w;M<n;M++)p[w]=hypotenuse$1(p[w],u.get(M,w));if(p[w]!==0){u.get(w,w)<0&&(p[w]=-p[w]);for(let M=w;M<n;M++)u.set(M,w,u.get(M,w)/p[w]);u.set(w,w,u.get(w,w)+1)}p[w]=-p[w]}for(let M=w+1;M<s;M++){if(w<_&&p[w]!==0){let D=0;for(let R=w;R<n;R++)D+=u.get(R,w)*u.get(R,M);D=-D/u.get(w,w);for(let R=w;R<n;R++)u.set(R,M,u.get(R,M)+D*u.get(R,w))}m[M]=u.get(w,M)}if(f&&w<_)for(let M=w;M<n;M++)x.set(M,w,u.get(M,w));if(w<E){m[w]=0;for(let M=w+1;M<s;M++)m[w]=hypotenuse$1(m[w],m[M]);if(m[w]!==0){m[w+1]<0&&(m[w]=0-m[w]);for(let M=w+1;M<s;M++)m[M]/=m[w];m[w+1]+=1}if(m[w]=-m[w],w+1<n&&m[w]!==0){for(let M=w+1;M<n;M++)A[M]=0;for(let M=w+1;M<n;M++)for(let D=w+1;D<s;D++)A[M]+=m[D]*u.get(M,D);for(let M=w+1;M<s;M++){let D=-m[M]/m[w+1];for(let R=w+1;R<n;R++)u.set(R,M,u.get(R,M)+D*A[R])}}if(h)for(let M=w+1;M<s;M++)y.set(M,w,m[M])}}let I=Math.min(s,n+1);if(_<s&&(p[_]=u.get(_,_)),n<I&&(p[I-1]=0),E+1<I&&(m[E]=u.get(E,I-1)),m[I-1]=0,f){for(let w=_;w<g;w++){for(let M=0;M<n;M++)x.set(M,w,0);x.set(w,w,1)}for(let w=_-1;w>=0;w--)if(p[w]!==0){for(let M=w+1;M<g;M++){let D=0;for(let R=w;R<n;R++)D+=x.get(R,w)*x.get(R,M);D=-D/x.get(w,w);for(let R=w;R<n;R++)x.set(R,M,x.get(R,M)+D*x.get(R,w))}for(let M=w;M<n;M++)x.set(M,w,-x.get(M,w));x.set(w,w,1+x.get(w,w));for(let M=0;M<w-1;M++)x.set(M,w,0)}else{for(let M=0;M<n;M++)x.set(M,w,0);x.set(w,w,1)}}if(h)for(let w=s-1;w>=0;w--){if(w<E&&m[w]!==0)for(let M=w+1;M<s;M++){let D=0;for(let R=w+1;R<s;R++)D+=y.get(R,w)*y.get(R,M);D=-D/y.get(w+1,w);for(let R=w+1;R<s;R++)y.set(R,M,y.get(R,M)+D*y.get(R,w))}for(let M=0;M<s;M++)y.set(M,w,0);y.set(w,w,1)}let v=I-1,k=Number.EPSILON;for(;I>0;){let w,M;for(w=I-2;w>=-1&&w!==-1;w--){const D=Number.MIN_VALUE+k*Math.abs(p[w]+Math.abs(p[w+1]));if(Math.abs(m[w])<=D||Number.isNaN(m[w])){m[w]=0;break}}if(w===I-2)M=4;else{let D;for(D=I-1;D>=w&&D!==w;D--){let R=(D!==I?Math.abs(m[D]):0)+(D!==w+1?Math.abs(m[D-1]):0);if(Math.abs(p[D])<=k*R){p[D]=0;break}}D===w?M=3:D===I-1?M=1:(M=2,w=D)}switch(w++,M){case 1:{let D=m[I-2];m[I-2]=0;for(let R=I-2;R>=w;R--){let F=hypotenuse$1(p[R],D),P=p[R]/F,H=D/F;if(p[R]=F,R!==w&&(D=-H*m[R-1],m[R-1]=P*m[R-1]),h)for(let Z=0;Z<s;Z++)F=P*y.get(Z,R)+H*y.get(Z,I-1),y.set(Z,I-1,-H*y.get(Z,R)+P*y.get(Z,I-1)),y.set(Z,R,F)}break}case 2:{let D=m[w-1];m[w-1]=0;for(let R=w;R<I;R++){let F=hypotenuse$1(p[R],D),P=p[R]/F,H=D/F;if(p[R]=F,D=-H*m[R],m[R]=P*m[R],f)for(let Z=0;Z<n;Z++)F=P*x.get(Z,R)+H*x.get(Z,w-1),x.set(Z,w-1,-H*x.get(Z,R)+P*x.get(Z,w-1)),x.set(Z,R,F)}break}case 3:{const D=Math.max(Math.abs(p[I-1]),Math.abs(p[I-2]),Math.abs(m[I-2]),Math.abs(p[w]),Math.abs(m[w])),R=p[I-1]/D,F=p[I-2]/D,P=m[I-2]/D,H=p[w]/D,Z=m[w]/D,X=((F+R)*(F-R)+P*P)/2,ee=R*P*(R*P);let G=0;(X!==0||ee!==0)&&(X<0?G=0-Math.sqrt(X*X+ee):G=Math.sqrt(X*X+ee),G=ee/(X+G));let se=(H+R)*(H-R)+G,ie=H*Z;for(let Y=w;Y<I-1;Y++){let j=hypotenuse$1(se,ie);j===0&&(j=Number.MIN_VALUE);let L=se/j,W=ie/j;if(Y!==w&&(m[Y-1]=j),se=L*p[Y]+W*m[Y],m[Y]=L*m[Y]-W*p[Y],ie=W*p[Y+1],p[Y+1]=L*p[Y+1],h)for(let te=0;te<s;te++)j=L*y.get(te,Y)+W*y.get(te,Y+1),y.set(te,Y+1,-W*y.get(te,Y)+L*y.get(te,Y+1)),y.set(te,Y,j);if(j=hypotenuse$1(se,ie),j===0&&(j=Number.MIN_VALUE),L=se/j,W=ie/j,p[Y]=j,se=L*m[Y]+W*p[Y+1],p[Y+1]=-W*m[Y]+L*p[Y+1],ie=W*m[Y+1],m[Y+1]=L*m[Y+1],f&&Y<n-1)for(let te=0;te<n;te++)j=L*x.get(te,Y)+W*x.get(te,Y+1),x.set(te,Y+1,-W*x.get(te,Y)+L*x.get(te,Y+1)),x.set(te,Y,j)}m[I-2]=se;break}case 4:{if(p[w]<=0&&(p[w]=p[w]<0?-p[w]:0,h))for(let D=0;D<=v;D++)y.set(D,w,-y.get(D,w));for(;w<v&&!(p[w]>=p[w+1]);){let D=p[w];if(p[w]=p[w+1],p[w+1]=D,h&&w<s-1)for(let R=0;R<s;R++)D=y.get(R,w+1),y.set(R,w+1,y.get(R,w)),y.set(R,w,D);if(f&&w<n-1)for(let R=0;R<n;R++)D=x.get(R,w+1),x.set(R,w+1,x.get(R,w)),x.set(R,w,D);w++}I--;break}}}if(c){let w=y;y=x,x=w}this.m=n,this.n=s,this.s=p,this.U=x,this.V=y}solve(e){let r=e,n=this.threshold,s=this.s.length,a=Matrix$2.zeros(s,s);for(let g=0;g<s;g++)Math.abs(this.s[g])<=n?a.set(g,g,0):a.set(g,g,1/this.s[g]);let o=this.U,l=this.rightSingularVectors,f=l.mmul(a),h=l.rows,c=o.rows,u=Matrix$2.zeros(h,c);for(let g=0;g<h;g++)for(let d=0;d<c;d++){let p=0;for(let x=0;x<s;x++)p+=f.get(g,x)*o.get(d,x);u.set(g,d,p)}return u.mmul(r)}solveForDiagonal(e){return this.solve(Matrix$2.diag(e))}inverse(){let e=this.V,r=this.threshold,n=e.rows,s=e.columns,a=new Matrix$2(n,this.s.length);for(let c=0;c<n;c++)for(let u=0;u<s;u++)Math.abs(this.s[u])>r&&a.set(c,u,e.get(c,u)/this.s[u]);let o=this.U,l=o.rows,f=o.columns,h=new Matrix$2(n,l);for(let c=0;c<n;c++)for(let u=0;u<l;u++){let g=0;for(let d=0;d<f;d++)g+=a.get(c,d)*o.get(u,d);h.set(c,u,g)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,n=this.s;for(let s=0,a=n.length;s<a;s++)n[s]>e&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(t,e=!1){return t=WrapperMatrix2D.checkMatrix(t),e?new SingularValueDecomposition(t).inverse():solve(t,Matrix$2.eye(t.rows))}function solve(t,e,r=!1){return t=WrapperMatrix2D.checkMatrix(t),e=WrapperMatrix2D.checkMatrix(e),r?new SingularValueDecomposition(t).solve(e):t.isSquare()?new LuDecomposition(t).solve(e):new QrDecomposition(t).solve(e)}function determinant(t){if(t=Matrix$2.checkMatrix(t),t.isSquare()){if(t.columns===0)return 1;let e,r,n,s;if(t.columns===2)return e=t.get(0,0),r=t.get(0,1),n=t.get(1,0),s=t.get(1,1),e*s-r*n;if(t.columns===3){let a,o,l;return a=new MatrixSelectionView(t,[1,2],[1,2]),o=new MatrixSelectionView(t,[1,2],[0,2]),l=new MatrixSelectionView(t,[1,2],[0,1]),e=t.get(0,0),r=t.get(0,1),n=t.get(0,2),e*determinant(a)-r*determinant(o)+n*determinant(l)}else return new LuDecomposition(t).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(t,e){let r=[];for(let n=0;n<t;n++)n!==e&&r.push(n);return r}function dependenciesOneRow(t,e,r,n=1e-9,s=1e-9){if(t>s)return new Array(e.rows+1).fill(0);{let a=e.addRow(r,[0]);for(let o=0;o<a.rows;o++)Math.abs(a.get(o,0))<n&&a.set(o,0,0);return a.to1DArray()}}function linearDependencies(t,e={}){const{thresholdValue:r=1e-9,thresholdError:n=1e-9}=e;t=Matrix$2.checkMatrix(t);let s=t.rows,a=new Matrix$2(s,s);for(let o=0;o<s;o++){let l=Matrix$2.columnVector(t.getRow(o)),f=t.subMatrixRow(xrange(s,o)).transpose(),c=new SingularValueDecomposition(f).solve(l),u=Matrix$2.sub(l,f.mmul(c)).abs().max();a.setRow(o,dependenciesOneRow(u,c,o,r,n))}return a}function pseudoInverse(t,e=Number.EPSILON){if(t=Matrix$2.checkMatrix(t),t.isEmpty())return t.transpose();let r=new SingularValueDecomposition(t,{autoTranspose:!0}),n=r.leftSingularVectors,s=r.rightSingularVectors,a=r.diagonal;for(let o=0;o<a.length;o++)Math.abs(a[o])>e?a[o]=1/a[o]:a[o]=0;return s.mmul(Matrix$2.diag(a).mmul(n.transpose()))}function covariance(t,e=t,r={}){t=new Matrix$2(t);let n=!1;if(typeof e=="object"&&!Matrix$2.isMatrix(e)&&!isAnyArray(e)?(r=e,e=t,n=!0):e=new Matrix$2(e),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0}=r;s&&(t=t.center("column"),n||(e=e.center("column")));const a=t.transpose().mmul(e);for(let o=0;o<a.rows;o++)for(let l=0;l<a.columns;l++)a.set(o,l,a.get(o,l)*(1/(t.rows-1)));return a}function correlation(t,e=t,r={}){t=new Matrix$2(t);let n=!1;if(typeof e=="object"&&!Matrix$2.isMatrix(e)&&!isAnyArray(e)?(r=e,e=t,n=!0):e=new Matrix$2(e),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0,scale:a=!0}=r;s&&(t.center("column"),n||e.center("column")),a&&(t.scale("column"),n||e.scale("column"));const o=t.standardDeviation("column",{unbiased:!0}),l=n?o:e.standardDeviation("column",{unbiased:!0}),f=t.transpose().mmul(e);for(let h=0;h<f.rows;h++)for(let c=0;c<f.columns;c++)f.set(h,c,f.get(h,c)*(1/(o[h]*l[c]))*(1/(t.rows-1)));return f}class EigenvalueDecomposition{constructor(e,r={}){const{assumeSymmetric:n=!1}=r;if(e=WrapperMatrix2D.checkMatrix(e),!e.isSquare())throw new Error("Matrix is not a square matrix");if(e.isEmpty())throw new Error("Matrix must be non-empty");let s=e.columns,a=new Matrix$2(s,s),o=new Float64Array(s),l=new Float64Array(s),f=e,h,c,u=!1;if(n?u=!0:u=e.isSymmetric(),u){for(h=0;h<s;h++)for(c=0;c<s;c++)a.set(h,c,f.get(h,c));tred2(s,l,o,a),tql2(s,l,o,a)}else{let g=new Matrix$2(s,s),d=new Float64Array(s);for(c=0;c<s;c++)for(h=0;h<s;h++)g.set(h,c,f.get(h,c));orthes(s,g,d,a),hqr2(s,l,o,a,g)}this.n=s,this.e=l,this.d=o,this.V=a}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let e=this.n,r=this.e,n=this.d,s=new Matrix$2(e,e),a,o;for(a=0;a<e;a++){for(o=0;o<e;o++)s.set(a,o,0);s.set(a,a,n[a]),r[a]>0?s.set(a,a+1,r[a]):r[a]<0&&s.set(a,a-1,r[a])}return s}}function tred2(t,e,r,n){let s,a,o,l,f,h,c,u;for(f=0;f<t;f++)r[f]=n.get(t-1,f);for(l=t-1;l>0;l--){for(u=0,o=0,h=0;h<l;h++)u=u+Math.abs(r[h]);if(u===0)for(e[l]=r[l-1],f=0;f<l;f++)r[f]=n.get(l-1,f),n.set(l,f,0),n.set(f,l,0);else{for(h=0;h<l;h++)r[h]/=u,o+=r[h]*r[h];for(s=r[l-1],a=Math.sqrt(o),s>0&&(a=-a),e[l]=u*a,o=o-s*a,r[l-1]=s-a,f=0;f<l;f++)e[f]=0;for(f=0;f<l;f++){for(s=r[f],n.set(f,l,s),a=e[f]+n.get(f,f)*s,h=f+1;h<=l-1;h++)a+=n.get(h,f)*r[h],e[h]+=n.get(h,f)*s;e[f]=a}for(s=0,f=0;f<l;f++)e[f]/=o,s+=e[f]*r[f];for(c=s/(o+o),f=0;f<l;f++)e[f]-=c*r[f];for(f=0;f<l;f++){for(s=r[f],a=e[f],h=f;h<=l-1;h++)n.set(h,f,n.get(h,f)-(s*e[h]+a*r[h]));r[f]=n.get(l-1,f),n.set(l,f,0)}}r[l]=o}for(l=0;l<t-1;l++){if(n.set(t-1,l,n.get(l,l)),n.set(l,l,1),o=r[l+1],o!==0){for(h=0;h<=l;h++)r[h]=n.get(h,l+1)/o;for(f=0;f<=l;f++){for(a=0,h=0;h<=l;h++)a+=n.get(h,l+1)*n.get(h,f);for(h=0;h<=l;h++)n.set(h,f,n.get(h,f)-a*r[h])}}for(h=0;h<=l;h++)n.set(h,l+1,0)}for(f=0;f<t;f++)r[f]=n.get(t-1,f),n.set(t-1,f,0);n.set(t-1,t-1,1),e[0]=0}function tql2(t,e,r,n){let s,a,o,l,f,h,c,u,g,d,p,x,y,m,A,b;for(o=1;o<t;o++)e[o-1]=e[o];e[t-1]=0;let _=0,E=0,T=Number.EPSILON;for(h=0;h<t;h++){for(E=Math.max(E,Math.abs(r[h])+Math.abs(e[h])),c=h;c<t&&!(Math.abs(e[c])<=T*E);)c++;if(c>h)do{for(s=r[h],u=(r[h+1]-s)/(2*e[h]),g=hypotenuse$1(u,1),u<0&&(g=-g),r[h]=e[h]/(u+g),r[h+1]=e[h]*(u+g),d=r[h+1],a=s-r[h],o=h+2;o<t;o++)r[o]-=a;for(_=_+a,u=r[c],p=1,x=p,y=p,m=e[h+1],A=0,b=0,o=c-1;o>=h;o--)for(y=x,x=p,b=A,s=p*e[o],a=p*u,g=hypotenuse$1(u,e[o]),e[o+1]=A*g,A=e[o]/g,p=u/g,u=p*r[o]-A*s,r[o+1]=a+A*(p*s+A*r[o]),f=0;f<t;f++)a=n.get(f,o+1),n.set(f,o+1,A*n.get(f,o)+p*a),n.set(f,o,p*n.get(f,o)-A*a);u=-A*b*y*m*e[h]/d,e[h]=A*u,r[h]=p*u}while(Math.abs(e[h])>T*E);r[h]=r[h]+_,e[h]=0}for(o=0;o<t-1;o++){for(f=o,u=r[o],l=o+1;l<t;l++)r[l]<u&&(f=l,u=r[l]);if(f!==o)for(r[f]=r[o],r[o]=u,l=0;l<t;l++)u=n.get(l,o),n.set(l,o,n.get(l,f)),n.set(l,f,u)}}function orthes(t,e,r,n){let s=0,a=t-1,o,l,f,h,c,u,g;for(u=s+1;u<=a-1;u++){for(g=0,h=u;h<=a;h++)g=g+Math.abs(e.get(h,u-1));if(g!==0){for(f=0,h=a;h>=u;h--)r[h]=e.get(h,u-1)/g,f+=r[h]*r[h];for(l=Math.sqrt(f),r[u]>0&&(l=-l),f=f-r[u]*l,r[u]=r[u]-l,c=u;c<t;c++){for(o=0,h=a;h>=u;h--)o+=r[h]*e.get(h,c);for(o=o/f,h=u;h<=a;h++)e.set(h,c,e.get(h,c)-o*r[h])}for(h=0;h<=a;h++){for(o=0,c=a;c>=u;c--)o+=r[c]*e.get(h,c);for(o=o/f,c=u;c<=a;c++)e.set(h,c,e.get(h,c)-o*r[c])}r[u]=g*r[u],e.set(u,u-1,g*l)}}for(h=0;h<t;h++)for(c=0;c<t;c++)n.set(h,c,h===c?1:0);for(u=a-1;u>=s+1;u--)if(e.get(u,u-1)!==0){for(h=u+1;h<=a;h++)r[h]=e.get(h,u-1);for(c=u;c<=a;c++){for(l=0,h=u;h<=a;h++)l+=r[h]*n.get(h,c);for(l=l/r[u]/e.get(u,u-1),h=u;h<=a;h++)n.set(h,c,n.get(h,c)+l*r[h])}}}function hqr2(t,e,r,n,s){let a=t-1,o=0,l=t-1,f=Number.EPSILON,h=0,c=0,u=0,g=0,d=0,p=0,x=0,y=0,m,A,b,_,E,T,I,v,k,w,M,D,R,F,P;for(m=0;m<t;m++)for((m<o||m>l)&&(r[m]=s.get(m,m),e[m]=0),A=Math.max(m-1,0);A<t;A++)c=c+Math.abs(s.get(m,A));for(;a>=o;){for(_=a;_>o&&(p=Math.abs(s.get(_-1,_-1))+Math.abs(s.get(_,_)),p===0&&(p=c),!(Math.abs(s.get(_,_-1))<f*p));)_--;if(_===a)s.set(a,a,s.get(a,a)+h),r[a]=s.get(a,a),e[a]=0,a--,y=0;else if(_===a-1){if(I=s.get(a,a-1)*s.get(a-1,a),u=(s.get(a-1,a-1)-s.get(a,a))/2,g=u*u+I,x=Math.sqrt(Math.abs(g)),s.set(a,a,s.get(a,a)+h),s.set(a-1,a-1,s.get(a-1,a-1)+h),v=s.get(a,a),g>=0){for(x=u>=0?u+x:u-x,r[a-1]=v+x,r[a]=r[a-1],x!==0&&(r[a]=v-I/x),e[a-1]=0,e[a]=0,v=s.get(a,a-1),p=Math.abs(v)+Math.abs(x),u=v/p,g=x/p,d=Math.sqrt(u*u+g*g),u=u/d,g=g/d,A=a-1;A<t;A++)x=s.get(a-1,A),s.set(a-1,A,g*x+u*s.get(a,A)),s.set(a,A,g*s.get(a,A)-u*x);for(m=0;m<=a;m++)x=s.get(m,a-1),s.set(m,a-1,g*x+u*s.get(m,a)),s.set(m,a,g*s.get(m,a)-u*x);for(m=o;m<=l;m++)x=n.get(m,a-1),n.set(m,a-1,g*x+u*n.get(m,a)),n.set(m,a,g*n.get(m,a)-u*x)}else r[a-1]=v+u,r[a]=v+u,e[a-1]=x,e[a]=-x;a=a-2,y=0}else{if(v=s.get(a,a),k=0,I=0,_<a&&(k=s.get(a-1,a-1),I=s.get(a,a-1)*s.get(a-1,a)),y===10){for(h+=v,m=o;m<=a;m++)s.set(m,m,s.get(m,m)-v);p=Math.abs(s.get(a,a-1))+Math.abs(s.get(a-1,a-2)),v=k=.75*p,I=-.4375*p*p}if(y===30&&(p=(k-v)/2,p=p*p+I,p>0)){for(p=Math.sqrt(p),k<v&&(p=-p),p=v-I/((k-v)/2+p),m=o;m<=a;m++)s.set(m,m,s.get(m,m)-p);h+=p,v=k=I=.964}for(y=y+1,E=a-2;E>=_&&(x=s.get(E,E),d=v-x,p=k-x,u=(d*p-I)/s.get(E+1,E)+s.get(E,E+1),g=s.get(E+1,E+1)-x-d-p,d=s.get(E+2,E+1),p=Math.abs(u)+Math.abs(g)+Math.abs(d),u=u/p,g=g/p,d=d/p,!(E===_||Math.abs(s.get(E,E-1))*(Math.abs(g)+Math.abs(d))<f*(Math.abs(u)*(Math.abs(s.get(E-1,E-1))+Math.abs(x)+Math.abs(s.get(E+1,E+1))))));)E--;for(m=E+2;m<=a;m++)s.set(m,m-2,0),m>E+2&&s.set(m,m-3,0);for(b=E;b<=a-1&&(F=b!==a-1,b!==E&&(u=s.get(b,b-1),g=s.get(b+1,b-1),d=F?s.get(b+2,b-1):0,v=Math.abs(u)+Math.abs(g)+Math.abs(d),v!==0&&(u=u/v,g=g/v,d=d/v)),v!==0);b++)if(p=Math.sqrt(u*u+g*g+d*d),u<0&&(p=-p),p!==0){for(b!==E?s.set(b,b-1,-p*v):_!==E&&s.set(b,b-1,-s.get(b,b-1)),u=u+p,v=u/p,k=g/p,x=d/p,g=g/u,d=d/u,A=b;A<t;A++)u=s.get(b,A)+g*s.get(b+1,A),F&&(u=u+d*s.get(b+2,A),s.set(b+2,A,s.get(b+2,A)-u*x)),s.set(b,A,s.get(b,A)-u*v),s.set(b+1,A,s.get(b+1,A)-u*k);for(m=0;m<=Math.min(a,b+3);m++)u=v*s.get(m,b)+k*s.get(m,b+1),F&&(u=u+x*s.get(m,b+2),s.set(m,b+2,s.get(m,b+2)-u*d)),s.set(m,b,s.get(m,b)-u),s.set(m,b+1,s.get(m,b+1)-u*g);for(m=o;m<=l;m++)u=v*n.get(m,b)+k*n.get(m,b+1),F&&(u=u+x*n.get(m,b+2),n.set(m,b+2,n.get(m,b+2)-u*d)),n.set(m,b,n.get(m,b)-u),n.set(m,b+1,n.get(m,b+1)-u*g)}}}if(c!==0){for(a=t-1;a>=0;a--)if(u=r[a],g=e[a],g===0)for(_=a,s.set(a,a,1),m=a-1;m>=0;m--){for(I=s.get(m,m)-u,d=0,A=_;A<=a;A++)d=d+s.get(m,A)*s.get(A,a);if(e[m]<0)x=I,p=d;else if(_=m,e[m]===0?s.set(m,a,I!==0?-d/I:-d/(f*c)):(v=s.get(m,m+1),k=s.get(m+1,m),g=(r[m]-u)*(r[m]-u)+e[m]*e[m],T=(v*p-x*d)/g,s.set(m,a,T),s.set(m+1,a,Math.abs(v)>Math.abs(x)?(-d-I*T)/v:(-p-k*T)/x)),T=Math.abs(s.get(m,a)),f*T*T>1)for(A=m;A<=a;A++)s.set(A,a,s.get(A,a)/T)}else if(g<0)for(_=a-1,Math.abs(s.get(a,a-1))>Math.abs(s.get(a-1,a))?(s.set(a-1,a-1,g/s.get(a,a-1)),s.set(a-1,a,-(s.get(a,a)-u)/s.get(a,a-1))):(P=cdiv(0,-s.get(a-1,a),s.get(a-1,a-1)-u,g),s.set(a-1,a-1,P[0]),s.set(a-1,a,P[1])),s.set(a,a-1,0),s.set(a,a,1),m=a-2;m>=0;m--){for(w=0,M=0,A=_;A<=a;A++)w=w+s.get(m,A)*s.get(A,a-1),M=M+s.get(m,A)*s.get(A,a);if(I=s.get(m,m)-u,e[m]<0)x=I,d=w,p=M;else if(_=m,e[m]===0?(P=cdiv(-w,-M,I,g),s.set(m,a-1,P[0]),s.set(m,a,P[1])):(v=s.get(m,m+1),k=s.get(m+1,m),D=(r[m]-u)*(r[m]-u)+e[m]*e[m]-g*g,R=(r[m]-u)*2*g,D===0&&R===0&&(D=f*c*(Math.abs(I)+Math.abs(g)+Math.abs(v)+Math.abs(k)+Math.abs(x))),P=cdiv(v*d-x*w+g*M,v*p-x*M-g*w,D,R),s.set(m,a-1,P[0]),s.set(m,a,P[1]),Math.abs(v)>Math.abs(x)+Math.abs(g)?(s.set(m+1,a-1,(-w-I*s.get(m,a-1)+g*s.get(m,a))/v),s.set(m+1,a,(-M-I*s.get(m,a)-g*s.get(m,a-1))/v)):(P=cdiv(-d-k*s.get(m,a-1),-p-k*s.get(m,a),x,g),s.set(m+1,a-1,P[0]),s.set(m+1,a,P[1]))),T=Math.max(Math.abs(s.get(m,a-1)),Math.abs(s.get(m,a))),f*T*T>1)for(A=m;A<=a;A++)s.set(A,a-1,s.get(A,a-1)/T),s.set(A,a,s.get(A,a)/T)}for(m=0;m<t;m++)if(m<o||m>l)for(A=m;A<t;A++)n.set(m,A,s.get(m,A));for(A=t-1;A>=o;A--)for(m=o;m<=l;m++){for(x=0,b=o;b<=Math.min(A,l);b++)x=x+n.get(m,b)*s.get(b,A);n.set(m,A,x)}}}function cdiv(t,e,r,n){let s,a;return Math.abs(r)>Math.abs(n)?(s=n/r,a=r+s*n,[(t+s*e)/a,(e-s*t)/a]):(s=r/n,a=n+s*r,[(s*t+e)/a,(s*e-t)/a])}class CholeskyDecomposition{constructor(e){if(e=WrapperMatrix2D.checkMatrix(e),!e.isSymmetric())throw new Error("Matrix is not symmetric");let r=e,n=r.rows,s=new Matrix$2(n,n),a=!0,o,l,f;for(l=0;l<n;l++){let h=0;for(f=0;f<l;f++){let c=0;for(o=0;o<f;o++)c+=s.get(f,o)*s.get(l,o);c=(r.get(l,f)-c)/s.get(f,f),s.set(l,f,c),h=h+c*c}for(h=r.get(l,l)-h,a&=h>0,s.set(l,l,Math.sqrt(Math.max(h,0))),f=l+1;f<n;f++)s.set(l,f,0)}this.L=s,this.positiveDefinite=Boolean(a)}isPositiveDefinite(){return this.positiveDefinite}solve(e){e=WrapperMatrix2D.checkMatrix(e);let r=this.L,n=r.rows;if(e.rows!==n)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let s=e.columns,a=e.clone(),o,l,f;for(f=0;f<n;f++)for(l=0;l<s;l++){for(o=0;o<f;o++)a.set(f,l,a.get(f,l)-a.get(o,l)*r.get(f,o));a.set(f,l,a.get(f,l)/r.get(f,f))}for(f=n-1;f>=0;f--)for(l=0;l<s;l++){for(o=f+1;o<n;o++)a.set(f,l,a.get(f,l)-a.get(o,l)*r.get(o,f));a.set(f,l,a.get(f,l)/r.get(f,f))}return a}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(e,r={}){e=WrapperMatrix2D.checkMatrix(e);let{Y:n}=r;const{scaleScores:s=!1,maxIterations:a=1e3,terminationCriteria:o=1e-10}=r;let l;if(n){if(isAnyArray(n)&&typeof n[0]=="number"?n=Matrix$2.columnVector(n):n=WrapperMatrix2D.checkMatrix(n),n.rows!==e.rows)throw new Error("Y should have the same number of rows as X");l=n.getColumnVector(0)}else l=e.getColumnVector(0);let f=1,h,c,u,g;for(let d=0;d<a&&f>o;d++)u=e.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),u=u.div(u.norm()),h=e.mmul(u).div(u.transpose().mmul(u).get(0,0)),d>0&&(f=h.clone().sub(g).pow(2).sum()),g=h.clone(),n?(c=n.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),c=c.div(c.norm()),l=n.mmul(c).div(c.transpose().mmul(c).get(0,0))):l=h;if(n){let d=e.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0));d=d.div(d.norm());let p=e.clone().sub(h.clone().mmul(d.transpose())),x=l.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),y=n.clone().sub(h.clone().mulS(x.get(0,0)).mmul(c.transpose()));this.t=h,this.p=d.transpose(),this.w=u.transpose(),this.q=c,this.u=l,this.s=h.transpose().mmul(h),this.xResidual=p,this.yResidual=y,this.betas=x}else this.w=u.transpose(),this.s=h.transpose().mmul(h).sqrt(),s?this.t=h.clone().div(this.s.get(0,0)):this.t=h,this.xResidual=e.sub(h.mmul(u.transpose()))}}var src$1=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix,default:Matrix$2,Matrix:Matrix$2,wrap,WrapperMatrix1D,WrapperMatrix2D,solve,inverse,determinant,linearDependencies,pseudoInverse,covariance,correlation,SingularValueDecomposition,SVD:SingularValueDecomposition,EigenvalueDecomposition,EVD:EigenvalueDecomposition,CholeskyDecomposition,CHO:CholeskyDecomposition,LuDecomposition,LU:LuDecomposition,QrDecomposition,QR:QrDecomposition,Nipals:nipals,NIPALS:nipals,MatrixColumnView,MatrixColumnSelectionView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowView,MatrixRowSelectionView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1},Symbol.toStringTag,{value:"Module"}));function getSeparatedKernel(t){const e=new SingularValueDecomposition(t,{autoTranspose:!0});if(e.rank!==1)return null;const r=Math.sqrt(e.s[0]),n=e.U.to2DArray().map(a=>a[0]*r),s=e.V.to2DArray().map(a=>a[0]*r);return[n,s]}function convolution(t,e={}){let{channels:r,bitDepth:n,normalize:s=!1,divisor:a=1,border:o="copy",algorithm:l="auto"}=e,f={};n&&(f.bitDepth=n);let h=Image.createFrom(this,f);if(r=validateArrayOfChannels(this,r),l!=="separable")({kernel:t}=validateKernel(t));else if(!Array.isArray(t)||t.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(l==="auto"){let _=getSeparatedKernel(t);_!==null?(l="separable",t=_):(t.length>9||t[0].length>9)&&this.width<=4096&&this.height<=4096?l="fft":l="direct"}let c,u;l==="separable"?(c=Math.floor(t[0].length/2),u=Math.floor(t[1].length/2)):(c=Math.floor(t.length/2),u=Math.floor(t[0].length/2));let g=h.isClamped,d=new Array(this.height*this.width),p,x,y,m,A,b;for(m=0;m<r.length;m++){for(A=r[m],y=0;y<this.height;y++)for(x=0;x<this.width;x++)p=y*this.width+x,d[p]=this.data[p*this.channels+A];if(l==="direct")b=src$2.direct(d,t,{rows:this.height,cols:this.width,normalize:s,divisor:a});else if(l==="separable"){if(b=convolutionSeparable(d,t,this.width,this.height),s){a=0;for(let _=0;_<t[0].length;_++)for(let E=0;E<t[1].length;E++)a+=t[0][_]*t[1][E]}if(a!==1)for(let _=0;_<b.length;_++)b[_]/=a}else b=src$2.fft(d,t,{rows:this.height,cols:this.width,normalize:s,divisor:a});for(y=0;y<this.height;y++)for(x=0;x<this.width;x++)p=y*this.width+x,g?h.data[p*this.channels+A]=clamp(b[p],h):h.data[p*this.channels+A]=b[p]}if(this.alpha&&!r.includes(this.channels))for(x=this.components;x<this.data.length;x=x+this.channels)h.data[x]=this.data[x];return o!=="periodic"&&h.setBorder({size:[u,c],algorithm:o}),h}function gradientFilter(t={}){let{direction:e="xy",border:r="copy",kernelX:n,kernelY:s,channels:a,bitDepth:o=this.bitDepth}=t;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),e){case"x":if(!n)throw new Error("kernelX option is missing");return convolution.call(this,n,{channels:a,border:r,bitDepth:o});case"y":if(!s)throw new Error("kernelY option is missing");return convolution.call(this,s,{channels:a,border:r,bitDepth:o});case"xy":{if(!n)throw new Error("kernelX option is missing");if(!s)throw new Error("kernelY option is missing");const l=convolution.call(this,n,{channels:a,border:r,bitDepth:32}),f=convolution.call(this,s,{channels:a,border:r,bitDepth:32});return l.hypotenuse(f,{bitDepth:o,channels:a})}default:throw new Error(`Unknown parameter direction: ${e}`)}}function sobelFilter(t){return gradientFilter.call(this,Object.assign({},t,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(t){return gradientFilter.call(this,Object.assign({},t,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(t,e){t=t||0;for(var r=new Array(t),n=0;n<t;n++)r[n]=e;return r}function level(t={}){let{algorithm:e="range",channels:r,min:n=this.min,max:s=this.max}=t;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),r=validateArrayOfChannels(this,{channels:r}),r.length!==this.channel&&(Array.isArray(n)&&n.length===this.channels&&(n=n.filter((a,o)=>r.includes(o))),Array.isArray(s)&&s.length===this.channels&&(s=s.filter((a,o)=>r.includes(o)))),e){case"range":n<0&&(n=0),s>this.maxValue&&(s=this.maxValue),Array.isArray(n)||(n=newArray_1(r.length,n)),Array.isArray(s)||(s=newArray_1(r.length,s)),processImage(this,n,s,r);break;default:throw new Error(`level: algorithm not implement: ${e}`)}return this}function processImage(t,e,r,n){let s=1e-5,a=new Array(n.length);for(let o=0;o<n.length;o++)e[o]===0&&r[o]===t.maxValue||r[o]===e[o]?a[o]=0:a[o]=(t.maxValue+1-s)/(r[o]-e[o]),e[o]+=(.5-s/2)/a[o];for(let o=0;o<n.length;o++){let l=n[o];if(a[o]!==0)for(let f=0;f<t.data.length;f+=t.channels)t.data[f+l]=Math.min(Math.max(0,(t.data[f+l]-e[o])*a[o]+.5|0),t.maxValue)}}var toString=Object.prototype.toString,isArrayType=function t(e){return toString.call(e).substr(-6,5)==="Array"};function checkNumberArray(t){if(isNaN(t)){if(t instanceof Image)return t.data;if(!isArrayType(t))throw new Error("checkNumberArray: the value should be either a number, array or Image");return t}else{if(t<=0)throw new Error("checkNumberArray: the value must be greater than 0");return t}}function add(t,e={}){let{channels:r}=e;if(this.checkProcessable("add",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("add: the data size is different");for(let n=0;n<r.length;n++){let s=r[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.max(0,Math.min(this.maxValue,this.data[a+s]+t[a+s]>>0))}}else for(let n=0;n<r.length;n++){let s=r[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.min(this.maxValue,this.data[a+s]+t>>0)}return this}function subtract(t,e={}){let{channels:r}=e;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("subtract: the data size is different");for(let n=0;n<r.length;n++){let s=r[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.max(0,Math.min(this.maxValue,this.data[a+s]-t[a+s]>>0))}}else for(let n=0;n<r.length;n++){let s=r[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.max(0,this.data[a+s]-t>>0)}return this}function subtractImage(t,e={}){let{channels:r,absolute:n=!1}=e;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==t.width||this.height!==t.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("subtractImage: both images must have the same number of channels");let s=this.clone();r=validateArrayOfChannels(this,{channels:r});for(let a=0;a<r.length;a++){let o=r[a];for(let l=o;l<this.data.length;l+=this.channels){let f=this.data[l]-t.data[l];n?s.data[l]=Math.abs(f):s.data[l]=Math.max(f,0)}}return s}function hypotenuse(t,e={}){let{bitDepth:r=this.bitDepth,channels:n}=e;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==t.width||this.height!==t.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("hypotenuse: both images must have the same number of channels");let s=Image.createFrom(this,{bitDepth:r});n=validateArrayOfChannels(this,{channels:n});let a=s.isClamped;for(let o=0;o<n.length;o++){let l=n[o];for(let f=l;f<this.data.length;f+=this.channels){let h=Math.hypot(this.data[f],t.data[f]);a?s.data[f]=Math.min(Math.max(Math.round(h),0),s.maxValue):s.data[f]=h}}return s}function multiply(t,e={}){let{channels:r}=e;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),t<=0)throw new Error("multiply: the value must be greater than 0");if(r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("multiply: the data size is different");for(let n=0;n<r.length;n++){let s=r[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.max(0,Math.min(this.maxValue,this.data[a+s]*t[a+s]>>0))}}else for(let n=0;n<r.length;n++){let s=r[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.min(this.maxValue,this.data[a+s]*t>>0)}return this}function divide(t,e={}){let{channels:r}=e;if(this.checkProcessable("divide",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("divide: the: the data size is different");for(let n=0;n<r.length;n++){let s=r[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.max(0,Math.min(this.maxValue,this.data[a+s]/t[a+s]>>0))}}else for(let n=0;n<r.length;n++){let s=r[n];for(let a=0;a<this.data.length;a+=this.channels)this.data[a+s]=Math.min(this.maxValue,this.data[a+s]/t>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(e){if(typeof e=="number")return this._predict(e);if(isAnyArray(e)){const r=[];for(let n=0;n<e.length;n++)r.push(this._predict(e[n]));return r}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(e,r){if(!isAnyArray(e)||!isAnyArray(r)||e.length!==r.length)throw new Error("x and y must be arrays of the same length");const n=e.length,s=new Array(n);for(let d=0;d<n;d++)s[d]=this._predict(e[d]);let a=0,o=0,l=0,f=0,h=0,c=0,u=0;for(let d=0;d<n;d++)a+=s[d],o+=r[d],h+=s[d]*s[d],c+=r[d]*r[d],u+=s[d]*r[d],r[d]!==0&&(l+=(r[d]-s[d])*(r[d]-s[d])/r[d]),f+=(r[d]-s[d])*(r[d]-s[d]);const g=(n*u-a*o)/Math.sqrt((n*h-a*a)*(n*c-o*o));return{r:g,r2:g*g,chi2:l,rmsd:Math.sqrt(f/n)}}}var require$$0$1=getAugmentedNamespace(src$1);function squaredEuclidean$4(t,e){let r=0;for(let n=0;n<t.length;n++)r+=(t[n]-e[n])*(t[n]-e[n]);return r}function euclidean$2(t,e){return Math.sqrt(squaredEuclidean$4(t,e))}var euclidean$3=Object.freeze(Object.defineProperty({__proto__:null,squaredEuclidean:squaredEuclidean$4,euclidean:euclidean$2},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(euclidean$3);const{squaredEuclidean:squaredEuclidean$3}=require$$0,defaultOptions$b={sigma:1};class GaussianKernel$1{constructor(e){e=Object.assign({},defaultOptions$b,e),this.sigma=e.sigma,this.divisor=2*e.sigma*e.sigma}compute(e,r){const n=squaredEuclidean$3(e,r);return Math.exp(-n/this.divisor)}}var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};class PolynomialKernel$1{constructor(e){e=Object.assign({},defaultOptions$a,e),this.degree=e.degree,this.constant=e.constant,this.scale=e.scale}compute(e,r){for(var n=0,s=0;s<e.length;s++)n+=e[s]*r[s];return Math.pow(this.scale*n+this.constant,this.degree)}}var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};class SigmoidKernel$1{constructor(e){e=Object.assign({},defaultOptions$9,e),this.alpha=e.alpha,this.constant=e.constant}compute(e,r){for(var n=0,s=0;s<e.length;s++)n+=e[s]*r[s];return Math.tanh(this.alpha*n+this.constant)}}var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};class ANOVAKernel$1{constructor(e){e=Object.assign({},defaultOptions$8,e),this.sigma=e.sigma,this.degree=e.degree}compute(e,r){for(var n=0,s=Math.min(e.length,r.length),a=1;a<=s;++a)n+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(e[a-1],a)-Math.pow(r[a-1],a),2)),this.degree);return n}}var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0,defaultOptions$7={sigma:1};class CauchyKernel$1{constructor(e){e=Object.assign({},defaultOptions$7,e),this.sigma=e.sigma}compute(e,r){return 1/(1+squaredEuclidean$2(e,r)/(this.sigma*this.sigma))}}var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0,defaultOptions$6={sigma:1};class ExponentialKernel$1{constructor(e){e=Object.assign({},defaultOptions$6,e),this.sigma=e.sigma,this.divisor=2*e.sigma*e.sigma}compute(e,r){const n=euclidean$1(e,r);return Math.exp(-n/this.divisor)}}var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(e,r){for(var n=Math.min(e.length,r.length),s=0,a=0;a<n;++a)s+=Math.min(e[a],r[a]);return s}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0,defaultOptions$5={sigma:1};class LaplacianKernel$1{constructor(e){e=Object.assign({},defaultOptions$5,e),this.sigma=e.sigma}compute(e,r){const n=euclidean(e,r);return Math.exp(-n/this.sigma)}}var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0,defaultOptions$4={constant:1};class MultiquadraticKernel$1{constructor(e){e=Object.assign({},defaultOptions$4,e),this.constant=e.constant}compute(e,r){return Math.sqrt(squaredEuclidean$1(e,r)+this.constant*this.constant)}}var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(e){e=Object.assign({},defaultOptions$3,e),this.constant=e.constant}compute(e,r){const n=squaredEuclidean(e,r);return 1-n/(n+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$1,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(e,r){if(this.kernelType=e,e!=="linear")if(typeof e=="string"){e=e.toLowerCase();var n=kernelType[e];if(n)this.kernelFunction=new n(r);else throw new Error(`unsupported kernel type: ${e}`)}else if(typeof e=="object"&&typeof e.compute=="function")this.kernelFunction=e;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(e,r){if(e=Matrix$1.checkMatrix(e),r===void 0?r=e:r=Matrix$1.checkMatrix(r),this.kernelType==="linear")return e.mmul(new MatrixTransposeView(r));const n=new Matrix$1(e.rows,r.rows);if(e===r)for(let s=0;s<e.rows;s++)for(let a=s;a<e.rows;a++){const o=this.kernelFunction.compute(e.getRow(s),e.getRow(a));n.set(s,a,o),n.set(a,s,o)}else for(let s=0;s<e.rows;s++)for(let a=0;a<r.rows;a++)n.set(s,a,this.kernelFunction.compute(e.getRow(s),r.getRow(a)));return n}}var kernel=Kernel;const defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(e,r,n){super();if(e===!0)this.alpha=r.alpha,this.inputs=r.inputs,this.kernelType=r.kernelType,this.kernelOptions=r.kernelOptions,this.kernel=new kernel(r.kernelType,r.kernelOptions);else{e=Matrix$2.checkMatrix(e),n=Object.assign({},defaultOptions$2,n);const s=new kernel(n.kernelType,n.kernelOptions),a=s.compute(e),o=e.rows;a.add(Matrix$2.eye(o,o).mul(n.lambda)),this.alpha=solve(a,r),this.inputs=e,this.kernelType=n.kernelType,this.kernelOptions=n.kernelOptions,this.kernel=s}}_predict(e){return this.kernel.compute([e],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(e){if(e.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,e)}}function background$1(t,e,r){const n=new KernelRidgeRegression(t,e,r),s=new Array(this.size);for(let l=0;l<this.width;l++)for(let f=0;f<this.height;f++)s[f*this.width+l]=[l,f];const a=n.predict(s),o=Image.createFrom(this);for(let l=0;l<this.size;l++)o.data[l]=Math.min(this.maxValue,Math.max(0,a[l][0]));return o}function dilate(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const a of e)for(const o of a)if(o!==1){n=!1;break e}let s=this;for(let a=0;a<r;a++)if(this.bitDepth===1)if(n){const o=s.clone();s=dilateOnceBinaryOnlyOnes(s,o,e.length,e[0].length)}else{const o=Image.createFrom(s);s=dilateOnceBinary(s,o,e)}else if(n){const o=Image.createFrom(s);s=dilateOnceGreyOnlyOnes(s,o,e.length,e[0].length)}else{const o=Image.createFrom(s);s=dilateOnceGrey(s,o,e)}return s}function dilateOnceGrey(t,e,r){const n=r.length,s=r[0].length;let a=(n-1)/2,o=(s-1)/2;for(let l=0;l<t.height;l++)for(let f=0;f<t.width;f++){let h=0;for(let c=0;c<s;c++)for(let u=0;u<n;u++){if(r[u][c]!==1)continue;let g=u-a+f,d=c-o+l;if(g<0||d<0||g>=t.width||d>=t.height)continue;const p=t.getValueXY(g,d,0);p>h&&(h=p)}e.setValueXY(f,l,0,h)}return e}function dilateOnceGreyOnlyOnes(t,e,r,n){const s=(r-1)/2,a=(n-1)/2,o=[];for(let l=0;l<t.width;l++)o.push(0);for(let l=0;l<t.height;l++){for(let f=0;f<t.width;f++){let h=0;for(let c=Math.max(0,l-a);c<Math.min(t.height,l+a+1);c++){const u=t.getValueXY(f,c,0);u>h&&(h=u)}o[f]=h}for(let f=0;f<t.width;f++){let h=0;for(let c=Math.max(0,f-s);c<Math.min(t.width,f+s+1);c++)o[c]>h&&(h=o[c]);e.setValueXY(f,l,0,h)}}return e}function dilateOnceBinary(t,e,r){const n=r.length,s=r[0].length;let a=(n-1)/2,o=(s-1)/2;for(let l=0;l<t.height;l++)for(let f=0;f<t.width;f++){let h=0;e:for(let c=0;c<s;c++)for(let u=0;u<n;u++){if(r[u][c]!==1)continue;let g=u-a+f,d=c-o+l;if(d<0||g<0||g>=t.width||d>=t.height)continue;if(t.getBitXY(g,d)===1){h=1;break e}}h===1&&e.setBitXY(f,l)}return e}function dilateOnceBinaryOnlyOnes(t,e,r,n){const s=(r-1)/2,a=(n-1)/2,o=[];for(let l=0;l<t.width;l++)o.push(1);for(let l=0;l<t.height;l++){for(let f=0;f<t.width;f++){o[f]=0;for(let h=Math.max(0,l-a);h<Math.min(t.height,l+a+1);h++)if(t.getBitXY(f,h)===1){o[f]=1;break}}for(let f=0;f<t.width;f++)if(e.getBitXY(f,l)!==1){for(let h=Math.max(0,f-s);h<Math.min(t.width,f+s+1);h++)if(o[h]===1){e.setBitXY(f,l);break}}}return e}function erode(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const a of e)for(const o of a)if(o!==1){n=!1;break e}let s=this;for(let a=0;a<r;a++)if(this.bitDepth===1)if(n){const o=s.clone();s=erodeOnceBinaryOnlyOnes(s,o,e.length,e[0].length)}else{const o=Image.createFrom(s);s=erodeOnceBinary(s,o,e)}else if(n){const o=Image.createFrom(s);s=erodeOnceGreyOnlyOnes(s,o,e.length,e[0].length)}else{const o=Image.createFrom(s);s=erodeOnceGrey(s,o,e)}return s}function erodeOnceGrey(t,e,r){const n=r.length,s=r[0].length;let a=(n-1)/2,o=(s-1)/2;for(let l=0;l<t.height;l++)for(let f=0;f<t.width;f++){let h=t.maxValue;for(let c=0;c<s;c++)for(let u=0;u<n;u++){if(r[u][c]!==1)continue;let g=u-a+f,d=c-o+l;if(g<0||d<0||g>=t.width||d>=t.height)continue;const p=t.getValueXY(g,d,0);p<h&&(h=p)}e.setValueXY(f,l,0,h)}return e}function erodeOnceGreyOnlyOnes(t,e,r,n){const s=(r-1)/2,a=(n-1)/2,o=[];for(let l=0;l<t.width;l++)o.push(0);for(let l=0;l<t.height;l++){for(let f=0;f<t.width;f++){let h=t.maxValue;for(let c=Math.max(0,l-a);c<Math.min(t.height,l+a+1);c++){const u=t.getValueXY(f,c,0);u<h&&(h=u)}o[f]=h}for(let f=0;f<t.width;f++){let h=t.maxValue;for(let c=Math.max(0,f-s);c<Math.min(t.width,f+s+1);c++)o[c]<h&&(h=o[c]);e.setValueXY(f,l,0,h)}}return e}function erodeOnceBinary(t,e,r){const n=r.length,s=r[0].length;let a=(n-1)/2,o=(s-1)/2;for(let l=0;l<t.height;l++)for(let f=0;f<t.width;f++){let h=1;e:for(let c=0;c<s;c++)for(let u=0;u<n;u++){if(r[u][c]!==1)continue;let g=u-a+f,d=c-o+l;if(d<0||g<0||g>=t.width||d>=t.height)continue;if(t.getBitXY(g,d)===0){h=0;break e}}h===1&&e.setBitXY(f,l)}return e}function erodeOnceBinaryOnlyOnes(t,e,r,n){const s=(r-1)/2,a=(n-1)/2,o=[];for(let l=0;l<t.width;l++)o.push(0);for(let l=0;l<t.height;l++){for(let f=0;f<t.width;f++){o[f]=1;for(let h=Math.max(0,l-a);h<Math.min(t.height,l+a+1);h++)if(t.getBitXY(f,h)===0){o[f]=0;break}}for(let f=0;f<t.width;f++)if(e.getBitXY(f,l)!==0){for(let h=Math.max(0,f-s);h<Math.min(t.width,f+s+1);h++)if(o[h]===0){e.clearBitXY(f,l);break}}}return e}function open(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let n=this;for(let s=0;s<r;s++)n=n.erode({kernel:e}),n=n.dilate({kernel:e});return n}function close(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let n=this;for(let s=0;s<r;s++)n=n.dilate({kernel:e}).erode({kernel:e});return n}function topHat(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),e.length%2===0||e[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let n=this;for(let s=0;s<r;s++)n=n.open({kernel:e}).subtractImage(n,{absolute:!0});return n}function blackHat(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let n=this;for(let s=0;s<r;s++)n=n.close({kernel:e}).subtractImage(n,{absolute:!0});return n}function morphologicalGradient(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2===0||e.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let n=this;for(let s=0;s<r;s++){let a=n.dilate({kernel:e}),o=n.erode({kernel:e});n=a.subtractImage(o,{absolute:!0})}return n}function order4Points(t){let e=0,r=0,n=0,s=0,a=t[0][0],o=0;for(let h=1;h<t.length;h++)t[h][0]<a&&(a=t[h][0],o=h);let l=t[(o+1)%t.length][0],f=(o+1)%t.length;for(let h=1;h<t.length;h++)t[h][0]<l&&h!==o&&(l=t[h][0],f=h);return t[f][1]<t[o][1]?(e=t[f],s=t[o],o!==(f+1)%4?(r=t[(f+1)%4],n=t[(f+2)%4]):(r=t[(f+2)%4],n=t[(f+3)%4])):(s=t[f],e=t[o],f!==(o+1)%4?(r=t[(o+1)%4],n=t[(o+2)%4]):(r=t[(o+2)%4],n=t[(o+3)%4])),[e,r,n,s]}function distance2Points(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function crossVect(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function dotVect(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function computeWidthAndHeigth(t,e,r,n,s,a){let o=Math.max(distance2Points(t,e),distance2Points(n,r)),l=Math.max(distance2Points(t,n),distance2Points(e,r)),f=0,h=0,c=Math.ceil(s/2),u=Math.ceil(a/2),g=o/l,d=[t[0],t[1],1],p=[e[0],e[1],1],x=[n[0],n[1],1],y=[r[0],r[1],1],m=dotVect(crossVect(d,y),x)/dotVect(crossVect(p,y),x),A=dotVect(crossVect(d,y),p)/dotVect(crossVect(x,y),p),b=[m*p[0]-d[0],m*p[1]-d[1],m*p[2]-d[2]],_=[A*x[0]-d[0],A*x[1]-d[1],A*x[2]-d[2]],E=b[0],T=b[1],I=b[2],v=_[0],k=_[1],w=_[2],M=1/(I*w)*(E*v-(E*w+I*v)*c+I*w*c*c+(T*k-(T*w+I*k)*u+I*w*u*u));M>=0?M=Math.sqrt(M):M=Math.sqrt(-M);let D=new Matrix$2([[M,0,c],[0,M,u],[0,0,1]]),R=D.transpose(),F=inverse(R),P=inverse(D),H=Matrix$2.rowVector(b),Z=Matrix$2.rowVector(_),X=Math.sqrt(dotVect(H.mmul(F).mmul(P).to1DArray(),b)/dotVect(Z.mmul(F).mmul(P).to1DArray(),_));return X===0||g===0?(f=Math.ceil(o),h=Math.ceil(l)):X<g?(f=Math.ceil(o),h=Math.ceil(f/X)):(h=Math.ceil(l),f=Math.ceil(X*h)),[f,h]}function projectionPoint(t,e,r,n,s,a,o,l,f,h,c,u){let[g,d]=[(r*t+n*e+s)/(f*t+h*e+1),(a*t+o*e+l)/(f*t+h*e+1)];return c.getValueXY(Math.floor(g),Math.floor(d),u)}function warpingFourPoints(t,e={}){let{calculateRatio:r=!0}=e;if(t.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${t.length} elements`);let[n,s,a,o]=t,l=[n,s,a,o],[f,h,c,u]=order4Points(l),g,d;r?[g,d]=computeWidthAndHeigth(f,h,c,u,this.width,this.height):(g=Math.ceil(Math.max(distance2Points(f,h),distance2Points(u,c))),d=Math.ceil(Math.max(distance2Points(f,u),distance2Points(h,c))));let p=Image.createFrom(this,{width:g,height:d}),[x,y]=f,[m,A]=h,[b,_]=c,[E,T]=u,[I,v]=[0,0],[k,w]=[0,g-1],[M,D]=[d-1,g-1],[R,F]=[d-1,0],P=new Matrix$2([[I,v,1,0,0,0,-I*x,-v*x],[k,w,1,0,0,0,-k*m,-w*m],[M,D,1,0,0,0,-M*b,-v*b],[R,F,1,0,0,0,-R*E,-F*E],[0,0,0,I,v,1,-I*y,-v*y],[0,0,0,k,w,1,-k*A,-w*A],[0,0,0,M,D,1,-M*_,-D*_],[0,0,0,R,F,1,-R*T,-F*T]]),H=Matrix$2.columnVector([x,m,b,E,y,A,_,T]),X=new SingularValueDecomposition(P).solve(H),[ee,G,se,ie,Y,j,L,W]=X.to1DArray(),te=new Matrix$2(d,g);for(let de=0;de<this.channels;de++){for(let le=0;le<d;le++)for(let ge=0;ge<g;ge++)te.set(le,ge,projectionPoint(le,ge,ee,G,se,ie,Y,j,L,W,this,de));p.setMatrix(te,{channel:de})}return p}function crop(t={}){let{x:e=0,y:r=0,width:n=this.width-e,height:s=this.height-r}=t;if(this.checkProcessable("max",{bitDepth:[8,16]}),e=Math.round(e),r=Math.round(r),n=Math.round(n),s=Math.round(s),e>this.width-1||r>this.height-1)throw new RangeError(`crop: origin (x:${e}, y:${r}) out of range (${this.width-1}; ${this.height-1})`);if(n<=0||s<=0)throw new RangeError(`crop: width and height (width:${n}; height:${s}) must be positive numbers`);if(e<0||r<0)throw new RangeError(`crop: x and y (x:${e}, y:${r}) must be positive numbers`);if(n>this.width-e||s>this.height-r)throw new RangeError(`crop: (x: ${e}, y:${r}, width:${n}, height:${s}) size is out of range`);let a=Image.createFrom(this,{width:n,height:s,position:[e,r]}),o=n*this.channels,l=r+s,f=0,h=e*this.channels;for(let c=r;c<l;c++){let u=c*this.width*this.channels+h,g=u+o;for(;u<g;u++)a.data[f++]=this.data[u]}return a}function cropAlpha(t={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:e=this.maxValue}=t;let r=findLeft(this,e,this.components);if(r===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let n=findTop(this,e,this.components,r),s=findBottom(this,e,this.components,r),a=findRight(this,e,this.components,r,n,s);return this.crop({x:r,y:n,width:a-r+1,height:s-n+1})}function findLeft(t,e,r){for(let n=0;n<t.width;n++)for(let s=0;s<t.height;s++)if(t.getValueXY(n,s,r)>=e)return n;return-1}function findTop(t,e,r,n){for(let s=0;s<t.height;s++)for(let a=n;a<t.width;a++)if(t.getValueXY(a,s,r)>=e)return s;return-1}function findBottom(t,e,r,n){for(let s=t.height-1;s>=0;s--)for(let a=n;a<t.width;a++)if(t.getValueXY(a,s,r)>=e)return s;return-1}function findRight(t,e,r,n,s,a){for(let o=t.width-1;o>=n;o--)for(let l=s;l<=a;l++)if(t.getValueXY(o,l,r)>=e)return o;return-1}function getFactor(t){if(typeof t=="string"){const e=t[t.length-1];t=parseFloat(t),e==="%"&&(t/=100)}return t}function getThreshold$1(t,e){if(!e)throw Error("getThreshold : the maxValue should be specified");if(typeof t=="string"){if(t[t.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(t)/100*e}else{if(typeof t=="number")return t<1?t*e:t;throw Error("getThreshold : the value is not valid")}}function factorDimensions(t,e,r){t=getFactor(t);let n=Math.round(t*e),s=Math.round(t*r);return n<=0&&(n=1),s<=0&&(s=1),{width:n,height:s}}function checkRow(t,e){if(e<0||e>=t.height)throw new RangeError(`row must be included between 0 and ${t.height-1}. Current value: ${e}`)}function checkColumn(t,e){if(e<0||e>=t.width)throw new RangeError(`column must be included between 0 and ${t.width-1}. Current value: ${e}`)}function checkChannel(t,e){if(e<0||e>=t.channels)throw new RangeError(`channel must be included between 0 and ${t.channels-1}. Current value: ${e}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(t){if(typeof t!="string")throw new TypeError("interpolation must be a string");if(t=t.toLowerCase(),!validInterpolations[t])throw new RangeError(`invalid interpolation algorithm: ${t}`);return validInterpolations[t]}function nearestNeighbor(t,e,r){const n=this.width/e,s=this.height/r;if(this.bitDepth>1)for(let a=0;a<e;a++){const o=Math.floor((a+.5)*n);for(let l=0;l<r;l++){const f=Math.floor((l+.5)*s);for(let h=0;h<this.channels;h++)t.setValueXY(a,l,h,this.getValueXY(o,f,h))}}else for(let a=0;a<e;a++){const o=Math.floor((a+.5)*n);for(let l=0;l<r;l++){const f=Math.floor((l+.5)*s);this.getBitXY(o,f)&&t.setBitXY(a,l)}}}function resize(t={}){const{factor:e=1,interpolation:r=validInterpolations.nearestneighbor,preserveAspectRatio:n=!0}=t,s=checkInterpolation(r);let a=t.width,o=t.height;if(a||(o&&n?a=Math.round(o*(this.width/this.height)):a=this.width),o||(n?o=Math.round(a*(this.height/this.width)):o=this.height),{width:a,height:o}=factorDimensions(e,a,o),a===this.width&&o===this.height){const c=this.clone();return c.position=[0,0],c}let l=Math.round((this.width-a)/2),f=Math.round((this.height-o)/2);const h=Image.createFrom(this,{width:a,height:o,position:[l,f]});switch(s){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,h,a,o);break;default:throw new Error(`unsupported resize interpolation: ${s}`)}return h}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let t=Image.createFrom(this,{colorModel:HSV}),e=0,r=this.data;for(let n=0;n<r.length;n+=this.channels){let s=r[n],a=r[n+1],o=r[n+2],l=Math.min(s,a,o),f=Math.max(s,a,o),h=f-l,c=0,u=f===0?0:h/f,g=f;if(f!==l){switch(f){case s:c=(a-o)/h+(a<o?6:0);break;case a:c=(o-s)/h+2;break;case o:c=(s-a)/h+4;break;default:throw new Error("unreachable")}c/=6}t.data[e++]=c*this.maxValue,t.data[e++]=u*this.maxValue,t.data[e++]=g,this.alpha&&(t.data[e++]=r[n+3])}return t}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let t=Image.createFrom(this,{colorModel:HSL}),e=Math.floor(this.maxValue/2),r=0,n=this.data;for(let s=0;s<n.length;s+=this.channels){let a=n[s],o=n[s+1],l=n[s+2],f=Math.max(a,o,l),h=Math.min(a,o,l),c=0,u=0,g=(f+h)/2;if(f!==h){let d=f-h;switch(u=g>e?d/(2-f-h):d/(f+h),f){case a:c=(o-l)/d+(o<l?6:0);break;case o:c=(l-a)/d+2;break;case l:c=(a-o)/d+4;break;default:throw new Error("unreachable")}c/=6}t.data[r++]=c*this.maxValue,t.data[r++]=u*this.maxValue,t.data[r++]=g,this.alpha&&(t.data[r++]=n[s+3])}return t}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let t=Image.createFrom(this,{components:4,colorModel:CMYK$1}),e=0,r=this.data;for(let n=0;n<r.length;n+=this.channels){let s=r[n],a=r[n+1],o=r[n+2],l=Math.min(this.maxValue-s,this.maxValue-a,this.maxValue-o),f=(this.maxValue-s-l)/(1-l/this.maxValue),h=(this.maxValue-a-l)/(1-l/this.maxValue),c=(this.maxValue-o-l)/(1-l/this.maxValue);t.data[e++]=Math.round(f),t.data[e++]=Math.round(h),t.data[e++]=Math.round(c),t.data[e++]=Math.round(l),this.alpha&&(t.data[e++]=r[n+3])}return t}function rgba8(){return new Image(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(t,e,r){return t*6966+e*23436+r*2366>>15},luma601(t,e,r){return t*9798+e*19235+r*3735>>15},maximum(t,e,r){return Math.max(t,e,r)},minimum(t,e,r){return Math.min(t,e,r)},average(t,e,r){return(t+e+r)/3>>0},minmax(t,e,r){return(Math.max(t,e,r)+Math.min(t,e,r))/2},red(t){return t},green(t,e){return e},blue(t,e,r){return r},cyan(t,e,r,n){let s=methods$1.black(t,e,r,n);return(n.maxValue-t-s)/(1-s/n.maxValue)>>0},magenta(t,e,r,n){let s=methods$1.black(t,e,r,n);return(n.maxValue-e-s)/(1-s/n.maxValue)>>0},yellow(t,e,r,n){let s=methods$1.black(t,e,r,n);return(n.maxValue-r-s)/(1-s/n.maxValue)>>0},black(t,e,r,n){return Math.min(n.maxValue-t,n.maxValue-e,n.maxValue-r)},hue(t,e,r,n){let s=methods$1.min(t,e,r),a=methods$1.max(t,e,r);if(a===s)return 0;let o=0,l=a-s;switch(a){case t:o=(e-r)/l+(e<r?6:0);break;case e:o=(r-t)/l+2;break;case r:o=(t-e)/l+4;break;default:throw new Error("unreachable")}return o/6*n.maxValue>>0},saturation(t,e,r,n){let s=methods$1.min(t,e,r),a=methods$1.max(t,e,r),o=a-s;return a===0?0:o/a*n.maxValue},lightness(t,e,r){let n=methods$1.min(t,e,r);return(methods$1.max(t,e,r)+n)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});const names$1={};Object.keys(methods$1).forEach(t=>{names$1[t]=t});function grey(t={}){let{algorithm:e="luma709",keepAlpha:r=!1,mergeAlpha:n=!0}=t;if(typeof e!="string"&&typeof e!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(e="red"),r&=this.alpha,n&=this.alpha,r&&(n=!1);let s=getOutputImage(this,t,{components:1,alpha:r,colorModel:GREY$1}),a;if(typeof e=="function")a=e;else if(a=methods$1[e.toLowerCase()],!a)throw new Error(`unsupported grey algorithm: ${e}`);let o=0;for(let l=0;l<this.data.length;l+=this.channels)n?s.data[o++]=clamp(a(this.data[l],this.data[l+1],this.data[l+2],this)*this.data[l+this.components]/this.maxValue,this):(s.data[o++]=clamp(a(this.data[l],this.data[l+1],this.data[l+2],this),this),s.alpha&&(s.data[o++]=this.data[l+this.components]));return s}function huang(t){let e=0;for(let c=0;c<t.length;c++)if(t[c]!==0){e=c;break}let r=t.length-1;for(let c=t.length-1;c>=e;c--)if(t[c]!==0){r=c;break}let n=1/(r-e),s=new Array(t.length),a=0,o=0;for(let c=e;c<t.length;c++)a+=c*t[c],o+=t[c],s[c]=a/o;let l=new Array(t.length);a=o=0;for(let c=r;c>0;c--)a+=c*t[c],o+=t[c],l[c-1]=a/o;let f=-1,h=Number.MAX_VALUE;for(let c=0;c<t.length;c++){let u=0,g;for(let d=0;d<=c;d++)g=1/(1+n*Math.abs(d-s[c])),g<1e-6||g>.999999||(u+=t[d]*(-g*Math.log(g)-(1-g)*Math.log(1-g)));for(let d=c+1;d<t.length;d++)g=1/(1+n*Math.abs(d-l[c])),g<1e-6||g>.999999||(u+=t[d]*(-g*Math.log(g)-(1-g)*Math.log(1-g)));u<h&&(h=u,f=c)}return f}function intermodes(t){let e=t.slice(),r=0;for(;!bimodalTest$1(e);){let s=0,a=0,o=e[0];for(let l=0;l<t.length-1;l++)s=a,a=o,o=e[l+1],e[l]=(s+a+o)/3;if(e[t.length-1]=(a+o)/3,r++,r>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let n=0;for(let s=1;s<t.length-1;s++)e[s-1]<e[s]&&e[s+1]<e[s]&&(n+=s);return Math.floor(n/2)}function bimodalTest$1(t){let e=!1,r=0;for(let n=1;n<t.length-1;n++)if(t[n-1]<t[n]&&t[n+1]<t[n]&&(r++,r>2))return!1;return r===2&&(e=!0),e}function isodata(t){let e,r,n,s,a=0;for(let o=1;o<t.length;o++)if(t[o]>0){a=o+1;break}for(;;){e=0,n=0;for(let o=0;o<a;o++)n=n+t[o],e=e+t[o]*o;s=0,r=0;for(let o=a+1;o<t.length;o++)r+=t[o],s+=t[o]*o;if(n>0&&r>0&&(e/=n,s/=r,a===Math.round((e+s)/2)))break;if(a++,a>t.length-2)throw new Error("Threshold not found")}return a}function li(t,e){let r,n,s,a,o,l,f,h,c,u,g,d;g=.5,u=0;for(let p=0;p<t.length;p++)u+=p*t[p];u/=e,f=u;do{l=f,r=l+.5|0,n=0,a=0;for(let p=0;p<=r;p++)n+=p*t[p],a+=t[p];h=a===0?0:n/a,s=0,o=0;for(let p=r+1;p<t.length;p++)s+=p*t[p],o+=t[p];c=o===0?0:s/o,d=(h-c)/(Math.log(h)-Math.log(c)),d<-Number.EPSILON?f=d-.5|0:f=d+.5|0}while(Math.abs(f-l)>g);return r}function maxEntropy(t,e){let r=new Array(t.length);for(let g=0;g<t.length;g++)r[g]=t[g]/e;let n=new Array(t.length),s=new Array(t.length);n[0]=r[0],s[0]=1-n[0];for(let g=1;g<t.length;g++)n[g]=n[g-1]+r[g],s[g]=1-n[g];let a=0;for(let g=0;g<t.length;g++)if(Math.abs(n[g])>=Number.EPSILON){a=g;break}let o=t.length-1;for(let g=t.length-1;g>=a;g--)if(Math.abs(s[g])>=Number.EPSILON){o=g;break}let l=-1,f,h=Number.MIN_VALUE,c,u;for(let g=a;g<=o;g++){c=0;for(let d=0;d<=g;d++)t[d]!==0&&(c-=r[d]/n[g]*Math.log(r[d]/n[g]));u=0;for(let d=g+1;d<t.length;d++)t[d]!==0&&(u-=r[d]/s[g]*Math.log(r[d]/s[g]));f=c+u,h<f&&(h=f,l=g)}return l}function mean$1(t,e){let r=0;for(let n=0;n<t.length;n++)r+=n*t[n];return Math.floor(r/e)}function minError(t,e){let r,n=-2,s,a,o,l,f,h,c,u,g,d,p,x=0;for(let y=0;y<t.length;y++)x+=y*t[y];for(x/=e,r=x;r!==n;){let y=sumA(t,r),m=sumA(t,t.length-1),A=sumB(t,r),b=sumB(t,t.length-1),_=sumC(t,r),E=sumC(t,t.length-1);if(s=A/y,a=(b-A)/(m-y),o=y/m,l=(m-y)/m,f=_/y-s*s,h=(E-_)/(m-y)-a*a,c=1/f-1/h,u=s/f-a/h,g=s*s/f-a*a/h+Math.log10(f*(l*l)/(h*(o*o))),d=u*u-c*g,d<0)return r;n=r,p=(u+Math.sqrt(d))/c,isNaN(p)?r=n:r=Math.floor(p)}return r}function sumA(t,e){let r=0;for(let n=0;n<=e;n++)r+=t[n];return r}function sumB(t,e){let r=0;for(let n=0;n<=e;n++)r+=n*t[n];return r}function sumC(t,e){let r=0;for(let n=0;n<=e;n++)r+=n*n*t[n];return r}function minimum(t){if(t.length<2)return 0;let e=0,r=-1,n=-1,s=new Array(t.length);for(let a=0;a<t.length;a++)s[a]=t[a],t[a]>0&&(n=a);for(;!bimodalTest(s);)if(s=smoothed(s),e++,e>1e4)return r;return r=minimumBetweenPeeks(s,n),r}function smoothed(t){let e=new Array(t.length);for(let r=1;r<t.length-1;r++)e[r]=(t[r-1]+t[r]+t[r+1])/3;return e[0]=(t[0]+t[1])/3,e[t.length-1]=(t[t.length-2]+t[t.length-1])/3,e}function minimumBetweenPeeks(t,e){let r;for(let n=1;n<e;n++)if(t[n-1]>t[n]&&t[n+1]>=t[n]){r=n;break}return r}function bimodalTest(t){let e=t.length,r=!1,n=0;for(let s=1;s<e-1;s++)if(t[s-1]<t[s]&&t[s+1]<t[s]&&(n++,n>2))return!1;return n===2&&(r=!0),r}function moments(t,e){let r=1,n=0,s=0,a=0,o=0,l,f,h,c,u,g,d=-1,p=t.length,x=new Array(p);for(let y=0;y<p;y++)x[y]=t[y]/e;for(let y=0;y<p;y++)n+=y*x[y],s+=y*y*x[y],a+=y*y*y*x[y];f=r*s-n*n,h=(-s*s+n*a)/f,c=(r*-a+s*n)/f,u=.5*(-c-Math.sqrt(c*c-4*h)),g=.5*(-c+Math.sqrt(c*c-4*h)),l=(g-n)/(g-u);for(let y=0;y<p;y++)if(o+=x[y],o>l){d=y;break}return d}function otsu(t,e){let r=0,n=0,s=0,a=0,o=0;for(let l=0;l<t.length;l++)o+=l*t[l];for(let l=0;l<t.length;l++){n=n+t[l];const f=e-n;if(n===0||f===0)continue;r=r+l*t[l];const h=(o-r)/f,c=n*f*(r/n-h)*(r/n-h);c>=s&&(a=l,s=c)}return a}function percentile(t){let e=-1,r=.5,n=new Array(t.length),s=partialSum(t,t.length-1),a=1;for(let o=0;o<t.length;o++)n[o]=Math.abs(partialSum(t,o)/s-r),n[o]<a&&(a=n[o],e=o);return e}function partialSum(t,e){let r=0;for(let n=0;n<=e;n++)r+=t[n];return r}function renyiEntropy(t,e){let r,n,s,a=new Array(t.length),o=new Array(t.length),l=new Array(t.length),f=0,h=0,c=0,u=0,g=0,d=0,x=1/(1-.5),m=1/(1-2);for(let E=0;E<t.length;E++)a[E]=t[E]/e;o[0]=a[0],l[0]=1-o[0];for(let E=1;E<t.length;E++)o[E]=o[E-1]+a[E],l[E]=1-o[E];n=0;for(let E=0;E<t.length;E++)if(Math.abs(o[E])>=Number.EPSILON){n=E;break}s=t.length-1;for(let E=t.length-1;E>=n;E--)if(Math.abs(l[E])>=Number.EPSILON){s=E;break}for(let E=n;E<=s;E++){let T=0,I=0,v=0;for(let P=0;P<=E;P++)t[P]!==0&&(T-=a[P]/o[E]*Math.log(a[P]/o[E])),I+=Math.sqrt(a[P]/o[E]),v+=a[P]*a[P]/(o[E]*o[E]);let k=0,w=0,M=0;for(let P=E+1;P<t.length;P++)t[P]!==0&&(k-=a[P]/l[E]*Math.log(a[P]/l[E])),w+=Math.sqrt(a[P]/l[E]),M+=a[P]*a[P]/(l[E]*l[E]);let D=T+k,R=x*(I*w>0?Math.log(I*w):0),F=m*(v*M>0?Math.log(v*M):0);D>u&&(u=D,f=E),R>g&&(g=R,h=E),F>d&&(d=F,c=E)}let A=[f,h,c];A.sort((E,T)=>E-T);let b;Math.abs(A[0]-A[1])<=5?Math.abs(A[1]-A[2])<=5?b=[1,2,1]:b=[0,1,3]:Math.abs(A[1]-A[2])<=5?b=[3,1,0]:b=[1,2,1];let _=o[A[2]]-o[A[0]];return r=Math.round(A[0]*(o[A[0]]+.25*_*b[0])+.25*A[1]*_*b[1]+A[2]*(l[A[2]]+.25*_*b[2])),r}function shanbhag(t,e){let r=new Array(t.length);for(let d=0;d<t.length;d++)r[d]=t[d]/e;let n=new Array(t.length),s=new Array(t.length);n[0]=r[0],s[0]=1-n[0];for(let d=1;d<t.length;d++)n[d]=n[d-1]+r[d],s[d]=1-n[d];let a=0;for(let d=0;d<t.length;d++)if(Math.abs(n[d])>=Number.EPSILON){a=d;break}let o=t.length-1;for(let d=t.length-1;d>=a;d--)if(Math.abs(s[d])>=Number.EPSILON){o=d;break}let l=-1,f=Number.MAX_VALUE,h,c,u,g;for(let d=a;d<=o;d++){u=0,h=.5/n[d];for(let p=1;p<=d;p++)u-=r[p]*Math.log(1-h*n[p-1]);u*=h,g=0,h=.5/s[d];for(let p=d+1;p<t.length;p++)g-=r[p]*Math.log(1-h*s[p]);g*=h,c=Math.abs(u-g),c<f&&(f=c,l=d)}return l}function triangle$1(t){let e=0,r=0,n=0,s=0;for(let u=0;u<t.length;u++)if(t[u]>0){e=u;break}e>0&&e--;for(let u=t.length-1;u>0;u--)if(t[u]>0){s=u;break}s<t.length-1&&s++;for(let u=0;u<t.length;u++)t[u]>r&&(n=u,r=t[u]);let a=!1;if(n-e<s-n){a=!0;let u=0,g=t.length-1;for(;u<g;){let d=t[u];t[u]=t[g],t[g]=d,u++,g--}e=t.length-1-s,n=t.length-1-n}if(e===n)return e;let o,l,f;o=t[n],l=e-n,f=Math.sqrt(o*o+l*l),o/=f,l/=f,f=o*e+l*t[e];let h=e,c=0;for(let u=e+1;u<=n;u++){let g=o*u+l*t[u]-f;g>c&&(h=u,c=g)}if(h--,a){let u=0,g=t.length-1;for(;u<g;){let d=t[u];t[u]=t[g],t[g]=d,u++,g--}return t.length-1-h}else return h}function yen(t,e){let r=new Array(t.length);for(let h=0;h<t.length;h++)r[h]=t[h]/e;let n=new Array(t.length);n[0]=r[0];for(let h=1;h<t.length;h++)n[h]=n[h-1]+r[h];let s=new Array(t.length);s[0]=r[0]*r[0];for(let h=1;h<t.length;h++)s[h]=s[h-1]+r[h]*r[h];let a=new Array(t.length);a[t.length-1]=0;for(let h=t.length-2;h>=0;h--)a[h]=a[h+1]+r[h+1]*r[h+1];let o=-1,l=Number.MIN_VALUE,f;for(let h=0;h<t.length;h++)f=-1*(s[h]*a[h]>0?Math.log(s[h]*a[h]):0)+2*(n[h]*(1-n[h])>0?Math.log(n[h]*(1-n[h])):0),f>l&&(l=f,o=h);return o}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(t=>{names[t]=t});function getThreshold(t={}){let{algorithm:e=names.otsu}=t;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let r=methods[e.toLowerCase()];if(r){let n=this.getHistogram();return r(n,this.size)}else throw new Error(`unknown thresholding algorithm: ${e}`)}const THRESHOLD="threshold";function mask(t={}){let{algorithm:e=THRESHOLD,threshold:r=.5,useAlpha:n=!0,invert:s=!1}=t;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),e===THRESHOLD?r=getThreshold$1(r,this.maxValue):r=getThreshold.call(this,t);let a=new Image(this.width,this.height,{kind:"BINARY",parent:this}),o=0;if(this.alpha&&n)for(let l=0;l<this.data.length;l+=this.channels){let f=this.data[l]+(this.maxValue-this.data[l])*(this.maxValue-this.data[l+1])/this.maxValue;(s&&f<=r||!s&&f>=r)&&a.setBit(o),o++}else for(let l=0;l<this.data.length;l+=this.channels)(s&&this.data[l]<=r||!s&&this.data[l]>=r)&&a.setBit(o),o++;return a}function copyImage(t,e,r,n){let s=t.width,a=t.height,o=e.width,l=t.channels;for(let f=0;f<s;f++)for(let h=0;h<a;h++)for(let c=0;c<l;c++){let u=(h*s+f)*l+c,g=((n+h)*o+r+f)*l+c;e.data[g]=t.data[u]}}function pad(t={}){let{size:e=0,algorithm:r="copy",color:n}=t;if(this.checkProcessable("pad",{bitDepth:[8,16]}),r==="set"){if(n.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let f=0;f<n.length;f++)n[f]===0&&(n[f]=.001)}else n=newArray_1(this.channels,null);Array.isArray(e)||(e=[e,e]);let s=this.width+e[0]*2,a=this.height+e[1]*2,o=this.channels,l=Image.createFrom(this,{width:s,height:a});copyImage(this,l,e[0],e[1]);for(let f=e[0];f<s-e[0];f++)for(let h=0;h<o;h++){let c=n[h]||l.data[(e[1]*s+f)*o+h];for(let u=0;u<e[1];u++)l.data[(u*s+f)*o+h]=c;c=n[h]||l.data[((a-e[1]-1)*s+f)*o+h];for(let u=a-e[1];u<a;u++)l.data[(u*s+f)*o+h]=c}for(let f=0;f<a;f++)for(let h=0;h<o;h++){let c=n[h]||l.data[(f*s+e[0])*o+h];for(let u=0;u<e[0];u++)l.data[(f*s+u)*o+h]=c;c=n[h]||l.data[(f*s+s-e[0]-1)*o+h];for(let u=s-e[0];u<s;u++)l.data[(f*s+u)*o+h]=c}return l}function colorDepth(t=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(t))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===t)return this.clone();let e=Image.createFrom(this,{bitDepth:t});switch(t){case 8:if(this.bitDepth===1)for(let r=0;r<this.size;r++)this.getBit(r)&&(e.data[r]=255);else for(let r=0;r<this.data.length;r++)e.data[r]=this.data[r]>>8;break;case 16:if(this.bitDepth===1)for(let r=0;r<this.size;r++)this.getBit(r)&&(e.data[r]=65535);else for(let r=0;r<this.data.length;r++)e.data[r]=this.data[r]<<8|this.data[r];break;default:throw new Error("colorDepth conversion unexpected case")}return e}function rotateFree(t,e={}){const{interpolation:r=validInterpolations.nearestneighbor,width:n=this.width,height:s=this.height}=e;if(typeof t!="number")throw new TypeError("degrees must be a number");const a=checkInterpolation(r),o=t*Math.PI/180,l=Math.floor(Math.abs(n*Math.cos(o))+Math.abs(s*Math.sin(o))),f=Math.floor(Math.abs(s*Math.cos(o))+Math.abs(n*Math.sin(o))),h=Image.createFrom(this,{width:l,height:f}),c=Math.cos(-o),u=Math.sin(-o);let g=l/2,d=f/2;l%2===0?(g=g-.5,f%2===0?d=d-.5:d=Math.floor(d)):(g=Math.floor(g),f%2===0?d=d-.5:d=Math.floor(d));const p=Math.floor(n/2-g),x=Math.floor(s/2-d);switch(a){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,h,p,x,g,d,c,u);case validInterpolations.bilinear:return rotateBilinear(this,h,p,x,g,d,c,u);default:throw new Error(`unsupported rotate interpolation: ${a}`)}}function rotateNearestNeighbor(t,e,r,n,s,a,o,l){for(let f=0;f<e.width;f+=1)for(let h=0;h<e.height;h+=1)for(let c=0;c<t.channels;c++){let u=Math.round((f-s)*o-(h-a)*l+s)+r,g=Math.round((h-a)*o+(f-s)*l+a)+n;u<0||u>=t.width||g<0||g>=t.height?t.alpha===1&&c===t.channels-1?e.setValueXY(f,h,c,0):e.setValueXY(f,h,c,t.maxValue):e.setValueXY(f,h,c,t.getValueXY(u,g,c))}return e}function rotateBilinear(t,e,r,n,s,a,o,l){let f=t.width*t.channels;for(let h=0;h<e.height;h++)for(let c=0;c<e.width;c++){let u=(c-s)*o-(h-a)*l+s+r,g=(h-a)*o+(c-s)*l+a+n,d=u|0,p=g|0,x=u-d,y=g-p;for(let m=0;m<t.channels;m++)if(u<0||u>=t.width||g<0||g>=t.height)t.alpha===1&&m===t.channels-1?e.setValueXY(c,h,m,0):e.setValueXY(c,h,m,t.maxValue);else{let A=(p*t.width+d)*t.channels+m,b=t.data[A],_=t.data[A+t.channels],E=t.data[A+f],T=t.data[A+f+t.channels],I=b+x*(_-b)+y*(E-b)+x*y*(b-_-E+T)|0;e.setValueXY(c,h,m,I)}}return e}function rotate$1(t,e){if(typeof t!="number")throw new TypeError("angle must be a number");switch(t<0&&(t=Math.ceil(-t/360)*360+t),t%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,t,e)}}function rotateLeft(){const t=Image.createFrom(this,{width:this.height,height:this.width}),e=t.height-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)for(let s=0;s<this.channels;s++)t.setValueXY(r,e-n,s,this.getValueXY(n,r,s));return t}function rotateRight(){const t=Image.createFrom(this,{width:this.height,height:this.width}),e=t.width-1;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++)for(let s=0;s<this.channels;s++)t.setValueXY(e-r,n,s,this.getValueXY(n,r,s));return t}function rotate180(){const t=Image.createFrom(this),e=t.width-1,r=t.height-1;for(let n=0;n<this.height;n++)for(let s=0;s<this.width;s++)for(let a=0;a<this.channels;a++)t.setValueXY(e-s,r-n,a,this.getValueXY(s,n,a));return t}function insert(t,e={}){const r=getImageParameters(t);this.checkProcessable("insert",r);let{x:n=0,y:s=0}=e;const a=getOutputImageOrInPlace(this,e,{copy:!0}),o=Math.min(a.height,s+t.height),l=Math.min(a.width,n+t.width);if(a.bitDepth===1)for(let f=s;f<o;f++)for(let h=n;h<l;h++)t.getBitXY(h-n,f-s)?a.setBitXY(h,f):a.clearBitXY(h,f);else for(let f=s;f<o;f++)for(let h=n;h<l;h++)a.setPixelXY(h,f,t.getPixelXY(h-n,f-s));return a}function setBorder(t={}){let{size:e=0,algorithm:r="copy",color:n}=t;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),r==="set"){if(n.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let l=0;l<n.length;l++)n[l]===0&&(n[l]=.001)}else n=newArray_1(this.channels,null);Array.isArray(e)||(e=[e,e]);let s=e[0],a=e[1],o=this.channels;for(let l=s;l<this.width-s;l++)for(let f=0;f<o;f++){let h=n[f]||this.data[(l+this.width*a)*o+f];for(let c=0;c<a;c++)this.data[(c*this.width+l)*o+f]=h;h=n[f]||this.data[(l+this.width*(this.height-a-1))*o+f];for(let c=this.height-a;c<this.height;c++)this.data[(c*this.width+l)*o+f]=h}for(let l=0;l<this.height;l++)for(let f=0;f<o;f++){let h=n[f]||this.data[(l*this.width+s)*o+f];for(let c=0;c<s;c++)this.data[(l*this.width+c)*o+f]=h;h=n[f]||this.data[(l*this.width+this.width-s-1)*o+f];for(let c=this.width-s;c<this.width;c++)this.data[(l*this.width+c)*o+f]=h}return this}function split(t={}){let{preserveAlpha:e=!0}=t;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let r=new Stack,n=this.data;if(this.alpha&&e)for(let s=0;s<this.components;s++){let a=Image.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),o=0;for(let l=0;l<n.length;l+=this.channels)a.data[o++]=n[l+s],a.data[o++]=n[l+this.components];r.push(a)}else for(let s=0;s<this.channels;s++){let a=Image.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),o=0;for(let l=0;l<n.length;l+=this.channels)a.data[o++]=n[l+s];r.push(a)}return r}function getChannel(t,e={}){let{keepAlpha:r=!1,mergeAlpha:n=!1}=e;r&=this.alpha,n&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),t=validateChannel(this,t);let s=Image.createFrom(this,{components:1,alpha:r,colorModel:GREY$1}),a=0;for(let o=0;o<this.data.length;o+=this.channels)n?s.data[a++]=this.data[o+t]*this.data[o+this.components]/this.maxValue:(s.data[a++]=this.data[o+t],r&&(s.data[a++]=this.data[o+this.components]));return s}function combineChannels(t=defaultCombineMethod,e={}){let{mergeAlpha:r=!1,keepAlpha:n=!1}=e;r&=this.alpha,n&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let s=Image.createFrom(this,{components:1,alpha:n,colorModel:GREY$1}),a=0;for(let o=0;o<this.size;o++){let l=t(this.getPixel(o));r?s.data[a++]=l*this.data[o*this.channels+this.components]/this.maxValue:(s.data[a++]=l,n&&(s.data[a++]=this.data[o*this.channels+this.components]))}return s}function defaultCombineMethod(t){return(t[0]+t[1]+t[2])/3}function setChannel(t,e){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),e.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),e.width!==this.width||e.height!==this.height)throw new Error("Images must have exactly the same width and height");t=validateChannel(this,t);let r=t;for(let n=0;n<e.data.length;n++)this.data[r]=e.data[n],r+=this.channels;return this}function getSimilarity(t,e={}){let{shift:r=[0,0],average:n,channels:s,defaultAlpha:a,normalize:o,border:l=[0,0]}=e;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(l)||(l=[l,l]),s=validateArrayOfChannels(this,{channels:s,defaultAlpha:a}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");typeof n=="undefined"&&(n=!0);let f=Math.max(l[0],-r[0]),h=Math.min(this.width-l[0],this.width-r[0]),c=Math.max(l[1],-r[1]),u=Math.min(this.height-l[1],this.height-r[1]),g=newArray_1(s.length,0);for(let d=0;d<s.length;d++){let p=s[d],x=o?this.sum[p]:Math.max(this.sum[p],t.sum[p]),y=o?t.sum[p]:Math.max(this.sum[p],t.sum[p]);if(x!==0&&y!==0)for(let m=f;m<h;m++)for(let A=c;A<u;A++){let b=m*this.multiplierX+A*this.multiplierY+p,_=b+r[0]*this.multiplierX+r[1]*this.multiplierY;g[d]+=Math.min(this.data[b]/x,t.data[_]/y)}}return n?g.reduce((d,p)=>d+p)/g.length:g}function getPixelsGrid(t={}){let{sampling:e=[10,10],painted:r=!1,mask:n}=t;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(e)||(e=[e,e]);const s=e[0],a=e[1],o=[],l=[],f=this.width/s,h=this.height/a;let c=Math.floor(f/2);for(let g=0;g<s;g++){let d=Math.floor(h/2);for(let p=0;p<a;p++){let x=Math.round(c),y=Math.round(d);(!n||n.getBitXY(x,y))&&(o.push([x,y]),l.push(this.getPixelXY(x,y))),d+=h}c+=f}const u={xyS:o,zS:l};return r&&(u.painted=this.rgba8().paintPoints(o)),u}function Matrix(t,e,r){const n=new Array(t);for(let s=0;s<t;s++)n[s]=new Array(e);if(r)for(let s=0;s<t;s++)for(let a=0;a<e;a++)n[s][a]=r;return n.width=t,n.height=e,Object.setPrototypeOf(n,Matrix.prototype),n}Matrix.prototype.localMin=function(t,e){let r=this[t][e],n=[t,e];for(let s=Math.max(0,t-1);s<Math.min(this.length,t+2);s++)for(let a=Math.max(0,e-1);a<Math.min(this[0].length,e+2);a++)this[s][a]<r&&(r=this[s][a],n=[s,a]);return{position:n,value:r}};Matrix.prototype.localMax=function(t,e){let r=this[t][e],n=[t,e];for(let s=Math.max(0,t-1);s<Math.min(this.length,t+2);s++)for(let a=Math.max(0,e-1);a<Math.min(this[0].length,e+2);a++)this[s][a]>r&&(r=this[s][a],n=[s,a]);return{position:n,value:r}};Matrix.prototype.localSearch=function(t,e,r){let n=[];for(let s=Math.max(0,t-1);s<Math.min(this.length,t+2);s++)for(let a=Math.max(0,e-1);a<Math.min(this[0].length,e+2);a++)this[s][a]===r&&n.push([s,a]);return n};function getBestMatch(t,e={}){let{border:r}=e;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");let n=new Matrix(t.width,t.height,-1/0),s=Math.floor(t.width/2),a=Math.floor(t.height/2),o=s,l=a,f=!1;for(;!f;){let h=n.localSearch(s,a,-1/0);for(let u=0;u<h.length;u++){let g=h[u],d=this.getSimilarity(t,{border:r,shift:[o-g[0],l-g[1]]});n[g[0]][g[1]]=d}let c=n.localMax(s,a);c.position[0]!==s||c.position[1]!==a?(s=c.position[0],a=c.position[1]):f=!0}return[s-o,a-l]}function getRow(t,e=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,t),checkChannel(this,e);let r=new Array(this.width),n=0,s=t*this.width*this.channels+e,a=s+this.width*this.channels;for(let o=s;o<a;o+=this.channels)r[n++]=this.data[o];return r}function getColumn(t,e=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,t),checkChannel(this,e);let r=new Array(this.height),n=0,s=this.width*this.channels;for(let a=e+t*this.channels;a<this.data.length;a+=s)r[n++]=this.data[a];return r}function getMatrix(t={}){let{channel:e}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),e===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}let r=new Matrix$2(this.height,this.width);for(let n=0;n<this.height;n++)for(let s=0;s<this.width;s++)r.set(n,s,this.getValueXY(s,n,e));return r}function setMatrix(t,e={}){t=new Matrix$2(t);let{channel:r}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}if(this.width!==t.columns||this.height!==t.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let n=0;n<this.height;n++)for(let s=0;s<this.width;s++)this.setValueXY(s,n,r,t.get(n,s))}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let t=new Array(this.size),e=0;for(let r=0;r<this.data.length;r+=this.channels){let n=new Array(this.components);for(let s=0;s<this.components;s++)n[s]=this.data[r+s];t[e++]=n}return t}function getIntersection(t){let e=this,r=e.getClosestCommonParent(t),n=e.getRelativePosition(r,{defaultFurther:!0}),s=getRelativePositionForAllPixels(e,n),a=t.getRelativePosition(r,{defaultFurther:!0}),o=getRelativePositionForAllPixels(t,a),l=getCommonSurface(s,o),f={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let h=0;h<l.length;h++){let c=l[h],u=[c[0]-n[0],c[1]-n[1]],g=[c[0]-a[0],c[1]-a[1]],d=e.getBitXY(u[0],u[1]),p=t.getBitXY(g[0],g[1]);d===1&&p===1&&f.commonWhitePixels.push(c)}for(let h=0;h<s.length;h++){let c,u;h!==0&&(c=Math.floor(h/e.width),u=h%e.width),e.getBitXY(c,u)===1&&f.whitePixelsMask1.push(s[h])}for(let h=0;h<o.length;h++){let c=0,u=0;h!==0&&(c=Math.floor(h/t.width),u=h%t.width),t.getBitXY(c,u)===1&&f.whitePixelsMask2.push(o[h])}return f}function getRelativePositionForAllPixels(t,e){let r=[];for(let n=0;n<t.height;n++)for(let s=0;s<t.width;s++){let a=[n,s];r.push([a[0]+e[0],a[1]+e[1]])}return r}function getCommonSurface(t,e){let r=0,n=0,s=[];for(;r<t.length&&n<e.length;)t[r][0]===e[n][0]&&t[r][1]===e[n][1]?(s.push(t[r]),r++,n++):t[r][0]<e[n][0]||t[r][0]===e[n][0]&&t[r][1]<e[n][1]?r++:n++;return s}function getClosestCommonParent(t){let e=getDepth(this),r=getDepth(t),n;if(e>=r?n=getFurthestParent(this,e):n=getFurthestParent(t,r),e===0||r===0)return n;let s=this,a=t;for(;e!==r;)if(e>r){if(s=s.parent,s===null)return n;e=e-1}else{if(a=a.parent,a===null)return n;r=r-1}for(;s!==a&&s!==null&&a!==null;)if(s=s.parent,a=a.parent,s===null||a===null)return n;return s!==a?n:s}function getDepth(t){let e=0,r=t;for(;r.parent!=null;)r=r.parent,e++;return e}function getFurthestParent(t,e){let r=t;for(;e>0;)r=r.parent,e=e-1;return r}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(t,e){t.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),e=Object.assign({},defaultOptions$1,e);const r=t.width,n=t.height,s=t.maxValue,a={sigma:e.gaussianBlur,radius:3},o=t.gaussianFilter(a),l=o.convolution(Gy,convOptions),f=o.convolution(Gx,convOptions),h=f.hypotenuse(l),c=t.constructor,u=new c(r,n,{kind:"GREY",bitDepth:32}),g=new c(r,n,{kind:"GREY",bitDepth:32}),d=new c(r,n,{kind:"GREY"});for(var p=1;p<r-1;p++)for(var x=1;x<n-1;x++){var y=(Math.round(Math.atan2(f.getValueXY(p,x,0),l.getValueXY(p,x,0))*(5/Math.PI))+5)%5;y===0&&(h.getValueXY(p,x,0)<=h.getValueXY(p,x-1,0)||h.getValueXY(p,x,0)<=h.getValueXY(p,x+1,0))||y===1&&(h.getValueXY(p,x,0)<=h.getValueXY(p-1,x+1,0)||h.getValueXY(p,x,0)<=h.getValueXY(p+1,x-1,0))||y===2&&(h.getValueXY(p,x,0)<=h.getValueXY(p-1,x,0)||h.getValueXY(p,x,0)<=h.getValueXY(p+1,x,0))||y===3&&(h.getValueXY(p,x,0)<=h.getValueXY(p-1,x-1,0)||h.getValueXY(p,x,0)<=h.getValueXY(p+1,x+1,0))||u.setValueXY(p,x,0,h.getValueXY(p,x,0))}for(p=0;p<r*n;++p){var m=u.data[p],A=0;m>e.highThreshold&&(A++,d.data[p]=s),m>e.lowThreshold&&A++,g.data[p]=A}var b=[];for(p=1;p<r-1;++p)for(x=1;x<n-1;++x){if(g.getValueXY(p,x,0)!==1)continue;e:for(var _=p-1;_<p+2;++_)for(var E=x-1;E<x+2;++E)if(g.getValueXY(_,E,0)===2){b.push([p,x]),d.setValueXY(p,x,0,s);break e}}for(;b.length>0;){var T=[];for(p=0;p<b.length;++p)for(x=-1;x<2;++x)for(_=-1;_<2;++_)if(!(x===0&&_===0)){var I=b[p][0]+x,v=b[p][1]+_;g.getValueXY(I,v,0)===1&&d.getValueXY(I,v,0)===0&&(T.push([I,v]),d.setValueXY(I,v,0,s))}b=T}return d}function cannyEdge(t){return cannyEdgeDetector(this,t)}function extract(t,e={}){let{position:r}=e;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!r&&(r=t.getRelativePosition(this),!r))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let n=Image.createFrom(this,{width:t.width,height:t.height,alpha:1,position:r,parent:this});for(let s=0;s<t.width;s++)for(let a=0;a<t.height;a++){for(let o=0;o<this.channels;o++){let l=this.getValueXY(s+r[0],a+r[1],o);n.setValueXY(s,a,o,l)}t.getBitXY(s,a)||n.setValueXY(s,a,this.components,0)}return n}else{let n=Image.createFrom(this,{width:t.width,height:t.height,position:r,parent:this});for(let s=0;s<t.height;s++)for(let a=0;a<t.width;a++)t.getBitXY(a,s)&&this.getBitXY(a+r[0],s+r[1])&&n.setBitXY(a,s);return n}}var fastList={exports:{}};(function(t,e){(function(){function r(s,a,o){this.next=o,o&&(o.prev=this),this.prev=a,a&&(a.next=this),this.data=s}function n(){if(!(this instanceof n))return new n;this._head=null,this._tail=null,this.length=0}n.prototype={push:function(s){this._tail=new r(s,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var s=this._tail;return this._tail=s.prev,s.prev&&(s.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),s.data}},unshift:function(s){this._head=new r(s,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var s=this._head;return this._head=s.next,s.next&&(s.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),s.data}},item:function(s){s<0&&(s=this.length+s);for(var a=this._head;s-- >0&&a;)a=a.next;return a?a.data:void 0},slice:function(s,a){if(s||(s=0),a||(a=this.length),a<0&&(a=this.length+a),s<0&&(s=this.length+s),a===s)return[];if(a<s)throw new Error("invalid offset: "+s+","+a+" (length="+this.length+")");for(var o=a-s,l=new Array(o),f=0,h=this._head;s-- >0&&h;)h=h.next;for(;f<o&&h;)l[f++]=h.data,h=h.next;return l},drop:function(){n.call(this)},forEach:function(s,a){for(var o=this._head,l=0,f=this.length;l<f&&o;)s.call(a||this,o.data,l,this),o=o.next,l++},map:function(s,a){var o=new n;return this.forEach(function(l,f,h){o.push(s.call(a||h,l,f,h))}),o},filter:function(s,a){var o=new n;return this.forEach(function(l,f,h){s.call(a||h,l,f,h)&&o.push(l)}),o},reduce:function(s,a,o){var l=0,f=this._head,h=this.length;for(a||(l=1,a=f&&f.data,f=f&&f.next);l<h&&f;)a=s.call(o||this,a,f.data,this),l++,f=f.next;return a}},t.exports=n})()})(fastList);var LinkedList=fastList.exports;function floodFill(t={}){const{x:e=0,y:r=0,inPlace:n=!0}=t,s=n?this:Image.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(e,r))return s;const o=new LinkedList;for(o.push(new Node(e,r));o.length>0;){const l=o.shift();s.setBitXY(l.x,l.y);for(let f=l.x+1;f<this.width&&(!s.getBitXY(f,l.y)&&!this.getBitXY(f,l.y));f++)s.setBitXY(f,l.y),l.y+1<this.height&&!this.getBitXY(f,l.y+1)&&o.push(new Node(f,l.y+1)),l.y-1>=0&&!this.getBitXY(f,l.y-1)&&o.push(new Node(f,l.y-1));for(let f=l.x-1;f>=0&&(!s.getBitXY(f,l.y)&&!this.getBitXY(f,l.y));f++)s.setBitXY(f,l.y),l.y+1<this.height&&!this.getBitXY(f,l.y+1)&&o.push(new Node(f,l.y+1)),l.y-1>=0&&!this.getBitXY(f,l.y-1)&&o.push(new Node(f,l.y-1))}return s}function Node(t,e){this.x=t,this.y=e}function _extends(){return _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},_extends.apply(this,arguments)}function hsv2rgb(t,e,r){e=e/100,r=r/100;var n=[],s=r*e,a=t/60,o=s*(1-Math.abs(a%2-1)),l=r-s;return a>=0&&a<1?n=[s,o,0]:a>=1&&a<2?n=[o,s,0]:a>=2&&a<3?n=[0,s,o]:t>=3&&a<4?n=[0,o,s]:t>=4&&a<5?n=[o,0,s]:t>=5&&a<=6?n=[s,0,o]:n=[0,0,0],{r:Math.round(255*(n[0]+l)),g:Math.round(255*(n[1]+l)),b:Math.round(255*(n[2]+l))}}function hsl2hsv(t,e,r){return e*=(r<50?r:100-r)/100,{h:t,s:2*e/(r+e)*100,v:r+e}}function hsl2rgb$1(t,e,r){var n=hsl2hsv(t,e,r);return hsv2rgb(n.h,n.s,n.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(t){return named(t)||hex3(t)||hex6(t)||rgb(t)||rgba$1(t)||hsl(t)||hsla(t)}function named(t){var e=colors[t.toLowerCase()];if(!!e)return{r:e[0],g:e[1],b:e[2],a:100}}function rgb(t){var e=t.match(/rgb\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:100}}}function rgba$1(t){var e=t.match(/rgba\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:r[3]*100}}}function hex6(t){if(t[0]==="#"&&t.length===7)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:100}}function hex3(t){if(t[0]==="#"&&t.length===4)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:100}}function hsl(t){var e=t.match(/hsl\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */),n=parseInt(r[0],10),s=parseInt(r[1],10),a=parseInt(r[2],10),o=hsl2rgb$1(n,s,a);return _extends({},o,{a:100})}}function hsla(t){var e=t.match(/hsla\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */),n=parseInt(r[0],10),s=parseInt(r[1],10),a=parseInt(r[2],10),o=parseInt(parseFloat(r[3])*100,10),l=hsl2rgb$1(n,s,a);return _extends({},l,{a:o})}}function css2array(t){let e=parse(t);return[e.r,e.g,e.b,Math.round(e.a*255/100)]}function hue2rgb(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function hsl2rgb(t,e,r){let n,s,a,o,l,f;return e/=100,r/=100,e===0?o=l=f=r*255:(r<=.5?s=r*(e+1):s=r+e-r*e,n=r*2-s,a=t/360,o=hue2rgb(n,s,a+1/3),l=hue2rgb(n,s,a),f=hue2rgb(n,s,a-1/3)),{r:o,g:l,b:f}}function getDistinctColors(t){let e=new Array(t),r=0;for(let n=0;n<360;n+=360/t){r++;let s=hsl2rgb(n,100,30+r%4*15);e[r-1]=[Math.round(s.r*255),Math.round(s.g*255),Math.round(s.b*255)]}return e}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(t){let{color:e,colors:r,randomColors:n,numberColors:s=50}=t;if(e&&!Array.isArray(e)&&(e=css2array(e)),e)return[e];if(r)return r=r.map(function(a){return Array.isArray(a)?a:css2array(a)}),r;if(n){r=new Array(s);for(let a=0;a<s;a++)r[a]=getRandomColor()}return getDistinctColors(s)}function paintLabels(t,e,r={}){let{color:n="blue",colors:s,font:a="12px Helvetica",rotate:o=0}=r;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(t))throw Error("paintLabels: labels must be an array");if(!Array.isArray(e))throw Error("paintLabels: positions must be an array");if(n&&!Array.isArray(n)&&(n=css2array(n)),s?s=s.map(function(h){return Array.isArray(h)?h:css2array(h)}):s=[n],t.length!==e.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(a)||(a=[a]),Array.isArray(o)||(o=[o]);let f=this.getCanvas().getContext("2d");for(let h=0;h<t.length;h++){f.save();let c=s[h%s.length];f.fillStyle=`rgba(${c[0]},${c[1]},${c[2]},${c[3]/this.maxValue})`,f.font=a[h%a.length];let u=e[h];f.translate(u[0],u[1]),f.rotate(o[h%o.length]/180*Math.PI),f.fillText(t[h],0,0),f.restore()}return this.data=Uint8Array.from(f.getImageData(0,0,this.width,this.height).data),this}function paintMasks(t,e={}){let{alpha:r=255,labels:n=[],labelsPosition:s=[],labelColor:a="blue",labelFont:o="12px Helvetica"}=e;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let l=getColors(Object.assign({},e,{numberColors:t.length}));Array.isArray(t)||(t=[t]);for(let f=0;f<t.length;f++){let h=t[f],c=l[f%l.length];for(let u=0;u<h.width;u++)for(let g=0;g<h.height;g++)if(h.getBitXY(u,g))for(let d=0;d<Math.min(this.components,c.length);d++)if(r===255)this.setValueXY(u+h.position[0],g+h.position[1],d,c[d]);else{let p=this.getValueXY(u+h.position[0],g+h.position[1],d);p=Math.round((p*(255-r)+c[d]*r)/255),this.setValueXY(u+h.position[0],g+h.position[1],d,p)}}if(Array.isArray(n)&&n.length>0){let h=this.getCanvas().getContext("2d");h.fillStyle=a,h.font=o;for(let c=0;c<Math.min(t.length,n.length);c++){let u=s[c]?s[c]:t[c].position;h.fillText(n[c],u[0],u[1])}this.data=Uint8Array.from(h.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(t,e){let r=new Array(t);for(let n=0;n<t;n++)r[n]=new Array(e).fill(0);return r}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(e={}){let{kind:r="cross",shape:n,size:s,width:a,height:o,filled:l=!0}=e;if(s&&(a=s,o=s),n)switch(n.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(a,o,{filled:l});break;case"circle":case"ellipse":this.matrix=ellipse(a,o,{filled:l});break;case"triangle":this.matrix=triangle(a,o,{filled:l});break;default:throw new Error(`Shape: unexpected shape: ${n}`)}else if(r)switch(r.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${r}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let e=this.matrix,r=[];for(let n=0;n<e.length;n++)for(let s=0;s<e[0].length;s++)e[n][s]&&r.push([s-this.halfWidth,n-this.halfHeight]);return r}getMask(){let e=new Image(this.width,this.height,{kind:BINARY});for(let r=0;r<this.matrix.length;r++)for(let n=0;n<this.matrix[0].length;n++)this.matrix[r][n]&&e.setBitXY(n,r);return e}}function rectangle(t,e,r){const n=zerosMatrix(e,t);if(r.filled)for(let s=0;s<e;s++)for(let a=0;a<t;a++)n[s][a]=1;else{for(let s of[0,e-1])for(let a=0;a<t;a++)n[s][a]=1;for(let s=0;s<e;s++)for(let a of[0,t-1])n[s][a]=1}return n}function ellipse(t,e,r){const n=zerosMatrix(e,t);let s=1-e%2,a=1-t%2,o=Math.floor((t-1)/2),l=Math.floor((e-1)/2),f=o*o,h=l*l;if(r.filled)for(let c=0;c<=l;c++){let u=Math.floor(Math.sqrt(f-f*c*c/h));for(let g=o-u;g<=o;g++)n[l-c][g]=1,n[l+c+s][g]=1,n[l-c][t-g-1]=1,n[l+c+s][t-g-1]=1}else{for(let c=0;c<=l;c++){let u=Math.floor(Math.sqrt(f-f*c*c/h)),g=o-u;n[l-c][g]=1,n[l+c+s][g]=1,n[l-c][t-g-1]=1,n[l+c+s][t-g-1]=1}for(let c=0;c<=o;c++){let u=Math.floor(Math.sqrt(h-h*c*c/f)),g=l-u;n[g][o-c]=1,n[g][o+c+a]=1,n[e-g-1][o-c]=1,n[e-g-1][o+c+a]=1}}return n}function triangle(t,e,r){if(!r.filled)throw new Error("Non filled triangle is not implemented");const n=zerosMatrix(e,t);for(let s=0;s<e;s++){let a=Math.floor((1-s/e)*t/2);for(let o=a;o<t-a;o++)n[s][o]=1}return n}function paintPoints(t,e={}){let{shape:r}=e;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let n=getColors(Object.assign({},e,{numberColors:t.length})),s=new Shape(r).getPoints(),a=Math.min(this.channels,n[0].length);for(let o=0;o<t.length;o++){let l=n[o%n.length],f=t[o][0],h=t[o][1];for(let c=0;c<s.length;c++){let u=s[c][0],g=s[c][1];if(f+u>=0&&h+g>=0&&f+u<this.width&&h+g<this.height){let d=(f+u+(h+g)*this.width)*this.channels;for(let p=0;p<a;p++)this.data[d+p]=l[p]}}}return this}function paintPolyline(t,e={}){let{color:r=[this.maxValue,0,0],closed:n=!1}=e;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let s=Math.min(this.channels,r.length);for(let a=0;a<t.length-1+n;a++){let o=t[a],l=t[(a+1)%t.length],f=l[0]-o[0],h=l[1]-o[1],c=Math.max(Math.abs(f),Math.abs(h)),u=f/c,g=h/c,d=o[0],p=o[1];for(let x=0;x<=c;x++){let y=Math.round(d),m=Math.round(p);if(y>=0&&m>=0&&y<this.width&&m<this.height)if(this.bitDepth===1)this.setBitXY(y,m);else{let A=(y+m*this.width)*this.channels;for(let b=0;b<s;b++)this.data[A+b]=r[b]}d=d+u,p=p+g}}return this}function paintPolylines(t,e={}){let r=Object.assign({},e);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let n=getColors(Object.assign({},e,{numberColors:t.length}));for(let s=0;s<t.length;s++)r.color=n[s%n.length],this.paintPolyline(t[s],r);return this}function paintPolygon(t,e={}){let{color:r=[this.maxValue,0,0],filled:n=!1}=e;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),e.closed=!0;let s=deleteDouble(t);if(n===!1)return this.paintPolyline(t,e);{let a=Array(this.height);for(let o=0;o<this.height;o++){a[o]=[];for(let l=0;l<this.width;l++)a[o].push(0)}for(let o=0;o<s.length;o++){const l=lineBetweenTwoPoints(s[o],s[(o+1)%s.length]);for(let f=0;f<this.height;f++)for(let h=0;h<this.width;h++)isAtTheRightOfTheLine(h,f,l,this.height)&&(a[f][h]=a[f][h]===0?1:0)}for(let o=0;o<this.height;o++)for(let l=0;l<this.width;l++)if(a[o][l]===1)if(this.bitDepth===1)this.setBitXY(l,o);else{let f=Math.min(this.channels,r.length),h=(l+o*this.width)*this.channels;for(let c=0;c<f;c++)this.data[h+c]=r[c]}return this.paintPolyline(t,e)}}function deleteDouble(t){let e=[];for(let r=0;r<t.length;r++)if(!(t[r][0]===t[(r+1)%t.length][0]&&t[r][1]===t[(r+1)%t.length][1])){if(t[r][0]===t[(r-1+t.length)%t.length][0]&&t[r][1]===t[(r-1+t.length)%t.length][1])continue;if(t[(r+1)%t.length][0]===t[(r-1+t.length)%t.length][0]&&t[(r-1+t.length)%t.length][1]===t[(r+1)%t.length][1])continue;e.push(t[r])}return e}function lineBetweenTwoPoints(t,e){if(t[0]===e[0])return{a:0,b:t[0],vertical:!0};{const r=(e[1]-t[1])/(e[0]-t[0]),n=t[1]-r*t[0];return{a:r,b:n,vertical:!1}}}function isAtTheRightOfTheLine(t,e,r,n){if(r.vertical===!0)return r.b<=t;if(r.a===0)return!1;{const s=(e-r.b)/r.a;return s<t&&s>=0&&s<=n}}function paintPolygons(t,e={}){let r=Object.assign({},e);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let n=getColors(Object.assign({},e,{numberColors:t.length}));for(let s=0;s<t.length;s++)r.color=n[s%n.length],this.paintPolygon(t[s],r);return this}function getHistogram(t={}){let{maxSlots:e=256,channel:r,useAlpha:n=!0}=t;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}return getChannelHistogram.call(this,r,{useAlpha:n,maxSlots:e})}function getHistograms(t={}){const{maxSlots:e=256,useAlpha:r=!0}=t;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let n=new Array(r?this.components:this.channels);for(let s=0;s<n.length;s++)n[s]=getChannelHistogram.call(this,s,{useAlpha:r,maxSlots:e});return n}function getChannelHistogram(t,e){let{useAlpha:r,maxSlots:n}=e;if(this.bitDepth===1){let f=[0,0];for(let h=0;h<this.height;h++)for(let c=0;c<this.width;c++){let u=this.getBitXY(h,c);u===0?f[0]+=1:u===1&&(f[1]+=1)}return f}let s=Math.log2(n);if(!isInteger(s))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let a=0;this.bitDepth>s&&(a=this.bitDepth-s);let o=this.data,l=newArray_1(Math.pow(2,Math.min(this.bitDepth,s)),0);if(r&&this.alpha){let f=this.channels-t-1;for(let h=t;h<o.length;h+=this.channels)l[o[h]>>a]+=o[h+f]/this.maxValue}else for(let f=t;f<o.length;f+=this.channels)l[o[f]>>a]++;return l}function getColorHistogram(t={}){let{useAlpha:e=!0,nbSlots:r=512}=t;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let n=Math.log(r)/Math.log(8);if(n!==Math.floor(n))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let s=this.bitDepth-n,a=this.data,o=newArray_1(Math.pow(8,n),0),l=Math.pow(2,n*2),f=Math.pow(2,n);for(let h=0;h<a.length;h+=this.channels){let c=(a[h]>>s)*l+(a[h+1]>>s)*f+(a[h+2]>>s);e&&this.alpha?o[c]+=a[h+this.channels-1]/this.maxValue:o[c]++}return o}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let t=newArray_1(this.channels,1/0);for(let e=0;e<this.data.length;e+=this.channels)for(let r=0;r<this.channels;r++)this.data[e+r]<t[r]&&(t[r]=this.data[e+r]);return t}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let t=newArray_1(this.channels,-1/0);for(let e=0;e<this.data.length;e+=this.channels)for(let r=0;r<this.channels;r++)this.data[e+r]>t[r]&&(t[r]=this.data[e+r]);return t}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let t=newArray_1(this.channels,0);for(let e=0;e<this.data.length;e+=this.channels)for(let r=0;r<this.channels;r++)t[r]+=this.data[e+r];return t}function getMoment(t=0,e=0){this.checkProcessable("getMoment",{bitDepth:[1]});let r=0;for(let n=0;n<this.width;n++)for(let s=0;s<this.height;s++)this.getBitXY(n,s)===1&&(r+=n**t*s**e);return r}function localMaxima(t={}){let{mask:e,region:r=3,removeClosePoints:n=0,invert:s=!1,maxEquals:a=2}=t,o=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),r*=4;let l=s?0:1,f=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],h=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],c=r<=8?1:2,u=[];for(let g=c;g<o.height-c;g++)for(let d=c;d<o.width-c;d++){if(e&&e.getBitXY(d,g)!==l)continue;let p=0,x=0,y=o.data[d+g*o.width];for(let m=0;m<r;m++)s?o.data[d+f[m]+(g+h[m])*o.width]>y&&p++:o.data[d+f[m]+(g+h[m])*o.width]<y&&p++,o.data[d+f[m]+(g+h[m])*o.width]===y&&x++;p+x===r&&x<=a&&u.push([d,g])}if(n>0)for(let g=0;g<u.length;g++)for(let d=g+1;d<u.length;d++)Math.sqrt(Math.pow(u[g][0]-u[d][0],2)+Math.pow(u[g][1]-u[d][1],2))<n&&(u[g][0]=u[g][0]+u[d][0]>>1,u[g][1]=u[g][1]+u[d][1]>>1,u.splice(d,1),d--);return u}function mean(){let t=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(t.length);for(let r=0;r<t.length;r++){let n=t[r];e[r]=mean$2(n)}return e}function median(){let t=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(t.length);for(let r=0;r<t.length;r++){let n=t[r];e[r]=median$2(n)}return e}function points(){this.checkProcessable("points",{bitDepth:[1]});const t=[];for(let e=0;e<this.width;e++)for(let r=0;r<this.height;r++)this.getBitXY(e,r)===1&&t.push([e,r]);return t}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const t=[];for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)if(this.getBitXY(r,e)===1)for(t.push([r,e]),this.getBitXY(r+1,e)!==1?(t.push([r+1,e]),t.push([r+1,e+1]),this.getBitXY(r,e+1)!==1&&t.push([r,e+1])):this.getBitXY(r,e+1)!==1&&(t.push([r,e+1]),t.push([r+1,e+1]));r<this.width-2&&this.getBitXY(r+1,e)===1&&this.getBitXY(r+2,e)===1;)r++;return t}function getRelativePosition(t,e={}){if(this===t)return[0,0];let r=[0,0],n=this;for(;n;){if(n===t)return r;n.position&&(r[0]+=n.position[0],r[1]+=n.position[1]),n=n.parent}return e.defaultFurther?r:!1}function countAlphaPixels(t={}){let{alpha:e=1}=t;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let r=0;if(e!==void 0){for(let n=this.components;n<this.data.length;n+=this.channels)this.data[n]===e&&r++;return r}else return this.size}function monotoneChainConvexHull$1(t,e={}){e.sorted||t.sort(byXThenY);const r=t.length,n=new Array(r*2);for(var s=0,a=0;a<r;a++){const l=t[a];for(;s>=2&&cw(n[s-2],n[s-1],l)<=0;)s--;n[s++]=l}const o=s+1;for(a=r-2;a>=0;a--){const l=t[a];for(;s>=o&&cw(n[s-2],n[s-1],l)<=0;)s--;n[s++]=l}return n.slice(0,s-1)}function cw(t,e,r){return(e[1]-t[1])*(r[0]-t[0])-(e[0]-t[0])*(r[1]-t[1])}function byXThenY(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(t){for(let e=0;e<t.length;e++)t[e][0]=Math.round(t[e][0]),t[e][1]=Math.round(t[e][1]);return t}function difference(t,e){return[t[0]-e[0],t[1]-e[1]]}function normalize(t){let e=Math.sqrt(t[0]**2+t[1]**2);return[t[0]/e,t[1]/e]}function rotate(t,e,r){r===void 0&&(r=new Array(e.length));let n=Math.cos(t),s=Math.sin(t);for(let a=0;a<r.length;++a)r[a]=[n*e[a][0]-s*e[a][1],s*e[a][0]+n*e[a][1]];return r}function perimeter(t){let e=0;for(let r=0;r<t.length;r++){let n=t[r][0],s=t[r][1],a=t[r===t.length-1?0:r+1][0],o=t[r===t.length-1?0:r+1][1];e+=Math.sqrt((a-n)**2+(o-s)**2)}return e}function surface(t){let e=0;for(let r=0;r<t.length;r++){let n=t[r][0],s=t[r===t.length-1?0:r+1][1],a=t[r===t.length-1?0:r+1][0],o=t[r][1];e+=n*s*.5,e-=a*o*.5}return Math.abs(e)}function minMax(t){let e=1/0,r=1/0,n=-1/0,s=-1/0;for(let a=0;a<t.length;a++)t[a][0]<e&&(e=t[a][0]),t[a][0]>n&&(n=t[a][0]),t[a][1]<r&&(r=t[a][1]),t[a][1]>s&&(s=t[a][1]);return[[e,r],[n,s]]}function moveToZeroZero(t,e){e===void 0&&(e=new Array(t.length).fill(0).map(()=>[]));let r=minMax(t),n=r[0][0],s=r[0][1];for(let a=0;a<t.length;a++)e[a][0]=t[a][0]-n,e[a][1]=t[a][1]-s;return e}function minimalBoundingRectangle(t={}){const{originalPoints:e=monotoneChainConvexHull.call(this)}=t;if(e.length===0)return[];if(e.length===1)return[e[0],e[0],e[0],e[0]];const r=new Array(e.length);let n=1/0,s=0,a;for(let o=0;o<r.length;o++){let l=getAngle$1(e[o],e[(o+1)%r.length]);rotate(-l,e,r);let f=r[o][0],h=r[o][1],c=r[(o+1)%r.length][0],u=r[(o+1)%r.length][1],g=!0,d=0,p=0,x=0;for(let b=0;b<r.length;b++){let _=r[b][0],E=r[b][1],T=(_-f)/(c-f);g===!0?(g=!1,d=T,p=T):(T<d&&(d=T),T>p&&(p=T));let I=(-(c-f)*E+c*h-u*f)/(c-f);Math.abs(I)>Math.abs(x)&&(x=I)}let y=[f+d*(c-f),h],m=[f+p*(c-f),h],A=Math.abs(x*(d-p)*(c-f));A<n&&(s=l,n=A,a=[y,m,[m[0],m[1]-x],[y[0],y[1]-x]])}return rotate(s,a,a),a}function getAngle$1(t,e){let r=difference(e,t),n=normalize(r),s=Math.acos(n[0]);return n[1]<0?-s:s}function extend$1(t){let e={inPlace:!0};t.extendMethod("invert",invert),t.extendMethod("abs",abs),t.extendMethod("level",level,e),t.extendMethod("add",add,e),t.extendMethod("subtract",subtract,e),t.extendMethod("subtractImage",subtractImage),t.extendMethod("multiply",multiply,e),t.extendMethod("divide",divide,e),t.extendMethod("hypotenuse",hypotenuse),t.extendMethod("background",background$1),t.extendMethod("flipX",flipX),t.extendMethod("flipY",flipY),t.extendMethod("blurFilter",blurFilter),t.extendMethod("medianFilter",medianFilter),t.extendMethod("gaussianFilter",gaussianFilter),t.extendMethod("sobelFilter",sobelFilter),t.extendMethod("gradientFilter",gradientFilter),t.extendMethod("scharrFilter",scharrFilter),t.extendMethod("dilate",dilate),t.extendMethod("erode",erode),t.extendMethod("open",open),t.extendMethod("close",close),t.extendMethod("topHat",topHat),t.extendMethod("blackHat",blackHat),t.extendMethod("morphologicalGradient",morphologicalGradient),t.extendMethod("warpingFourPoints",warpingFourPoints),t.extendMethod("crop",crop),t.extendMethod("cropAlpha",cropAlpha),t.extendMethod("resize",resize).extendMethod("scale",resize),t.extendMethod("hsv",hsv),t.extendMethod("hsl",hsl$1),t.extendMethod("cmyk",cmyk),t.extendMethod("rgba8",rgba8),t.extendMethod("grey",grey).extendMethod("gray",grey),t.extendMethod("mask",mask),t.extendMethod("pad",pad),t.extendMethod("colorDepth",colorDepth),t.extendMethod("setBorder",setBorder,e),t.extendMethod("rotate",rotate$1),t.extendMethod("rotateLeft",rotateLeft),t.extendMethod("rotateRight",rotateRight),t.extendMethod("insert",insert),t.extendMethod("getRow",getRow),t.extendMethod("getColumn",getColumn),t.extendMethod("getMatrix",getMatrix),t.extendMethod("setMatrix",setMatrix),t.extendMethod("getPixelsArray",getPixelsArray),t.extendMethod("getIntersection",getIntersection),t.extendMethod("getClosestCommonParent",getClosestCommonParent),t.extendMethod("getThreshold",getThreshold),t.extendMethod("split",split),t.extendMethod("getChannel",getChannel),t.extendMethod("combineChannels",combineChannels),t.extendMethod("setChannel",setChannel),t.extendMethod("getSimilarity",getSimilarity),t.extendMethod("getPixelsGrid",getPixelsGrid),t.extendMethod("getBestMatch",getBestMatch),t.extendMethod("cannyEdge",cannyEdge),t.extendMethod("convolution",convolution),t.extendMethod("extract",extract),t.extendMethod("floodFill",floodFill),t.extendMethod("paintLabels",paintLabels,e),t.extendMethod("paintMasks",paintMasks,e),t.extendMethod("paintPoints",paintPoints,e),t.extendMethod("paintPolyline",paintPolyline,e),t.extendMethod("paintPolylines",paintPolylines,e),t.extendMethod("paintPolygon",paintPolygon,e),t.extendMethod("paintPolygons",paintPolygons,e),t.extendMethod("countAlphaPixels",countAlphaPixels),t.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),t.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),t.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),t.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),t.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),t.extendMethod("getMin",min).extendProperty("min",min),t.extendMethod("getMax",max).extendProperty("max",max),t.extendMethod("getSum",sum).extendProperty("sum",sum),t.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),t.extendMethod("getLocalMaxima",localMaxima),t.extendMethod("getMedian",median).extendProperty("median",median),t.extendMethod("getMean",mean).extendProperty("mean",mean),t.extendMethod("getPoints",points).extendProperty("points",points),t.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),t.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(commonjsGlobal,function(){function r(S){return typeof S=="string"||S instanceof String}var n=Number.isFinite||window.isFinite;function s(S){return n(S)}function a(S){return S}function o(S){var B={};return S.filter(function($){return B.hasOwnProperty($)?!1:B[$]=!0})}function l(S,B){if(B.length!==S.length)return!1;for(var $=0;$<S.length;$++)if(B[$].compareArray&&!B[$].compareArray(S[$])||B[$]!==S[$])return!1;return!0}function f(S,B){Object.keys(B).forEach(function($){S[$]=B[$]})}function h(){for(var S=1,B=0,$=0;$<arguments.length;$++){var O=arguments[$];B=B+g(O),S*=O}return B!==0?u(S,B):S}function c(S,B){if(B===0)throw new Error("Divide by zero");var $=Math.pow(10,g(B)),O=$/($*B);return h(S,O)}function u(S,B){return Math.round(S*Math.pow(10,B))/Math.pow(10,B)}function g(S){if(!isFinite(S))return 0;for(var B=0;S%1!==0;)S*=10,B++;return B}function d(){var S;if(!this)return S=Object.create(d.prototype),d.apply(S,arguments),S;S=Error.apply(this,arguments),this.name="QtyError",this.message=S.message,this.stack=S.stack}d.prototype=Object.create(Error.prototype,{constructor:{value:d}});function p(S,B){throw new d("Incompatible units: "+S+" and "+B)}var x={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","\u03BC","\xB5","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","\u03A9","\u2126"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},y=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],m="<1>",A=[m];function b(S,B){var $=B[1],O=B[3]||[],z=B[4]||[];if(!s($))throw new d(S+": Invalid unit definition. 'scalar' must be a number");O.forEach(function(q){if(x[q]===void 0)throw new d(S+": Invalid unit definition. Unit "+q+" in 'numerator' is not recognized")}),z.forEach(function(q){if(x[q]===void 0)throw new d(S+": Invalid unit definition. Unit "+q+" in 'denominator' is not recognized")})}var _={},E={},T={},I={},v={};for(var k in x)if(x.hasOwnProperty(k)){var w=x[k];if(w[2]==="prefix"){_[k]=w[1];for(var M=0;M<w[0].length;M++)E[w[0][M]]=k}else{b(k,w),T[k]={scalar:w[1],numerator:w[3],denominator:w[4]};for(var D=0;D<w[0].length;D++)I[w[0][D]]=k}v[k]=w[0][0]}function R(S){var B,$=[],O=Object.keys(x);if(typeof S=="undefined")for(B=0;B<O.length;B++)["","prefix"].indexOf(x[O[B]][2])===-1&&$.push(O[B].substr(1,O[B].length-2));else{if(this.getKinds().indexOf(S)===-1)throw new d("Kind not recognized");for(B=0;B<O.length;B++)x[O[B]][2]===S&&$.push(O[B].substr(1,O[B].length-2))}return $.sort(function(z,q){return z.toLowerCase()<q.toLowerCase()?-1:z.toLowerCase()>q.toLowerCase()?1:0})}function F(S){if(!I[S])throw new d("Unit not recognized");return x[I[S]][0]}var P=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function H(){if(this.signature)return this.signature;for(var S=Z.call(this),B=0;B<S.length;B++)S[B]*=Math.pow(20,B);return S.reduce(function($,O){return $+O},0)}function Z(){if(!this.isBase())return Z.call(this.toBase());for(var S=new Array(P.length),B=0;B<S.length;B++)S[B]=0;for(var $,O,z=0;z<this.numerator.length;z++)($=x[this.numerator[z]])&&(O=P.indexOf($[2]),O>=0&&(S[O]=S[O]+1));for(var q=0;q<this.denominator.length;q++)($=x[this.denominator[q]])&&(O=P.indexOf($[2]),O>=0&&(S[O]=S[O]-1));return S}var X="[+-]",ee="\\d+",G=X+"?"+ee,se="\\."+ee,ie="(?:"+ee+"(?:"+se+")?)|(?:"+se+")",Y="[Ee]"+G,j="(?:"+ie+")(?:"+Y+")?",L=X+"?\\s*"+j,W="("+L+")?\\s*([^/]*)(?:/(.+))?",te=new RegExp("^"+W+"$"),de="\\^|\\*{2}",le="[01234]",ge=new RegExp("([^ \\*\\d]+?)(?:"+de+")?(-?"+le+"(?![a-zA-Z]))"),xe=new RegExp("([^ \\*\\d]+?)(?:"+de+")?("+le+"(?![a-zA-Z]))");function ye(S){r(S)||(S=S.toString()),S=S.trim();var B=te.exec(S);if(!B)throw new d(S+": Quantity not recognized");var $=B[1];$?($=$.replace(/\s/g,""),this.scalar=parseFloat($)):this.scalar=1;for(var O=B[2],z=B[3],q,ke,Ee;B=ge.exec(O);){if(q=parseFloat(B[2]),isNaN(q))throw new d("Unit exponent is not a number");if(q===0&&!he.test(B[1]))throw new d("Unit not recognized");ke=B[1]+" ",Ee="";for(var Ie=0;Ie<Math.abs(q);Ie++)Ee+=ke;q>=0?O=O.replace(B[0],Ee):(z=z?z+Ee:Ee,O=O.replace(B[0],""))}for(;B=xe.exec(z);){if(q=parseFloat(B[2]),isNaN(q))throw new d("Unit exponent is not a number");if(q===0&&!he.test(B[1]))throw new d("Unit not recognized");ke=B[1]+" ",Ee="";for(var De=0;De<q;De++)Ee+=ke;z=z.replace(B[0],Ee)}O&&(this.numerator=oe(O.trim())),z&&(this.denominator=oe(z.trim()))}var pe=Object.keys(E).sort(function(S,B){return B.length-S.length}).join("|"),K=Object.keys(I).sort(function(S,B){return B.length-S.length}).join("|"),U="\\b|$",me="("+pe+")??("+K+")(?:"+U+")",he=new RegExp("^\\s*("+me+"[\\s\\*]*)+$"),C=new RegExp(me,"g"),re={};function oe(S){var B=re[S];if(B)return B;var $,O=[];if(!he.test(S))throw new d("Unit not recognized");for(;$=C.exec(S);)O.push($.slice(1));return O=O.map(function(z){return E[z[0]]?[E[z[0]],I[z[1]]]:[I[z[1]]]}),O=O.reduce(function(z,q){return z.concat(q)},[]),O=O.filter(function(z){return z}),re[S]=O,O}function ae(S){if(!r(S))throw new d("Argument should be a string");try{return this(S)}catch{return null}}function fe(S){return S instanceof N}function N(S,B){if(ve.apply(null,arguments),!fe(this))return new N(S,B);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=A,this.denominator=A,ue(S)?(this.scalar=S.scalar,this.numerator=S.numerator&&S.numerator.length!==0?S.numerator:A,this.denominator=S.denominator&&S.denominator.length!==0?S.denominator:A):B?(ye.call(this,B),this.scalar=S):ye.call(this,S),this.denominator.join("*").indexOf("temp")>=0)throw new d("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new d("Cannot multiply by temperatures");if(!l(this.denominator,A))throw new d("Cannot divide with temperatures")}if(this.initValue=S,Q.call(this),this.isTemperature()&&this.baseScalar<0)throw new d("Temperatures must not be less than absolute zero")}N.prototype={constructor:N};function ve(S,B){if(B){if(!(s(S)&&r(B)))throw new d("Only number accepted as initialization value when units are explicitly provided")}else if(!(r(S)||s(S)||fe(S)||ue(S)))throw new d("Only string, number or quantity accepted as single initialization value")}function ue(S){return S&&typeof S=="object"&&S.hasOwnProperty("scalar")}function Q(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=H.call(this);else{var S=this.toBase();this.baseScalar=S.scalar,this.signature=S.signature}}var J={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber","0":"unitless","1":"length","2":"area","3":"volume","20":"time","400":"temperature","7941":"yank","7942":"power","7959":"pressure","7961":"force","7962":"energy","7979":"viscosity","7981":"momentum","7982":"angular_momentum","7997":"density","7998":"area_density","8000":"mass","152020":"radiation_exposure","159999":"magnetism","160000":"current","160020":"charge","312058":"conductance","312078":"capacitance","3199980":"activity","3199997":"molar_concentration","3200000":"substance","63999998":"illuminance","64000000":"luminous_power","1280000000":"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function V(){return o(Object.keys(J).map(function(S){return J[S]}))}N.prototype.kind=function(){return J[this.signature.toString()]},f(N.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&l(this.denominator,A)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function be(S,B){var $=S.units(),O=B.to($),z=N(ne($));return N({scalar:S.scalar-O.scalar,numerator:z.numerator,denominator:z.denominator})}function we(S,B){var $=B.to(ne(S.units()));return N({scalar:S.scalar-$.scalar,numerator:S.numerator,denominator:S.denominator})}function _e(S,B){var $=B.to(ne(S.units()));return N({scalar:S.scalar+$.scalar,numerator:S.numerator,denominator:S.denominator})}function ne(S){if(S==="tempK")return"degK";if(S==="tempC")return"degC";if(S==="tempF")return"degF";if(S==="tempR")return"degR";throw new d("Unknown type for temp conversion from: "+S)}function ce(S,B){var $=Me(S),O=B.units(),z;if(O==="degK")z=$.scalar;else if(O==="degC")z=$.scalar;else if(O==="degF")z=$.scalar*9/5;else if(O==="degR")z=$.scalar*9/5;else throw new d("Unknown type for degree conversion to: "+O);return N({scalar:z,numerator:B.numerator,denominator:B.denominator})}function Me(S){var B=S.units(),$;if(B.match(/(deg)[CFRK]/))$=S.baseScalar;else if(B==="tempK")$=S.scalar;else if(B==="tempC")$=S.scalar;else if(B==="tempF")$=S.scalar*5/9;else if(B==="tempR")$=S.scalar*5/9;else throw new d("Unknown type for temp conversion from: "+B);return N({scalar:$,numerator:["<kelvin>"],denominator:A})}function Se(S,B){var $=B.units(),O;if($==="tempK")O=S.baseScalar;else if($==="tempC")O=S.baseScalar-273.15;else if($==="tempF")O=S.baseScalar*9/5-459.67;else if($==="tempR")O=S.baseScalar*9/5;else throw new d("Unknown type for temp conversion to: "+$);return N({scalar:O,numerator:B.numerator,denominator:B.denominator})}function Ae(S){var B=S.units(),$;if(B.match(/(deg)[CFRK]/))$=S.baseScalar;else if(B==="tempK")$=S.scalar;else if(B==="tempC")$=S.scalar+273.15;else if(B==="tempF")$=(S.scalar+459.67)*5/9;else if(B==="tempR")$=S.scalar*5/9;else throw new d("Unknown type for temp conversion from: "+B);return N({scalar:$,numerator:["<temp-K>"],denominator:A})}f(N.prototype,{to:function(S){var B,$;if(S==null)return this;if(!r(S))return this.to(S.units());if(B=this._conversionCache[S],B)return B;if($=N(S),$.units()===this.units())return this;if(!this.isCompatible($))this.isInverse($)?$=this.inverse().to(S):p(this.units(),$.units());else if($.isTemperature())$=Se(this,$);else if($.isDegrees())$=ce(this,$);else{var O=c(this.baseScalar,$.baseScalar);$=N({scalar:O,numerator:$.numerator,denominator:$.denominator})}return this._conversionCache[S]=$,$},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return Ae(this);var S=Ye[this.units()];return S||(S=He(this.numerator,this.denominator),Ye[this.units()]=S),S.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new d("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(S){if(r(S)&&(S=N(S)),s(S)&&(S=N(S+" "+this.units())),this.isUnitless()?S.isUnitless()||p(this.units(),S.units()):S=S.to(this.units()),S.scalar===0)throw new d("Divide by zero");var B=h(Math.round(this.scalar/S.scalar),S.scalar);return N(B+this.units())}});function Ce(S,B){var $=N(S),O=N(B);if($.eq(O))return a;var z;return $.isTemperature()?z=function(q){return $.mul(q).to(O).scalar}:z=function(q){return q*$.baseScalar/O.baseScalar},function(ke){var Ee,Ie,De;if(Array.isArray(ke)){for(Ie=ke.length,De=[],Ee=0;Ee<Ie;Ee++)De.push(z(ke[Ee]));return De}else return z(ke)}}var Ye={};function He(S,B){for(var $=[],O=[],z=1,q,ke=0;ke<S.length;ke++)q=S[ke],_[q]?z=h(z,_[q]):T[q]&&(z*=T[q].scalar,T[q].numerator&&$.push(T[q].numerator),T[q].denominator&&O.push(T[q].denominator));for(var Ee=0;Ee<B.length;Ee++)q=B[Ee],_[q]?z/=_[q]:T[q]&&(z/=T[q].scalar,T[q].numerator&&O.push(T[q].numerator),T[q].denominator&&$.push(T[q].denominator));return $=$.reduce(function(Ie,De){return Ie.concat(De)},[]),O=O.reduce(function(Ie,De){return Ie.concat(De)},[]),N({scalar:z,numerator:$,denominator:O})}N.parse=ae,N.getUnits=R,N.getAliases=F,N.mulSafe=h,N.divSafe=c,N.getKinds=V,N.swiftConverter=Ce,N.Error=d,f(N.prototype,{add:function(S){if(r(S)&&(S=N(S)),this.isCompatible(S)||p(this.units(),S.units()),this.isTemperature()&&S.isTemperature())throw new d("Cannot add two temperatures");return this.isTemperature()?_e(this,S):S.isTemperature()?_e(S,this):N({scalar:this.scalar+S.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(S){if(r(S)&&(S=N(S)),this.isCompatible(S)||p(this.units(),S.units()),this.isTemperature()&&S.isTemperature())return be(this,S);if(this.isTemperature())return we(this,S);if(S.isTemperature())throw new d("Cannot subtract a temperature from a differential degree unit");return N({scalar:this.scalar-S.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(S){if(s(S))return N({scalar:h(this.scalar,S),numerator:this.numerator,denominator:this.denominator});if(r(S)&&(S=N(S)),(this.isTemperature()||S.isTemperature())&&!(this.isUnitless()||S.isUnitless()))throw new d("Cannot multiply by temperatures");var B=this,$=S;B.isCompatible($)&&B.signature!==400&&($=$.to(B));var O=Pe(B.numerator,B.denominator,$.numerator,$.denominator);return N({scalar:h(B.scalar,$.scalar,O[2]),numerator:O[0],denominator:O[1]})},div:function(S){if(s(S)){if(S===0)throw new d("Divide by zero");return N({scalar:this.scalar/S,numerator:this.numerator,denominator:this.denominator})}else r(S)&&(S=N(S));if(S.scalar===0)throw new d("Divide by zero");if(S.isTemperature())throw new d("Cannot divide with temperatures");if(this.isTemperature()&&!S.isUnitless())throw new d("Cannot divide with temperatures");var B=this,$=S;B.isCompatible($)&&B.signature!==400&&($=$.to(B));var O=Pe(B.numerator,B.denominator,$.denominator,$.numerator);return N({scalar:h(B.scalar,O[2])/$.scalar,numerator:O[0],denominator:O[1]})},inverse:function(){if(this.isTemperature())throw new d("Cannot divide with temperatures");if(this.scalar===0)throw new d("Divide by zero");return N({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function Pe(S,B,$,O){function z(Be){return Be!==m}S=S.filter(z),$=$.filter(z),B=B.filter(z),O=O.filter(z);var q={};function ke(Be,Fe){for(var Re,ze,Ge,Le=0;Le<Be.length;Le++)if(_[Be[Le]]?(Re=Be[Le+1],ze=Be[Le],Ge=_[ze],Le++):(Re=Be[Le],ze=null,Ge=1),Re&&Re!==m)if(q[Re]){q[Re][0]+=Fe;var Ke=q[Re][2]?_[q[Re][2]]:1;q[Re][Fe===1?3:4]*=c(Ge,Ke)}else q[Re]=[Fe,Re,ze,1,1]}ke(S,1),ke(B,-1),ke($,1),ke(O,-1);var Ee=[],Ie=[],De=1;for(var Ze in q)if(q.hasOwnProperty(Ze)){var Te=q[Ze],$e;if(Te[0]>0)for($e=0;$e<Te[0];$e++)Ee.push(Te[2]===null?Te[1]:[Te[2],Te[1]]);else if(Te[0]<0)for($e=0;$e<-Te[0];$e++)Ie.push(Te[2]===null?Te[1]:[Te[2],Te[1]]);De*=c(Te[3],Te[4])}return Ee.length===0&&(Ee=A),Ie.length===0&&(Ie=A),Ee=Ee.reduce(function(Be,Fe){return Be.concat(Fe)},[]),Ie=Ie.reduce(function(Be,Fe){return Be.concat(Fe)},[]),[Ee,Ie,De]}f(N.prototype,{eq:function(S){return this.compareTo(S)===0},lt:function(S){return this.compareTo(S)===-1},lte:function(S){return this.eq(S)||this.lt(S)},gt:function(S){return this.compareTo(S)===1},gte:function(S){return this.eq(S)||this.gt(S)},compareTo:function(S){if(r(S))return this.compareTo(N(S));if(this.isCompatible(S)||p(this.units(),S.units()),this.baseScalar<S.baseScalar)return-1;if(this.baseScalar===S.baseScalar)return 0;if(this.baseScalar>S.baseScalar)return 1},same:function(S){return this.scalar===S.scalar&&this.units()===S.units()}}),f(N.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(S){return l(S,A)})},isCompatible:function(S){return r(S)?this.isCompatible(N(S)):fe(S)&&S.signature!==void 0?this.signature===S.signature:!1},isInverse:function(S){return this.inverse().isCompatible(S)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(S){S!==m&&y.indexOf(S)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function Oe(){}Oe.prototype.get=function(S){return arguments.length>1&&(S=Array.apply(null,arguments)),S.reduce(function(B,$,O){if(B){var z=B[$];return O===S.length-1?z?z.data:void 0:z}},this)},Oe.prototype.set=function(S,B){return arguments.length>2&&(S=Array.prototype.slice.call(arguments,0,-1),B=arguments[arguments.length-1]),S.reduce(function($,O,z){var q=$[O];return q===void 0&&(q=$[O]={}),z===S.length-1?(q.data=B,B):q},this)};function Ne(S,B){return(S+" "+B).trim()}N.formatter=Ne,f(N.prototype,{units:function(){if(this._units!==void 0)return this._units;var S=l(this.numerator,A),B=l(this.denominator,A);if(S&&B)return this._units="",this._units;var $=Xe(this.numerator),O=Xe(this.denominator);return this._units=$+(B?"":"/"+O),this._units},toString:function(S,B){var $;if(s(S))$=this.units(),B=S;else if(r(S))$=S;else if(fe(S))return this.toPrec(S).toString(B);var O=this.to($),z=B!==void 0?u(O.scalar,B):O.scalar;return O=(z+" "+O.units()).trim(),O},format:function(S,B){arguments.length===1&&typeof S=="function"&&(B=S,S=void 0),B=B||N.formatter;var $=this.to(S);return B.call(this,$.scalar,$.units())}});var Ue=new Oe;function Xe(S){var B=Ue.get(S);if(B)return B;var $=l(S,A);return $?B="1":B=Ve(je(S)).join("*"),Ue.set(S,B),B}function je(S){for(var B=[],$,O,z=0;z<S.length;z++)$=S[z],O=S[z+1],_[$]?(B.push(v[$]+v[O]),z++):B.push(v[$]);return B}function Ve(S){var B=S.reduce(function($,O){var z=$[O];return z||$.push(z=$[O]=[O,0]),z[1]++,$},[]);return B.map(function($){return $[0]+($[1]>1?$[1]:"")})}return N.version="1.7.6",N})})(quantities);var Qty=quantities.exports;function deepValue(t,e=""){let r=e.split(".");for(let n of r){if(t[n]===void 0)return;t=t[n]}return t}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(t,e,r){var n=t*e,s=SPLITTER*t,a=s-t,o=s-a,l=t-o,f=SPLITTER*e,h=f-e,c=f-h,u=e-c,g=n-o*c,d=g-l*c,p=d-o*u,x=l*u-p;return r?(r[0]=x,r[1]=n,r):[x,n]}var robustSum=linearExpansionSum;function scalarScalar$1(t,e){var r=t+e,n=r-t,s=r-n,a=e-n,o=t-s,l=o+a;return l?[l,r]:[r]}function linearExpansionSum(t,e){var r=t.length|0,n=e.length|0;if(r===1&&n===1)return scalarScalar$1(t[0],e[0]);var s=r+n,a=new Array(s),o=0,l=0,f=0,h=Math.abs,c=t[l],u=h(c),g=e[f],d=h(g),p,x;u<d?(x=c,l+=1,l<r&&(c=t[l],u=h(c))):(x=g,f+=1,f<n&&(g=e[f],d=h(g))),l<r&&u<d||f>=n?(p=c,l+=1,l<r&&(c=t[l],u=h(c))):(p=g,f+=1,f<n&&(g=e[f],d=h(g)));for(var y=p+x,m=y-p,A=x-m,b=A,_=y,E,T,I,v,k;l<r&&f<n;)u<d?(p=c,l+=1,l<r&&(c=t[l],u=h(c))):(p=g,f+=1,f<n&&(g=e[f],d=h(g))),x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),E=_+y,T=E-_,I=E-T,v=y-T,k=_-I,b=k+v,_=E;for(;l<r;)p=c,x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),E=_+y,T=E-_,I=E-T,v=y-T,k=_-I,b=k+v,_=E,l+=1,l<r&&(c=t[l]);for(;f<n;)p=g,x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),E=_+y,T=E-_,I=E-T,v=y-T,k=_-I,b=k+v,_=E,f+=1,f<n&&(g=e[f]);return b&&(a[o++]=b),_&&(a[o++]=_),o||(a[o++]=0),a.length=o,a}var twoSum$1=fastTwoSum;function fastTwoSum(t,e,r){var n=t+e,s=n-t,a=n-s,o=e-s,l=t-a;return r?(r[0]=l+o,r[1]=n,r):[l+o,n]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(t,e){var r=t.length;if(r===1){var n=twoProduct(t[0],e);return n[0]?n:[n[1]]}var s=new Array(2*r),a=[.1,.1],o=[.1,.1],l=0;twoProduct(t[0],e,a),a[0]&&(s[l++]=a[0]);for(var f=1;f<r;++f){twoProduct(t[f],e,o);var h=a[1];twoSum(h,o[0],a),a[0]&&(s[l++]=a[0]);var c=o[1],u=a[1],g=c+u,d=g-c,p=u-d;a[1]=g,p&&(s[l++]=p)}return a[1]&&(s[l++]=a[1]),l===0&&(s[l++]=0),s.length=l,s}var robustDiff=robustSubtract;function scalarScalar(t,e){var r=t+e,n=r-t,s=r-n,a=e-n,o=t-s,l=o+a;return l?[l,r]:[r]}function robustSubtract(t,e){var r=t.length|0,n=e.length|0;if(r===1&&n===1)return scalarScalar(t[0],-e[0]);var s=r+n,a=new Array(s),o=0,l=0,f=0,h=Math.abs,c=t[l],u=h(c),g=-e[f],d=h(g),p,x;u<d?(x=c,l+=1,l<r&&(c=t[l],u=h(c))):(x=g,f+=1,f<n&&(g=-e[f],d=h(g))),l<r&&u<d||f>=n?(p=c,l+=1,l<r&&(c=t[l],u=h(c))):(p=g,f+=1,f<n&&(g=-e[f],d=h(g)));for(var y=p+x,m=y-p,A=x-m,b=A,_=y,E,T,I,v,k;l<r&&f<n;)u<d?(p=c,l+=1,l<r&&(c=t[l],u=h(c))):(p=g,f+=1,f<n&&(g=-e[f],d=h(g))),x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),E=_+y,T=E-_,I=E-T,v=y-T,k=_-I,b=k+v,_=E;for(;l<r;)p=c,x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),E=_+y,T=E-_,I=E-T,v=y-T,k=_-I,b=k+v,_=E,l+=1,l<r&&(c=t[l]);for(;f<n;)p=g,x=b,y=p+x,m=y-p,A=x-m,A&&(a[o++]=A),E=_+y,T=E-_,I=E-T,v=y-T,k=_-I,b=k+v,_=E,f+=1,f<n&&(g=-e[f]);return b&&(a[o++]=b),_&&(a[o++]=_),o||(a[o++]=0),a.length=o,a}(function(t){var e=twoProduct_1,r=robustSum,n=robustScale,s=robustDiff,a=5,o=11102230246251565e-32,l=(3+16*o)*o,f=(7+56*o)*o;function h(b,_,E,T){return function(v,k,w){var M=b(b(_(k[1],w[0]),_(-w[1],k[0])),b(_(v[1],k[0]),_(-k[1],v[0]))),D=b(_(v[1],w[0]),_(-w[1],v[0])),R=T(M,D);return R[R.length-1]}}function c(b,_,E,T){return function(v,k,w,M){var D=b(b(E(b(_(w[1],M[0]),_(-M[1],w[0])),k[2]),b(E(b(_(k[1],M[0]),_(-M[1],k[0])),-w[2]),E(b(_(k[1],w[0]),_(-w[1],k[0])),M[2]))),b(E(b(_(k[1],M[0]),_(-M[1],k[0])),v[2]),b(E(b(_(v[1],M[0]),_(-M[1],v[0])),-k[2]),E(b(_(v[1],k[0]),_(-k[1],v[0])),M[2])))),R=b(b(E(b(_(w[1],M[0]),_(-M[1],w[0])),v[2]),b(E(b(_(v[1],M[0]),_(-M[1],v[0])),-w[2]),E(b(_(v[1],w[0]),_(-w[1],v[0])),M[2]))),b(E(b(_(k[1],w[0]),_(-w[1],k[0])),v[2]),b(E(b(_(v[1],w[0]),_(-w[1],v[0])),-k[2]),E(b(_(v[1],k[0]),_(-k[1],v[0])),w[2])))),F=T(D,R);return F[F.length-1]}}function u(b,_,E,T){return function(v,k,w,M,D){var R=b(b(b(E(b(E(b(_(M[1],D[0]),_(-D[1],M[0])),w[2]),b(E(b(_(w[1],D[0]),_(-D[1],w[0])),-M[2]),E(b(_(w[1],M[0]),_(-M[1],w[0])),D[2]))),k[3]),b(E(b(E(b(_(M[1],D[0]),_(-D[1],M[0])),k[2]),b(E(b(_(k[1],D[0]),_(-D[1],k[0])),-M[2]),E(b(_(k[1],M[0]),_(-M[1],k[0])),D[2]))),-w[3]),E(b(E(b(_(w[1],D[0]),_(-D[1],w[0])),k[2]),b(E(b(_(k[1],D[0]),_(-D[1],k[0])),-w[2]),E(b(_(k[1],w[0]),_(-w[1],k[0])),D[2]))),M[3]))),b(E(b(E(b(_(w[1],M[0]),_(-M[1],w[0])),k[2]),b(E(b(_(k[1],M[0]),_(-M[1],k[0])),-w[2]),E(b(_(k[1],w[0]),_(-w[1],k[0])),M[2]))),-D[3]),b(E(b(E(b(_(M[1],D[0]),_(-D[1],M[0])),k[2]),b(E(b(_(k[1],D[0]),_(-D[1],k[0])),-M[2]),E(b(_(k[1],M[0]),_(-M[1],k[0])),D[2]))),v[3]),E(b(E(b(_(M[1],D[0]),_(-D[1],M[0])),v[2]),b(E(b(_(v[1],D[0]),_(-D[1],v[0])),-M[2]),E(b(_(v[1],M[0]),_(-M[1],v[0])),D[2]))),-k[3])))),b(b(E(b(E(b(_(k[1],D[0]),_(-D[1],k[0])),v[2]),b(E(b(_(v[1],D[0]),_(-D[1],v[0])),-k[2]),E(b(_(v[1],k[0]),_(-k[1],v[0])),D[2]))),M[3]),b(E(b(E(b(_(k[1],M[0]),_(-M[1],k[0])),v[2]),b(E(b(_(v[1],M[0]),_(-M[1],v[0])),-k[2]),E(b(_(v[1],k[0]),_(-k[1],v[0])),M[2]))),-D[3]),E(b(E(b(_(w[1],M[0]),_(-M[1],w[0])),k[2]),b(E(b(_(k[1],M[0]),_(-M[1],k[0])),-w[2]),E(b(_(k[1],w[0]),_(-w[1],k[0])),M[2]))),v[3]))),b(E(b(E(b(_(w[1],M[0]),_(-M[1],w[0])),v[2]),b(E(b(_(v[1],M[0]),_(-M[1],v[0])),-w[2]),E(b(_(v[1],w[0]),_(-w[1],v[0])),M[2]))),-k[3]),b(E(b(E(b(_(k[1],M[0]),_(-M[1],k[0])),v[2]),b(E(b(_(v[1],M[0]),_(-M[1],v[0])),-k[2]),E(b(_(v[1],k[0]),_(-k[1],v[0])),M[2]))),w[3]),E(b(E(b(_(k[1],w[0]),_(-w[1],k[0])),v[2]),b(E(b(_(v[1],w[0]),_(-w[1],v[0])),-k[2]),E(b(_(v[1],k[0]),_(-k[1],v[0])),w[2]))),-M[3]))))),F=b(b(b(E(b(E(b(_(M[1],D[0]),_(-D[1],M[0])),w[2]),b(E(b(_(w[1],D[0]),_(-D[1],w[0])),-M[2]),E(b(_(w[1],M[0]),_(-M[1],w[0])),D[2]))),v[3]),E(b(E(b(_(M[1],D[0]),_(-D[1],M[0])),v[2]),b(E(b(_(v[1],D[0]),_(-D[1],v[0])),-M[2]),E(b(_(v[1],M[0]),_(-M[1],v[0])),D[2]))),-w[3])),b(E(b(E(b(_(w[1],D[0]),_(-D[1],w[0])),v[2]),b(E(b(_(v[1],D[0]),_(-D[1],v[0])),-w[2]),E(b(_(v[1],w[0]),_(-w[1],v[0])),D[2]))),M[3]),E(b(E(b(_(w[1],M[0]),_(-M[1],w[0])),v[2]),b(E(b(_(v[1],M[0]),_(-M[1],v[0])),-w[2]),E(b(_(v[1],w[0]),_(-w[1],v[0])),M[2]))),-D[3]))),b(b(E(b(E(b(_(w[1],D[0]),_(-D[1],w[0])),k[2]),b(E(b(_(k[1],D[0]),_(-D[1],k[0])),-w[2]),E(b(_(k[1],w[0]),_(-w[1],k[0])),D[2]))),v[3]),E(b(E(b(_(w[1],D[0]),_(-D[1],w[0])),v[2]),b(E(b(_(v[1],D[0]),_(-D[1],v[0])),-w[2]),E(b(_(v[1],w[0]),_(-w[1],v[0])),D[2]))),-k[3])),b(E(b(E(b(_(k[1],D[0]),_(-D[1],k[0])),v[2]),b(E(b(_(v[1],D[0]),_(-D[1],v[0])),-k[2]),E(b(_(v[1],k[0]),_(-k[1],v[0])),D[2]))),w[3]),E(b(E(b(_(k[1],w[0]),_(-w[1],k[0])),v[2]),b(E(b(_(v[1],w[0]),_(-w[1],v[0])),-k[2]),E(b(_(v[1],k[0]),_(-k[1],v[0])),w[2]))),-D[3])))),P=T(R,F);return P[P.length-1]}}function g(b){var _=b===3?h:b===4?c:u;return _(r,e,n,s)}var d=g(3),p=g(4),x=[function(){return 0},function(){return 0},function(_,E){return E[0]-_[0]},function(_,E,T){var I=(_[1]-T[1])*(E[0]-T[0]),v=(_[0]-T[0])*(E[1]-T[1]),k=I-v,w;if(I>0){if(v<=0)return k;w=I+v}else if(I<0){if(v>=0)return k;w=-(I+v)}else return k;var M=l*w;return k>=M||k<=-M?k:d(_,E,T)},function(_,E,T,I){var v=_[0]-I[0],k=E[0]-I[0],w=T[0]-I[0],M=_[1]-I[1],D=E[1]-I[1],R=T[1]-I[1],F=_[2]-I[2],P=E[2]-I[2],H=T[2]-I[2],Z=k*R,X=w*D,ee=w*M,G=v*R,se=v*D,ie=k*M,Y=F*(Z-X)+P*(ee-G)+H*(se-ie),j=(Math.abs(Z)+Math.abs(X))*Math.abs(F)+(Math.abs(ee)+Math.abs(G))*Math.abs(P)+(Math.abs(se)+Math.abs(ie))*Math.abs(H),L=f*j;return Y>L||-Y>L?Y:p(_,E,T,I)}];function y(b){var _=x[b.length];return _||(_=x[b.length]=g(b.length)),_.apply(void 0,b)}function m(b,_,E,T,I,v,k){return function(M,D,R,F,P){switch(arguments.length){case 0:case 1:return 0;case 2:return T(M,D);case 3:return I(M,D,R);case 4:return v(M,D,R,F);case 5:return k(M,D,R,F,P)}for(var H=new Array(arguments.length),Z=0;Z<arguments.length;++Z)H[Z]=arguments[Z];return b(H)}}function A(){for(;x.length<=a;)x.push(g(x.length));t.exports=m.apply(void 0,[y].concat(x));for(var b=0;b<=a;++b)t.exports[b]=x[b]}A()})(orientation);var robustPnp=robustPointInPolygon,orient=orientation.exports;function robustPointInPolygon(t,e){for(var r=e[0],n=e[1],s=t.length,a=1,o=s,l=0,f=s-1;l<o;f=l++){var h=t[l],c=t[f],u=h[1],g=c[1];if(g<u){if(g<n&&n<u){var d=orient(h,c,e);if(d===0)return 0;a^=0<d|0}else if(n===u){var p=t[(l+1)%s],x=p[1];if(u<x){var d=orient(h,c,e);if(d===0)return 0;a^=0<d|0}}}else if(u<g){if(u<n&&n<g){var d=orient(h,c,e);if(d===0)return 0;a^=d<0|0}else if(n===u){var p=t[(l+1)%s],x=p[1];if(x<u){var d=orient(h,c,e);if(d===0)return 0;a^=d<0|0}}}else if(n===u){var y=Math.min(h[0],c[0]),m=Math.max(h[0],c[0]);if(l===0){for(;f>0;){var A=(f+s-1)%s,b=t[A];if(b[1]!==n)break;var _=b[0];y=Math.min(y,_),m=Math.max(m,_),f=A}if(f===0)return y<=r&&r<=m?0:1;o=f+1}for(var E=t[(f+s-1)%s][1];l+1<o;){var b=t[l+1];if(b[1]!==n)break;var _=b[0];y=Math.min(y,_),m=Math.max(m,_),l+=1}if(y<=r&&r<=m)return 0;var T=t[(l+1)%s][1];r<y&&E<n!=T<n&&(a^=1)}}return 2*a-1}var robustPointInPolygon$1=robustPnp;function feretDiameters(t={}){const{originalPoints:e=monotoneChainConvexHull.call(this)}=t;if(e.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(e.length===1)return{min:1,max:1,minLine:[e[0],e[0]],maxLine:[e[0],e[0]],aspectRatio:1};const r=new Array(e.length);let n=1/0,s=0,a=[];for(let h=0;h<e.length;h++){let c=getAngle(e[h],e[(h+1)%e.length]);rotate(-c,e,r);let u=0,g=[];for(let d=0;d<e.length;d++){let p=Math.abs(r[h][1]-r[d][1]);p>u&&(u=p,g=[],g.push([r[d][0],r[h][1]],[r[d][0],r[d][1]]))}u<n&&(n=u,s=c,a=g)}rotate(s,a,a);let o=0,l=[],f=0;for(let h=0;h<e.length-1;h++)for(let c=h+1;c<e.length;c++){let u=(e[h][0]-e[c][0])**2+(e[h][1]-e[c][1])**2;u>f&&(f=u,o=Math.sqrt(u),l=[e[h],e[c]])}return{min:n,minLine:a,max:o,maxLine:l,aspectRatio:n/o}}function getAngle(t,e){let r=difference(e,t),n=normalize(r),s=Math.acos(n[0]);return n[1]<0?-s:s}class Roi{constructor(e,r){this.map=e,this.id=r,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(e={}){const{scale:r=1,kind:n=""}=e;let s;switch(n){case"contour":s=this.contourMask;break;case"box":s=this.boxMask;break;case"filled":s=this.filledMask;break;case"center":s=this.centerMask;break;case"mbr":s=this.mbrFilledMask;break;case"hull":s=this.convexHullFilledMask;break;case"hullContour":s=this.convexHullMask;break;case"mbrContour":s=this.mbrMask;break;case"feret":s=this.feretMask;break;default:s=this.mask}return r<1&&(s=s.resize({factor:r}),s.parent=this.mask.parent,s.position[0]+=this.minX,s.position[1]+=this.minY),s}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let e=this.borderIDs,r=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let n=this.internalIDs;for(let s=0;s<e.length;s++)n.includes(e[s])||(this.computed.externalIDs.push(e[s]),this.computed.externalLengths.push(r[s]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let e=getBorders(this);this.computed.borderIDs=e.ids,this.computed.borderLengths=e.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let e=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++)this.map.data[r+this.minX+(n+this.minY)*this.map.width]===this.id&&(r>0&&r<this.width-1&&n>0&&n<this.height-1?(this.map.data[r-1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[r+1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(n-1+this.minY)*this.map.width]!==this.id||this.map.data[r+this.minX+(n+1+this.minY)*this.map.width]!==this.id)&&e.setBitXY(r,n):e.setBitXY(r,n));this.computed.contourMask=e}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let e=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)e.setBitXY(r,0),e.setBitXY(r,this.height-1);for(let r=0;r<this.height;r++)e.setBitXY(0,r),e.setBitXY(this.width-1,r);this.computed.boxMask=e}return this.computed.boxMask}get mask(){if(!this.computed.mask){let e=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++)this.map.data[r+this.minX+(n+this.minY)*this.map.width]===this.id&&e.setBitXY(r,n);this.computed.mask=e}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let e=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let r=0;r<this.width;r++)for(let n=0;n<this.height;n++){let s=r+this.minX+(n+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[s])&&e.setBitXY(r,n)}this.computed.filledMask=e}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let e=new Shape({kind:"smallCross"}).getMask();e.parent=this.map.parent,e.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=e}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const e=[];for(let n=0;n<this.width;n++)for(let s=0;s<this.height;s++)this.map.data[n+this.minX+(s+this.minY)*this.map.width]===this.id&&(n>0&&n<this.width-1&&s>0&&s<this.height-1?(this.map.data[n-1+this.minX+(s+this.minY)*this.map.width]!==this.id||this.map.data[n+1+this.minX+(s+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(s-1+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(s+1+this.minY)*this.map.width]!==this.id)&&(e.push([n,s]),e.push([n+1,s]),e.push([n,s+1]),e.push([n+1,s+1])):(e.push([n,s]),e.push([n+1,s]),e.push([n,s+1]),e.push([n+1,s+1])));const r=monotoneChainConvexHull$1(e);this.computed.convexHull={polyline:r,surface:surface(r),perimeter:perimeter(r)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const e=this.convexHull,r=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});r.paintPolyline(e.polyline,{closed:!0}),this.computed.convexHullMask=r}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const e=this.convexHull,r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let s=0;s<this.height;s++)robustPointInPolygon$1(e.polyline,[n,s])!==1&&r.setBitXY(n,s);this.computed.convexHullFilledMask=r}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let e=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(e.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:e};else{let r=e[0],n=e[1],s=e[2],a=Math.sqrt((r[0]-n[0])**2+(r[1]-n[1])**2),o=Math.sqrt((s[0]-n[0])**2+(s[1]-n[1])**2);this.computed.mbr={width:a,height:o,elongation:1-a/o,aspectRatio:a/o,surface:a*o,perimeter:(a+o)*2,rectangle:e}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let e=this.perimeterInfo,r=2-Math.sqrt(2);return e.one+e.two*2+e.three*3+e.four*4-r*(e.two+e.three*2+e.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const e=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});e.paintPolyline(this.feretDiameters.minLine),e.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=e}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let e=round(this.mbr.rectangle);if(e.length>0){const r=minMax(e),n=new Image(r[1][0]-r[0][0]+1,r[1][1]-r[0][1]+1,{kind:BINARY,position:[this.minX+r[0][0],this.minY+r[0][1]],parent:this.map.parent});e=moveToZeroZero(e),n.paintPolyline(e,{closed:!0}),this.computed.mbrMask=n}else this.computed.mbrMask=new Image(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const e=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),r=this.mask.minimalBoundingRectangle();for(let n=0;n<this.width;n++)for(let s=0;s<this.height;s++)robustPointInPolygon$1(r,[n,s])!==1&&e.setBitXY(n,s);this.computed.mbrFilledMask=e}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let e=[];for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++){let s=(r+this.minY)*this.map.width+n+this.minX;this.map.data[s]===this.id&&e.push([n,r])}this.computed.points=e}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let e=0,r;const n=this.points;for(let s=0;s<n.length;s++)for(let a=s+1;a<n.length;a++){let o=Math.pow(n[s][0]-n[a][0],2)+Math.pow(n[s][1]-n[a][1],2);o>=e&&(e=o,r=[n[s],n[a]])}this.computed.maxLengthPoints=r}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let e=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=e}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let e=this.maxLengthPoints,r=-Math.atan2(e[0][1]-e[1][1],e[0][0]-e[1][0])*180/Math.PI;this.computed.angle=r}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(t){let e=t.map,r=e.data,n=new Set,s=new Map,a=new Set,o=[1,0,-1,0],l=[0,1,0,-1];for(let c=t.minX;c<=t.maxX;c++)for(let u=t.minY;u<=t.maxY;u++){let g=c+u*e.width;if(r[g]===t.id)for(let d=0;d<4;d++){let p=c+o[d],x=u+l[d];if(p>=0&&x>=0&&p<e.width&&x<e.height){let y=p+x*e.width;if(r[y]!==t.id&&!a.has(y)){a.add(y),n.add(r[y]);let m=s.get(r[y]);m?s.set(r[y],++m):s.set(r[y],1)}}}}let f=Array.from(n),h=f.map(function(c){return s.get(c)});return{ids:f,lengths:h}}function getBoxIDs(t){let e=new Set,r=t.map,n=r.data;for(let s of[0,t.height-1])for(let a=0;a<t.width;a++){let o=(s+t.minY)*r.width+a+t.minX;if(a-t.minX>0&&n[o]===t.id&&n[o-1]!==t.id){let l=n[o-1];e.add(l)}if(r.width-a-t.minX>1&&n[o]===t.id&&n[o+1]!==t.id){let l=n[o+1];e.add(l)}}for(let s of[0,t.width-1])for(let a=0;a<t.height;a++){let o=(a+t.minY)*r.width+s+t.minX;if(a-t.minY>0&&n[o]===t.id&&n[o-r.width]!==t.id){let l=n[o-r.width];e.add(l)}if(r.height-a-t.minY>1&&n[o]===t.id&&n[o+r.width]!==t.id){let l=n[o+r.width];e.add(l)}}return Array.from(e)}function getBox(t){let e=0,r=t.map,n=r.data,s=[0];t.height>1&&(s[1]=t.height-1);for(let o of s)for(let l=1;l<t.width-1;l++){let f=(o+t.minY)*r.width+l+t.minX;n[f]===t.id&&e++}let a=[0];t.width>1&&(a[1]=t.width-1);for(let o of a)for(let l=0;l<t.height;l++){let f=(l+t.minY)*r.width+o+t.minX;n[f]===t.id&&e++}return e}function getBorder(t){let e=0,r=t.map,n=r.data;for(let s=1;s<t.width-1;s++)for(let a=1;a<t.height-1;a++){let o=(a+t.minY)*r.width+s+t.minX;n[o]===t.id&&(n[o-1]!==t.id||n[o+1]!==t.id||n[o-r.width]!==t.id||n[o+r.width]!==t.id)&&e++}return e+t.box}function getPerimeterInfo(t){let e=t.map,r=e.data,n=0,s=0,a=0,o=0;for(let l=0;l<t.width;l++)for(let f=0;f<t.height;f++){let h=(f+t.minY)*e.width+l+t.minX;if(r[h]===t.id){let c=0;switch((l===0||t.externalIDs.includes(r[h-1]))&&c++,(l===t.width-1||t.externalIDs.includes(r[h+1]))&&c++,(f===0||t.externalIDs.includes(r[h-e.width]))&&c++,(f===t.height-1||t.externalIDs.includes(r[h+e.width]))&&c++,c){case 1:n++;break;case 2:s++;break;case 3:a++;break;case 4:o++;break}}}return{one:n,two:s,three:a,four:o}}function getExternal(t){let e=0,r=t.map,n=r.data;for(let s=1;s<t.width-1;s++)for(let a=1;a<t.height-1;a++){let o=(a+t.minY)*r.width+s+t.minX;n[o]===t.id&&(t.externalIDs.includes(n[o-1])||t.externalIDs.includes(n[o+1])||t.externalIDs.includes(n[o-r.width])||t.externalIDs.includes(n[o+r.width]))&&e++}return e+t.box}function getHolesInfo(t){let e=0,r=t.map.width,n=t.map.data;for(let s=1;s<t.width-1;s++)for(let a=1;a<t.height-1;a++){let o=(a+t.minY)*r+s+t.minX;t.internalIDs.includes(n[o])&&n[o]!==t.id&&e++}return{number:t.internalIDs.length-1,surface:e}}function getInternalIDs(t){let e=[t.id],r=t.map,n=r.data;if(t.height>2)for(let a=0;a<t.width;a++){let o=t.minY*r.width+a+t.minX;if(e.includes(n[o])){let l=n[o+r.width];!e.includes(l)&&!t.boxIDs.includes(l)&&e.push(l)}}let s=new Array(4);for(let a=1;a<t.width-1;a++)for(let o=1;o<t.height-1;o++){let l=(o+t.minY)*r.width+a+t.minX;if(e.includes(n[l])){s[0]=n[l-1],s[1]=n[l+1],s[2]=n[l-r.width],s[3]=n[l+r.width];for(let f=0;f<4;f++){let h=s[f];!e.includes(h)&&!t.boxIDs.includes(h)&&e.push(h)}}}return e}class RoiLayer{constructor(e,r){this.roiMap=e,this.options=r,this.roi=this.createRoi()}createRoi(){let e=this.roiMap.data,r={};this.roiMap.positive=0,this.roiMap.negative=0;for(let l=0;l<e.length;l++)e[l]&&!r[e[l]]&&(r[e[l]]=!0,e[l]>0?this.roiMap.positive++:this.roiMap.negative++);let n={};for(let l in r)n[l]=new Roi(this.roiMap,l*1);let s=this.roiMap.width,a=this.roiMap.height;for(let l=0;l<a;l++)for(let f=0;f<s;f++){let h=l*s+f;if(e[h]!==0){const c=e[h],u=n[c];f<u.minX&&(u.minX=f),f>u.maxX&&(u.maxX=f),l<u.minY&&(u.minY=l),l>u.maxY&&(u.maxY=l),u.meanX+=f,u.meanY+=l,u.surface++}}let o=[];for(let l in r)n[l].meanX/=n[l].surface,n[l].meanY/=n[l].surface,o.push(n[l]);return o}}function commonBorderLength(t){let e=t.data,r=[1,0,-1,0],n=[0,1,0,-1],s=t.minMax,a=-s.min,o=s.max+a,l=[];for(let h=0;h<=o;h++)l.push(Object.create(null));for(let h=0;h<t.width;h++)for(let c=0;c<t.height;c++){let u=h+c*t.width,g=e[u];if(g!==0){let d=Object.create(null),p=!1;for(let x=0;x<4;x++){let y=h+r[x],m=c+n[x];if(y>=0&&m>=0&&y<t.width&&m<t.height){let A=e[y+m*t.width];g!==A&&(p=!0,A!==0&&d[A]===void 0&&(d[A]=!0,l[A+a][g]?l[A+a][g]++:l[A+a][g]=1))}else p=!0}p&&(l[g+a][g]?l[g+a][g]++:l[g+a][g]=1)}}let f={};for(let h=0;h<l.length;h++)Object.keys(l[h]).length>0&&(f[h-a]=l[h]);return f}function mergeRoi(t={}){const{algorithm:e="commonBorderLength",minCommonBorderLength:r=5,maxCommonBorderLength:n=100,minCommonBorderRatio:s=.3,maxCommonBorderRatio:a=1}=t;let o=function(y,m,A){return y[A]>=r&&y[A]<=n};typeof e=="function"&&(o=e),e.toLowerCase()==="commonborderratio"&&(o=function(y,m,A){let b=Math.min(y[A]/y[m],1);return b>=s&&b<=a});const l=this,f=l.commonBorderLength;let h={},c={};for(let y of Object.keys(f)){let m=f[y],A=Object.keys(m);for(let b of A)if(b!==y&&o(m,y,b)){let _=b;c[b]&&(_=c[b]);let E=y;if(c[y]&&(E=c[y]),Number(_)!==E){let T=Math.min(_,E),I=Math.max(_,E);if(h[T]||(h[T]={}),h[T][I]=!0,c[I]=T,h[I]){for(let v of Object.keys(h[I]))h[T][v]=!0,c[v]=T;delete h[I]}}}}let u=l.minMax,g=-u.min,d=u.max+g,p=new Array(d+1).fill(0);for(let y of Object.keys(c))p[Number(y)+g]=c[y];let x=l.data;for(let y=0;y<x.length;y++){let m=x[y];if(m!==0){let A=p[m+g];A!==0&&(x[y]=A)}}return l.computed={},l}class RoiMap{constructor(e,r){this.parent=e,this.width=e.width,this.height=e.height,this.data=r,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let e=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let n=0;n<this.data.length;n++)this.data[n]<e&&(e=this.data[n]),this.data[n]>r&&(r=this.data[n]);return{min:e,max:r}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(e={}){return mergeRoi.call(this,e)}mergeRois(e){const r=e[0],n=e.slice(1);for(let s=0;s<this.data.length;s++)n.includes(this.data[s])&&(this.data[s]=r)}rowsInfo(){let e=new Array(this.height),r=0;for(let n=0;n<this.data.length;n+=this.width){let s={row:r,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};e[r++]=s;let a={},o={},l=[],f=this.data[n],h=0;for(let c=n;c<n+this.width;c++){let u=this.data[c];f!==u&&(f=u,l.push(h),h=0),h++,u>0?(s.positivePixel++,a[u]||(a[u]=!0)):u<0?(s.negativePixel++,o[u]||(o[u]=!0)):s.zeroPixel++}l.push(h),s.medianChange=l.sort((c,u)=>c-u)[Math.floor(l.length/2)],s.positiveRoiIDs=Object.keys(a),s.negativeRoiIDs=Object.keys(o),s.positiveRoi=s.positiveRoiIDs.length,s.negativeRoi=s.negativeRoiIDs.length}return e}colsInfo(){let e=new Array(this.width),r=0;for(let n=0;n<this.width;n++){let s={col:r,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};e[r++]=s;let a={},o={},l=[],f=this.data[n],h=0;for(let c=n;c<n+this.data.length;c+=this.width){let u=this.data[c];f!==u&&(f=u,l.push(h),h=0),h++,u>0?(s.positivePixel++,a[u]||(a[u]=!0)):u<0?(s.negativePixel++,o[u]||(o[u]=!0)):s.zeroPixel++}l.push(h),s.medianChange=l.sort((c,u)=>c-u)[Math.floor(l.length/2)],s.positiveRoiIDs=Object.keys(a),s.negativeRoiIDs=Object.keys(o),s.positiveRoi=s.positiveRoiIDs.length,s.negativeRoi=s.negativeRoiIDs.length}return e}}function fromMask(t,e={}){const{allowCorners:r=!1}=e,n=65535;let s=new Int16Array(t.size),a=0,o=0,l=new Uint16Array(n+1),f=new Uint16Array(n+1);for(let c=0;c<t.width;c++)for(let u=0;u<t.height;u++)s[u*t.width+c]===0&&h(c,u);function h(c,u){let g=0,d=0,p=t.getBitXY(c,u),x=p?++a:--o;if(a>32767||o<-32768)throw new Error("Too many regions of interest");for(l[0]=c,f[0]=u;g<=d;){let y=l[g&n],m=f[g&n];if(s[m*t.width+y]=x,y>0&&s[m*t.width+y-1]===0&&t.getBitXY(y-1,m)===p&&(d++,l[d&n]=y-1,f[d&n]=m,s[m*t.width+y-1]=-32768),m>0&&s[(m-1)*t.width+y]===0&&t.getBitXY(y,m-1)===p&&(d++,l[d&n]=y,f[d&n]=m-1,s[(m-1)*t.width+y]=-32768),y<t.width-1&&s[m*t.width+y+1]===0&&t.getBitXY(y+1,m)===p&&(d++,l[d&n]=y+1,f[d&n]=m,s[m*t.width+y+1]=-32768),m<t.height-1&&s[(m+1)*t.width+y]===0&&t.getBitXY(y,m+1)===p&&(d++,l[d&n]=y,f[d&n]=m+1,s[(m+1)*t.width+y]=-32768),r&&(y>0&&m>0&&s[(m-1)*t.width+y-1]===0&&t.getBitXY(y-1,m-1)===p&&(d++,l[d&n]=y-1,f[d&n]=m-1,s[(m-1)*t.width+y-1]=-32768),y<t.width-1&&m>0&&s[(m-1)*t.width+y+1]===0&&t.getBitXY(y+1,m-1)===p&&(d++,l[d&n]=y+1,f[d&n]=m-1,s[(m-1)*t.width+y+1]=-32768),y>0&&m<t.height-1&&s[(m+1)*t.width+y-1]===0&&t.getBitXY(y-1,m+1)===p&&(d++,l[d&n]=y-1,f[d&n]=m+1,s[(m+1)*t.width+y-1]=-32768),y<t.width-1&&m<t.height-1&&s[(m+1)*t.width+y+1]===0&&t.getBitXY(y+1,m+1)===p&&(d++,l[d&n]=y+1,f[d&n]=m+1,s[(m+1)*t.width+y+1]=-32768)),g++,d-g>n)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(t,s)}class DisjointSet{constructor(){this.nodes=new Map}add(e){var r=this.nodes.get(e);return r||(r=new DisjointSetNode(e),this.nodes.set(e,r)),r}union(e,r){const n=this.find(e),s=this.find(r);n!==s&&(n.rank<s.rank?n.parent=s:n.rank>s.rank?s.parent=n:(s.parent=n,n.rank++))}find(e){for(var r=e;r.parent!==null;)r=r.parent;for(var n=e;n.parent!==null;){var s=n;n=n.parent,s.parent=r}return r}connected(e,r){return this.find(e)===this.find(r)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(t){this.value=t,this.parent=null,this.rank=0}var DisjointSet$1=DisjointSet_1;const direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(t,e={}){const{allowCorners:r=!1}=e;let n=4;r&&(n=8);let s,a,o;if(n===8)s=direction8X,a=direction8Y,o=neighbours8;else if(n===4)s=direction4X,a=direction4Y,o=neighbours4;else throw new RangeError(`unsupported neighbours count: ${n}`);const l=t.size,f=t.width,h=t.height,c=new Array(l),u=new Uint32Array(l),g=new DisjointSet$1;let d=1;for(let p=0;p<h;p++)for(let x=0;x<f;x++){const y=x+p*f;if(t.getBit(y)){let m=null;for(let A=0;A<o.length;A++){const b=x+s[A],_=p+a[A];if(b>=0&&_>=0&&b<f&&_<h){const E=b+_*f;let T=c[E];T?(o[A]=T,(!m||o[A].value<m.value)&&(m=o[A])):o[A]=null}}if(!m)c[y]=g.add(d++);else{c[y]=m;for(let A=0;A<o.length;A++)o[A]&&o[A]!==m&&g.union(m,o[A])}}}for(let p=0;p<h;p++)for(let x=0;x<f;x++){const y=x+p*f;t.getBit(y)&&(u[y]=g.find(c[y]).value)}return new RoiMap(t,u)}function fromMaxima(t={}){let{allowCorner:e=!0,onlyTop:r=!1,invert:n=!1}=t,s=this;s.checkProcessable("fromMaxima",{components:[1]});const a=1,o=2;let l=0,f=0,h=new Int16Array(s.size),c=new Int8Array(s.size),u=new Float32Array(s.size),g=1048575,d=new Uint16Array(g+1),p=new Uint16Array(g+1),x=0,y=0,m=new Uint16Array(g+1),A=new Uint16Array(g+1),b=0,_=0;for(E(s);x<y;){let v=d[x&g],k=p[x&g];I(v,k,o),x++}return new RoiMap(s,h);function E({maxima:v=!0}){for(let k=1;k<s.height-1;k++)for(let w=1;w<s.width-1;w++){let M=w+k*s.width;if(c[M]===0){let D=v?s.data[M]:-s.data[w+k*s.width];if(s.data[k*s.width+w-1]>D||s.data[k*s.width+w+1]>D||s.data[(k-1)*s.width+w]>D||s.data[(k+1)*s.width+w]>D||e&&(s.data[(k-1)*s.width+w-1]>D||s.data[(k-1)*s.width+w+1]>D||s.data[(k+1)*s.width+w-1]>D||s.data[(k+1)*s.width+w+1]>D))continue;h[M]=v?++l:--f,T(w,k)||(v?--l:++f)}}}function T(v,k){let w=y;b=0,_=1,m[0]=v,A[0]=k;let M=!0;for(;b<_;){let D=m[b&g],R=A[b&g];M&=I(D,R,a),b++}if(!M){for(let D=0;D<_;D++){let R=m[D&g],P=A[D&g]*s.width+R;h[P]=0}y=w}return M}function I(v,k,w){let M=h[k*s.width+v],D=s.data[k*s.width+v];for(let R=k-1;R<=k+1;R++)for(let F=v-1;F<=v+1;F++){let P=R*s.width+F;if(c[P]===0)switch(c[P]=1,u[P]=s.data[P]-D,w){case a:if(u[P]===0){if(F===0||R===0||F===s.width-1||R===s.height-1)return!1;h[P]=M,m[_&g]=F,A[_&g]=R,_++}else{if(u[P]>0)return!1;r||(h[P]=M,d[y&g]=F,p[y&g]=R,y++)}break;case o:u[P]<=0&&(h[P]=M,d[y&g]=F,p[y&g]=R,y++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(t,e={}){let r=new Shape(e),n=new Int16Array(this.size),s=0,a=r.getPoints();for(let o=0;o<t.length;o++){s++;let l=t[o][0],f=t[o][1];for(let h=0;h<a.length;h++){let c=a[h][0],u=a[h][1];l+c>=0&&f+u>=0&&l+c<this.width&&f+u<this.height&&(n[l+c+(f+u)*this.width]=s)}}return new RoiMap(this,n)}var priorityQueue={exports:{}};(function(t,e){(function(r){t.exports=r()})(function(){return function r(n,s,a){function o(h,c){if(!s[h]){if(!n[h]){var u=typeof commonjsRequire=="function"&&commonjsRequire;if(!c&&u)return u(h,!0);if(l)return l(h,!0);var g=new Error("Cannot find module '"+h+"'");throw g.code="MODULE_NOT_FOUND",g}var d=s[h]={exports:{}};n[h][0].call(d.exports,function(p){var x=n[h][1][p];return o(x||p)},d,d.exports,r,n,s,a)}return s[h].exports}for(var l=typeof commonjsRequire=="function"&&commonjsRequire,f=0;f<a.length;f++)o(a[f]);return o}({1:[function(r,n,s){var a,o,l,f,h,c=function(g,d){for(var p in d)u.call(d,p)&&(g[p]=d[p]);function x(){this.constructor=g}return x.prototype=d.prototype,g.prototype=new x,g.__super__=d.prototype,g},u={}.hasOwnProperty;a=r("./PriorityQueue/AbstractPriorityQueue"),o=r("./PriorityQueue/ArrayStrategy"),f=r("./PriorityQueue/BinaryHeapStrategy"),l=r("./PriorityQueue/BHeapStrategy"),h=function(g){c(d,g);function d(p){p||(p={}),p.strategy||(p.strategy=f),p.comparator||(p.comparator=function(x,y){return(x||0)-(y||0)}),d.__super__.constructor.call(this,p)}return d}(a),h.ArrayStrategy=o,h.BinaryHeapStrategy=f,h.BHeapStrategy=l,n.exports=h},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(r,n,s){n.exports=function(){function a(o){var l;if((o!=null?o.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((o!=null?o.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new o.strategy(o),this.length=(o!=null&&(l=o.initialValues)!=null?l.length:void 0)||0}return a.prototype.queue=function(o){this.length++,this.priv.queue(o)},a.prototype.dequeue=function(o){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},a.prototype.peek=function(o){if(!this.length)throw"Empty queue";return this.priv.peek()},a.prototype.clear=function(){return this.length=0,this.priv.clear()},a}()},{}],3:[function(r,n,s){var a;a=function(o,l,f){var h,c,u;for(c=0,h=o.length;c<h;)u=c+h>>>1,f(o[u],l)>=0?c=u+1:h=u;return c},n.exports=function(){function o(l){var f;this.options=l,this.comparator=this.options.comparator,this.data=((f=this.options.initialValues)!=null?f.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return o.prototype.queue=function(l){var f;f=a(this.data,l,this.comparator),this.data.splice(f,0,l)},o.prototype.dequeue=function(){return this.data.pop()},o.prototype.peek=function(){return this.data[this.data.length-1]},o.prototype.clear=function(){this.data.length=0},o}()},{}],4:[function(r,n,s){n.exports=function(){function a(o){var l,f,h,c,u,g,d,p;for(this.comparator=(o!=null?o.comparator:void 0)||function(x,y){return x-y},this.pageSize=(o!=null?o.pageSize:void 0)||512,this.length=0,d=0;1<<d<this.pageSize;)d+=1;if(1<<d!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=d,this._emptyMemoryPageTemplate=l=[],f=0,u=this.pageSize;0<=u?f<u:f>u;0<=u?++f:--f)l.push(null);if(this._memory=[],this._mask=this.pageSize-1,o.initialValues)for(g=o.initialValues,h=0,c=g.length;h<c;h++)p=g[h],this.queue(p)}return a.prototype.queue=function(o){this.length+=1,this._write(this.length,o),this._bubbleUp(this.length,o)},a.prototype.dequeue=function(){var o,l;return o=this._read(1),l=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,l),this._bubbleDown(1,l)),o},a.prototype.peek=function(){return this._read(1)},a.prototype.clear=function(){this.length=0,this._memory.length=0},a.prototype._write=function(o,l){var f;for(f=o>>this._shift;f>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[f][o&this._mask]=l},a.prototype._read=function(o){return this._memory[o>>this._shift][o&this._mask]},a.prototype._bubbleUp=function(o,l){var f,h,c,u;for(f=this.comparator;o>1&&(h=o&this._mask,o<this.pageSize||h>3?c=o&~this._mask|h>>1:h<2?(c=o-this.pageSize>>this._shift,c+=c&~(this._mask>>1),c|=this.pageSize>>1):c=o-2,u=this._read(c),!(f(u,l)<0));)this._write(c,l),this._write(o,u),o=c},a.prototype._bubbleDown=function(o,l){var f,h,c,u,g;for(g=this.comparator;o<this.length;)if(o>this._mask&&!(o&this._mask-1)?f=h=o+2:o&this.pageSize>>1?(f=(o&~this._mask)>>1,f|=o&this._mask>>1,f=f+1<<this._shift,h=f+1):(f=o+(o&this._mask),h=f+1),f!==h&&h<=this.length)if(c=this._read(f),u=this._read(h),g(c,l)<0&&g(c,u)<=0)this._write(f,l),this._write(o,c),o=f;else if(g(u,l)<0)this._write(h,l),this._write(o,u),o=h;else break;else if(f<=this.length)if(c=this._read(f),g(c,l)<0)this._write(f,l),this._write(o,c),o=f;else break;else break},a}()},{}],5:[function(r,n,s){n.exports=function(){function a(o){var l;this.comparator=(o!=null?o.comparator:void 0)||function(f,h){return f-h},this.length=0,this.data=((l=o.initialValues)!=null?l.slice(0):void 0)||[],this._heapify()}return a.prototype._heapify=function(){var o,l,f;if(this.data.length>0)for(o=l=1,f=this.data.length;1<=f?l<f:l>f;o=1<=f?++l:--l)this._bubbleUp(o)},a.prototype.queue=function(o){this.data.push(o),this._bubbleUp(this.data.length-1)},a.prototype.dequeue=function(){var o,l;return l=this.data[0],o=this.data.pop(),this.data.length>0&&(this.data[0]=o,this._bubbleDown(0)),l},a.prototype.peek=function(){return this.data[0]},a.prototype.clear=function(){this.length=0,this.data.length=0},a.prototype._bubbleUp=function(o){for(var l,f;o>0&&(l=o-1>>>1,this.comparator(this.data[o],this.data[l])<0);)f=this.data[l],this.data[l]=this.data[o],this.data[o]=f,o=l},a.prototype._bubbleDown=function(o){var l,f,h,c,u;for(l=this.data.length-1;f=(o<<1)+1,c=f+1,h=o,f<=l&&this.comparator(this.data[f],this.data[h])<0&&(h=f),c<=l&&this.comparator(this.data[c],this.data[h])<0&&(h=c),h!==o;)u=this.data[h],this.data[h]=this.data[o],this.data[o]=u,o=h},a}()},{}]},{},[1])(1)})})(priorityQueue);var PriorityQueue=priorityQueue.exports;const dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(t={}){let{points:e,mask:r,image:n,fillMaxValue:s=this.maxValue,invert:a=!1}=t,o=n||this;o.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),a=!a,e||(e=o.getLocalMaxima({invert:a,mask:r}));let l=a?0:1,f=new Int16Array(o.size),h=o.width,c=o.height,u=new PriorityQueue({comparator:(g,d)=>g[2]-d[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let g=0;g<e.length;g++){let d=e[g][0]+e[g][1]*h;f[d]=g+1;let p=o.data[d];(a&&p<=s||!a&&p>=s)&&u.queue([e[g][0],e[g][1],p])}for(;u.length>0;){let g=u.dequeue(),d=g[0]+g[1]*h;for(let p=0;p<4;p++){let x=g[0]+dxs[p],y=g[1]+dys[p];if(x>=0&&y>=0&&x<h&&y<c){let m=x+y*h;if(!r||r.getBit(m)===l){let A=o.data[m];(a&&A<=s||!a&&A>=s)&&f[m]===0&&(f[m]=f[d],u.queue([g[0]+dxs[p],g[1]+dys[p],A]))}}}}return new RoiMap(o,f)}class RoiManager{constructor(e,r={}){this._image=e,this._options=r,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(e={}){let r=Object.assign({},this._options,e),n=fromMaxima.call(this._image,e);this._layers[r.label]=new RoiLayer(n,r)}fromPoints(e,r={}){let n=Object.assign({},this._options,r),s=fromPoints.call(this._image,e,r);return this._layers[n.label]=new RoiLayer(s,n),this}putMap(e,r={}){let n=new RoiMap(this._image,e),s=Object.assign({},this._options,r);return this._layers[s.label]=new RoiLayer(n,s),this}fromWaterShed(e={}){let r=Object.assign({},this._options,e),n=fromWaterShed.call(this._image,e);this._layers[r.label]=new RoiLayer(n,r)}fromMask(e,r={}){let n=Object.assign({},this._options,r),s=fromMask.call(this._image,e,r);return this._layers[n.label]=new RoiLayer(s,n),this}fromMaskConnectedComponentLabelingAlgorithm(e,r={}){let n=Object.assign({},this._options,r),s=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,e,r);return this._layers[n.label]=new RoiLayer(s,n),this}getMap(e={}){let r=Object.assign({},this._options,e);return this._assertLayerWithLabel(r.label),this._layers[r.label].roiMap}rowsInfo(e={}){return this.getMap(e).rowsInfo()}colsInfo(e={}){return this.getMap(e).rowsInfo()}getRoiIds(e={}){let r=this.getRois(e);if(r){let n=new Array(r.length);for(let s=0;s<r.length;s++)n[s]=r[s].id;return n}throw new Error("ROIs not found")}getRois(e={}){let{label:r=this._options.label,positive:n=!0,negative:s=!0,minSurface:a=0,maxSurface:o=Number.POSITIVE_INFINITY,minWidth:l=0,maxWidth:f=Number.POSITIVE_INFINITY,minHeight:h=0,maxHeight:c=Number.POSITIVE_INFINITY,minRatio:u=0,maxRatio:g=Number.POSITIVE_INFINITY}=e;if(!this._layers[r])throw new Error(`this Roi layer (${r}) does not exist`);const d=this._layers[r].roi,p=[];for(const x of d)(x.id<0&&s||x.id>0&&n)&&x.surface>=a&&x.surface<=o&&x.width>=l&&x.width<=f&&x.height>=h&&x.height<=c&&x.ratio>=u&&x.ratio<=g&&p.push(x);return p}getRoi(e,r={}){const{label:n=this._options.label}=r;if(!this._layers[n])throw new Error(`this Roi layer (${n}) does not exist`);const s=this._layers[n].roi.find(a=>a.id===e);if(!s)throw new Error(`found no Roi with id ${e}`);return s}getMasks(e={}){let r=this.getRois(e),n=new Array(r.length);for(let s=0;s<r.length;s++)n[s]=r[s].getMask(e);return n}getAnalysisMasks(e={}){const{analysisProperty:r}=e;let n=`${r}Mask`,s=this.getRois(e);return s.length===0||!s[0][n]?[]:s.map(a=>a[n])}getData(e={}){let r=Object.assign({},this._options,e);return this._assertLayerWithLabel(r.label),this._layers[r.label].roiMap.data}paint(e={}){let{labelProperty:r,analysisProperty:n}=e;this._painted||(this._painted=this._image.rgba8());let s=this.getMasks(e);if(r){const a=this.getRois(e);e.labels=a.map(h=>deepValue(h,r));const o=Math.max(...e.labels);let l=!1,f=!1;if(r.includes("surface")?l=!0:/(?:perimeter|min|max|external|width|height|length)/.test(r)&&(f=!0),isFinite(o)){let h="";if(e.unit!=="pixel"&&e.pixelSize&&(f||l)){h=l?`${e.unit}^2`:e.unit;let c=l?"m^2":"m",u=l?e.pixelSize**2:e.pixelSize;const g=Qty.swiftConverter(c,h);e.labels=e.labels.map(d=>g(u*d))}o>50?e.labels=e.labels.map(c=>Math.round(c)+h):o>10?e.labels=e.labels.map(c=>c.toFixed(1)+h):e.labels=e.labels.map(c=>c.toFixed(2)+h)}e.labelsPosition=a.map(h=>[h.meanX,h.meanY])}if(this._painted.paintMasks(s,e),n){let a=this.getAnalysisMasks(e);this._painted.paintMasks(a,{color:e.analysisColor,alpha:e.analysisAlpha})}return this._painted}getMask(e={}){let r=new Image(this._image.width,this._image.height,{kind:"BINARY"}),n=this.getMasks(e);for(let s=0;s<n.length;s++){let a=n[s];for(let o=0;o<a.width;o++)for(let l=0;l<a.height;l++)a.getBitXY(o,l)&&r.setBitXY(o+a.position[0],l+a.position[1])}return r}resetPainted(e={}){const{image:r}=e;r?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(e={}){const r=this.getMap(e);return r.mergeRoi(e),this.putMap(r.data,e),this}mergeRois(e,r={}){if(!Array.isArray(e)||e.some(s=>!Number.isInteger(s)))throw new Error("Roi ids must be an array of integers");if(e.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(e).size!==e.length)throw new Error("Roi ids must be all different");e.forEach(s=>this.getRoi(s));const n=this.getMap(r);return n.mergeRois(e),this.putMap(n.data,r),this}findCorrespondingRoi(e,r={}){let n=this.getRois(r),s=[];for(let a=0;a<n.length;a++){let o=n[a],l=o.minX,f=o.minY,h=o.points,c=Math.sign(o.id),u=correspondingRoisInformation(l,f,h,e,c);s.push(u)}return s}_assertLayerWithLabel(e){if(!this._layers[e])throw new Error(`no layer with label ${e}`)}}function correspondingRoisInformation(t,e,r,n,s){let a={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let o=0;o<r.length;o++){let l=r[o],f=l[0],h=l[1],c=f+t+(h+e)*n.width,u=n.data[c];(u>0||u<0)&&(a.id.includes(u)?a.surface[a.id.indexOf(u)]+=1:(a.id.push(u),a.surface.push(1)))}for(let o=0;o<a.id.length;o++)Math.sign(a.id[o])===s?a.same+=a.surface[o]:a.opposite+=a.surface[o],a.roiSurfaceCovered[o]=a.surface[o]/r.length;return a.total=a.opposite+a.same,a}const objectToString=Object.prototype.toString;class Image{constructor(e,r,n,s){if(arguments.length===1?(s=e,{width:e,height:r,data:n}=s):n&&!n.length&&(s=n,{data:n}=s),e===void 0&&(e=1),r===void 0&&(r=1),s===void 0&&(s={}),typeof s!="object"||s===null)throw new TypeError("options must be an object");if(!Number.isInteger(e)||e<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new RangeError("height must be a positive integer");const{kind:a=RGBA}=s;if(typeof a!="string")throw new TypeError("kind must be a string");const o=getKind(a),l=Object.assign({},s);for(const x in o)l[x]===void 0&&(l[x]=o[x]);verifyKindDefinition(l);const{components:f,bitDepth:h,colorModel:c}=l,u=l.alpha+0,g=e*r,d=f+u,p=h===32?Number.MAX_VALUE:2**h-1;if(n===void 0)n=createPixelArray(g,f,u,d,h,p);else{const x=getTheoreticalPixelArraySize(g,d,h);if(n.length!==x)throw new RangeError(`incorrect data size: ${n.length}. Should be ${x}`)}this.width=e,this.height=r,this.data=n,this.size=g,this.components=f,this.alpha=u,this.bitDepth=h,this.maxValue=p,this.colorModel=c,this.channels=d,this.meta=s.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:s.parent||null}),this.position=s.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(e){return objectToString.call(e)==="[object IJSImage]"}static fromCanvas(e){const n=e.getContext("2d").getImageData(0,0,e.width,e.height);return new Image(n.width,n.height,n.data)}static createFrom(e,r){const n=getImageParameters(e);return Object.assign(n,{parent:e,position:[0,0]},r),new Image(n)}getRoiManager(e){return new RoiManager(this,e)}clone(){const e=this.data.slice();return new Image(this.width,this.height,e,this)}apply(e){for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++){let s=(r*this.width+n)*this.channels;e.call(this,s)}}}setValueMethods(Image);setBitMethods(Image);setExportMethods(Image);Image.prototype.checkProcessable=checkProcessable;Image.prototype.getRGBAData=getRGBAData;Image.load=load;Image.extendMethod=extendMethod;Image.extendProperty=extendProperty;extend$1(Image);var workerTemplate$1={},worker$1=function(){self.window=self;function t(){this._listeners={}}t.prototype.on=function(r,n){if(this._listeners[r])throw new RangeError("there is already a listener for "+r);if(typeof n!="function")throw new TypeError("callback argument must be a function");this._listeners[r]=n},t.prototype._send=function(r,n,s){s===void 0?s=[]:Array.isArray(s)||(s=[s]),self.postMessage({id:r,data:n},s)},t.prototype._trigger=function(r,n){if(!this._listeners[r])throw new Error("event "+r+" is not defined");this._listeners[r].apply(null,n)};var e=new t;self.onmessage=function(r){switch(r.data.action){case"exec":r.data.args.unshift(function(n,s){e._send(r.data.id,n,s)}),e._trigger(r.data.event,r.data.args);break;case"ping":e._send(r.data.id,"pong");break;default:throw new Error("unexpected action: "+r.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function t(e,r){var n=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(r)+`);
`,"(",e,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(n)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(t,e){if(typeof t!="string"&&typeof t!="function")throw new TypeError("func argument must be a function");if(e===void 0&&(e={}),typeof e!="object"||e===null)throw new TypeError("options argument must be an object");this._workerCode=t.toString(),e.maxWorkers===void 0||e.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):e.maxWorkers>0?this._numWorkers=Math.min(e.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=e.timeout||0,this._terminateOnError=!!e.terminateOnError;var r=e.deps;typeof r=="string"&&(r=[r]),Array.isArray(r)||(r=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(r)}WorkerManager.prototype._init=function(t){for(var e=workerTemplate.newWorkerURL(this._workerCode,t),r=0;r<this._numWorkers;r++){var n=new Worker(e);n.onmessage=this._onmessage.bind(this,n),n.onerror=this._onerror.bind(this,n),n.running=!1,n.id=r,this._workers.set(n,null)}URL.revokeObjectURL(e)};WorkerManager.prototype._onerror=function(t,e){if(!this._terminated){this._working--,t.running=!1;var r=this._workers.get(t);r&&r[1](e.message),this._workers.set(t,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(t,e){if(!this._terminated){this._working--,t.running=!1;var r=this._workers.get(t);r&&r[0](e.data.data),this._workers.set(t,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var t of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!t.running)for(var e=0;e<this._waiting.length;e++){var r=this._waiting[e];if(!(typeof r[4]=="number"&&r[4]!==t.id)){this._waiting.splice(e,1),t.postMessage({action:"exec",event:r[0],args:r[1]},r[2]),t.running=!0,t.time=Date.now(),this._workers.set(t,r[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var t of this._workers)t[0].terminate(),t[1]&&t[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(t,e){if(this._terminated)throw new Error("Cannot post (terminated)");var r=[];for(var n of this._workers.keys())r.push(this.post(t,e,[],n.id));return Promise.all(r)};WorkerManager.prototype.post=function(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),Array.isArray(e)||(e=[e]),Array.isArray(r)||(r=[r]);var s=this;return new Promise(function(a,o){if(s._terminated)throw new Error("Cannot post (terminated)");s._waiting.push([t,e,r,[a,o],n]),s._exec()})};var src=WorkerManager;const defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(t,e,r){e=Object.assign({},defaultOptions,e);const n=this.manager;return Array.isArray(t)?Promise.all(t.map(function(s){const a=runOnce(n,s,e);return typeof r=="function"&&a.then(r),a})):runOnce(n,t,e)}function runOnce(t,e,r){return t.post("data",[e,r]).then(function(n){for(let s in n)n[s]=new Image(n[s]);return n})}function work(){worker.on("data",function(t,e,r){e=new IJS(e);const n={},s=[],a=e.grey(),o=a.sobelFilter();d("sobel",o);const l=o.level().mask({threshold:r.threshold});d("mask",l);const f=o.getRoiManager();f.fromMask(l);const h=f.getMask(r.roi);d("realMask",h);const c=a.getPixelsGrid({sampling:r.sampling,mask:h}),u=e.getBackground(c.xyS,c.zS,r.regression);d("background",u);const g=e.subtract(u);n.result=g,s.push(g.data.buffer),t(n,s);function d(p,x){r.include.includes(p)&&(n[p]=x,s.push(x.data.buffer))}})}const background={run,work};function extend(t){t.extendMethod("background",background)}class Worker$1{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(e){if(typeof e!="string")throw new TypeError("worker URL must be a string");this._url=e,this._deps[0]=e}static extendMethod(e,r){let n,s,a={};function o(...l){return n||(this.checkUrl(),s=this.url,n=new src(r.work,{deps:s}),a.manager=n),r.run.call(a,...l)}o.reset=function(){n&&(n.terminate(),n=new src(r.work,{deps:s}),a.manager=n)},Worker$1.prototype[e]=o}}extend(Worker$1);new Worker$1;export{Image as I};
